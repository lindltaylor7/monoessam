import{_ as F}from"./index-I1INQbjS.js";import{_ as se,a as ne,b as oe,c as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-qsH3fOd8.js";import{_ as re}from"./DialogDescription.vue_vue_type_script_setup_true_lang-C9eRW0vR.js";import{_ as fe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-C4uELlRA.js";import{_ as ce}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-C5Frt1Ly.js";import{c as ue,_ as de,a as I,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CwBRg6HE.js";import{_ as me}from"./AlertErrors.vue_vue_type_script_setup_true_lang-DleCsx8Q.js";import{j as v,C as pe,d as ve,g as h,o as w,w as n,a as i,u as e,e as _,b as $,i as H}from"./app-Bfd0z9E7.js";import{_ as be}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang--6yaje0r.js";import{_ as ge}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-CmbFKH7b.js";import{_ as _e}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-DBJ_ZdFi.js";import{_ as xe}from"./SizesTab.vue_vue_type_script_setup_true_lang-DBRj92cU.js";import{P as ye}from"./pencil-BS5T_OjU.js";const Se=9*1024*1024;function he(){const s=v(!1),a=v(""),u=v([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:u,showAlert:s,alertMessage:a,handleFileUpload:(x,p,C)=>{const b=x.target.files;if(b.length>0){const g=b[0];if(g.size>Se)a.value="El archivo es demasiado grande. El máximo es 9MB.",s.value=!0;else{const y=u.value.find(o=>o.label==p);if(y){const d=g.name.split(".").pop(),c=new File([g],`${p}_${Date.now()}.${d}`,{type:g.type});C.push({file:c,label:p}),y.file=c}}}},handleDateFile:(x,p)=>{u.value[p].expirationDate=x}}}function we(){const s=v(null),a=v(null),u=v(null);return{fileInput:s,imagePreview:a,selectedFile:u,triggerFileInput:()=>{var p;(p=s.value)==null||p.click()},handleImageUpload:p=>{var g;const b=(g=p.target.files)==null?void 0:g[0];if(b){if(!b.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const y=5*1024*1024;if(b.size>y){alert("La imagen es demasiado grande. Máximo 5MB");return}u.value=b;const o=new FileReader;o.onload=d=>{var c;a.value=(c=d.target)==null?void 0:c.result},o.readAsDataURL(b)}},removeImage:()=>{a.value=null,u.value=null,s.value&&(s.value.value="")}}}function Ce(){const s=pe({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),a=v([]),u=v(!1),f=v([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),l=v([]);return{form:s,errorsSend:a,showErrors:u,prendasFijas:f,cafesUnitSelected:l,handleSubmit:(o,d)=>{let c;Array.isArray(d)?c=d:d&&typeof d=="object"?c=Array.isArray(d.value)?d.value:Object.values(d):c=[],c.forEach(m=>{m&&m.expirationDate===null?s.filesData.push({expirationDate:"-"}):s.filesData.push({expirationDate:m.expirationDate})}),console.log("filesArray:",c);const D=c.filter(m=>m&&typeof m=="object").map(m=>m.file).filter(m=>m instanceof File);console.log("Archivos válidos a subir:",D.length,D),s.prendas=f.value,s.files=D,s.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:m=>{s.reset(),o()},onError:m=>{u.value=!0,a.value=m,console.error("Error al subir el archivo:",m)}})},updateStaff:(o,d)=>{console.log(s),s.prendas=f.value,s.put(route("staff.update",d),{onSuccess:c=>{o()},onError:c=>{u.value=!0,a.value=c,console.error("Error al subir el archivo:",c)}})},selectCafe:o=>{s.cafeId=o.id},selectRole:o=>{s.roleId=o.id},selectUnit:o=>{s.unitId=o.id,l.value=o.cafes,s.unitSelectedText=o.name},selectArea:o=>{s.areaId=o}}}const De={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ve=ve({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(s){var j,P,R,T,z,B,V,M,N,O,L,G,Z,W,X;const a=s,u=v(!1),f=v("personal"),{form:l,errorsSend:x,showErrors:p,prendasFijas:C,cafesUnitSelected:b,handleSubmit:g,updateStaff:y,selectCafe:o,selectRole:d,selectUnit:c,selectArea:D}=Ce();a.staff&&(console.log(a.staff),l.name=a.staff.name,l.dni=a.staff.dni,l.cell=a.staff.cell,l.birthdate=String(a.staff.birthdate),l.age=a.staff.age,l.sex=String(a.staff.sex),l.email=a.staff.email,l.country=a.staff.country,l.civilstatus=String(a.staff.civilstatus),l.contactname=a.staff.contactname,l.contactcell=a.staff.contactcell,l.district=(j=a.staff.staff_financial)==null?void 0:j.district,l.province=(P=a.staff.staff_financial)==null?void 0:P.province,l.department=(R=a.staff.staff_financial)==null?void 0:R.department,l.address=(T=a.staff.staff_financial)==null?void 0:T.address,l.workSystem=(z=a.staff.staff_financial)==null?void 0:z.system_work,l.replacement=(B=a.staff.staff_financial)==null?void 0:B.replacement,l.salary=(V=a.staff.staff_financial)==null?void 0:V.salary,l.observations=(M=a.staff.staff_financial)==null?void 0:M.observations,l.bankEntity=String((N=a.staff.staff_financial)==null?void 0:N.bank_entity),l.cc=(O=a.staff.staff_financial)==null?void 0:O.account_number,l.cci=(L=a.staff.staff_financial)==null?void 0:L.cci,l.pensioncontribution=String((G=a.staff.staff_financial)==null?void 0:G.pensioncontribution),l.startDate=String((Z=a.staff.staff_financial)==null?void 0:Z.start_date),l.contractEndDate=String((W=a.staff.staff_financial)==null?void 0:W.contract_end_date),l.children=(X=a.staff.staff_financial)==null?void 0:X.children,a.staff.staff_clothes.forEach(r=>{const t=C.value.find(S=>S.label==r.clothe_name);t.talla=r.clothing_size}));const{fileInput:m,imagePreview:J,triggerFileInput:K,handleImageUpload:k,removeImage:Q}=we(),{filesRequired:A,showAlert:Y,alertMessage:q,handleFileUpload:E,handleDateFile:ee}=he(),ae=()=>{const r=["personal","adjuntos","financiero","tallas"],t=r.indexOf(f.value);a.staff&&t==0?f.value=r[t+2]:t<r.length-1&&(f.value=r[t+1])},te=()=>{const r=["personal","adjuntos","financiero","tallas"],t=r.indexOf(f.value);a.staff&&t==2?f.value=r[t-2]:t>0&&(f.value=r[t-1])},le=()=>{a.staff?y(()=>{u.value=!1,f.value="personal"},a.staff.id):g(()=>{u.value=!1,f.value="personal"},A)};return(r,t)=>(w(),h(e(ie),{open:u.value,"onUpdate:open":t[2]||(t[2]=S=>u.value=S)},{default:n(()=>[i(e(ce),{"as-child":""},{default:n(()=>[a.staff?(w(),h(e(F),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:n(()=>[i(e(ye))]),_:1})):(w(),h(e(F),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>t[3]||(t[3]=[_(" Nuevo Personal ")])),_:1}))]),_:1}),i(e(se),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:n(()=>[$("input",{type:"file",ref_key:"fileInput",ref:m,onChange:t[0]||(t[0]=(...S)=>e(k)&&e(k)(...S)),accept:"image/*",class:"hidden"},null,544),i(e(ne),{class:"z-10 border-b bg-white px-6 py-4"},{default:n(()=>[i(e(oe),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:n(()=>t[4]||(t[4]=[_(" Ficha de Registro de Colaborador ")])),_:1}),i(e(re),null,{default:n(()=>t[5]||(t[5]=[_(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),i(me,{show:e(p),errors:e(x)},null,8,["show","errors"])]),_:1}),$("div",De,[i(e(ue),{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=S=>f.value=S),class:"w-full"},{default:n(()=>[i(e(de),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:n(()=>[i(e(I),{value:"personal",class:"text-xs md:text-sm"},{default:n(()=>t[6]||(t[6]=[_("Personal")])),_:1}),r.staff?H("",!0):(w(),h(e(I),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:n(()=>t[7]||(t[7]=[_("Adjuntos")])),_:1})),i(e(I),{value:"financiero",class:"text-xs md:text-sm"},{default:n(()=>t[8]||(t[8]=[_("Financiero")])),_:1}),i(e(I),{value:"tallas",class:"text-xs md:text-sm"},{default:n(()=>t[9]||(t[9]=[_("Tallas")])),_:1})]),_:1}),i(e(U),{value:"personal",class:"mt-0"},{default:n(()=>[i(_e,{staff:r.staff,form:e(l),cafes:e(b),units:r.units,roles:r.roles,businneses:r.businneses,"image-preview":e(J),onTriggerUpload:e(K),onRemoveImage:e(Q),onSelectCafe:e(o),onSelectUnit:e(c),onSelectRole:e(d),onSelectArea:e(D)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),i(e(U),{value:"adjuntos",class:"mt-0"},{default:n(()=>[i(be,{"files-required":e(A),"show-alert":e(Y),"alert-message":e(q),form:e(l),onUploadFile:e(E),onUploadDate:e(ee)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),i(e(U),{value:"financiero",class:"mt-0"},{default:n(()=>[i(ge,{form:e(l),roles:r.roles,onSelectRole:e(d),onUploadFile:e(E),staff:r.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),i(e(U),{value:"tallas",class:"mt-0"},{default:n(()=>[i(xe,{prendas:e(C)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),i(e(fe),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:n(()=>[$("div",null,[f.value!=="personal"?(w(),h(e(F),{key:0,onClick:te,variant:"outline",type:"button"},{default:n(()=>t[10]||(t[10]=[_(" ← Anterior ")])),_:1})):H("",!0)]),$("div",null,[f.value!=="tallas"?(w(),h(e(F),{key:0,onClick:ae,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>t[11]||(t[11]=[_(" Siguiente → ")])),_:1})):(w(),h(e(F),{key:1,onClick:le,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:n(()=>t[12]||(t[12]=[_(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ve as _};
