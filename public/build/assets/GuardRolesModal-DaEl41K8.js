import{d as Q,r as g,C as Y,s as Z,q as j,X as E,g as P,o as i,w as m,a as l,u as r,e as y,c as u,b as o,t as f,i as b,x as ee,F as C,l as U,n as q}from"./app-CkZEfMms.js";import{_ as se}from"./index-0E26QAEh.js";import{_ as A}from"./index-DfCtkBzz.js";import{_ as te,a as ae,b as le,c as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CcJAm2Qy.js";import{_ as oe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-8fQ-tYPC.js";import{_ as ne}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BrB3Wp72.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-BzXStTK3.js";import{P as $}from"./plus-DOjgi2MK.js";import{C as ue}from"./circle-check-R1VETfAZ.js";import{S as F}from"./search-BzUbHnwH.js";import{X as D}from"./x-B92Fb9I8.js";import{C as de}from"./circle-alert-T2HUwl98.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Primitive-BaxYTMe3.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-CSQnosAz.js";import"./useForwardExpose-Dg33A9vK.js";import"./DialogTitle-DcdfjZkw.js";import"./Teleport-D3oEZkhi.js";import"./utils-BES3iSsD.js";import"./createLucideIcon-Bo8ztqDM.js";const me={key:0,class:"flex items-center gap-3 rounded-lg border border-green-200 bg-green-50 p-4"},fe={class:"text-sm text-green-600"},ge={key:1,class:"space-y-4"},pe={class:"relative"},ve={class:"relative"},xe=["onClick","onKeydown"],ye={class:"flex-1"},be={key:0,class:"p-4 text-center text-gray-500"},_e={class:"space-y-3"},he={class:"flex items-center justify-between"},ke={class:"text-sm font-medium text-gray-700"},we={key:0,class:"py-6 text-center"},Ce={class:"flex flex-wrap gap-2"},$e={class:"flex items-center justify-between text-sm text-gray-500"},Re={key:0,class:"font-medium text-green-600"},ze=Q({__name:"GuardRolesModal",props:{guard:{type:Object,required:!0},roles:{type:Array,default:()=>[]}},emits:["asignRoles"],setup(L,{emit:G}){const R=L,M=G,_=g(!1),d=g(""),a=g([]),c=g(!1),p=g(!1),k=g(!1);let W=0;const h=Y({guard_id:0,roles_ids:[]}),V=Z(()=>{if(!d.value)return R.roles.slice(0,5);const t=d.value.toLowerCase();return R.roles.map(s=>{const n=s.name.toLowerCase();let x=0;return n.startsWith(t)&&(x+=3),n.includes(t)&&(x+=2),n.split(" ").some(w=>w.startsWith(t))&&(x+=1),{role:s,score:x}}).filter(s=>s.score>0).sort((s,n)=>n.score-s.score).slice(0,7).map(s=>s.role)}),B=g(!1);j(d,async(t,e)=>{if(c.value=t.length>0,B.value&&t.length>0){await E();const s=document.querySelector("[data-role-result]");s==null||s.focus()}B.value=!1});const K=t=>{const e={...t,instanceId:++W};a.value.push(e),d.value="",c.value=!1,E(()=>{var s,n;(n=(s=v.value)==null?void 0:s.$el)==null||n.focus()})},X=t=>{a.value=a.value.filter(e=>e.instanceId!==t)},O=()=>{a.value=[]},N=(t,e)=>{var s,n,x,w;switch(t.key){case"ArrowDown":t.preventDefault();const S=t.target.nextElementSibling;S==null||S.focus();break;case"ArrowUp":t.preventDefault();const I=t.target.previousElementSibling;I!=null&&I.focus()||((n=(s=v.value)==null?void 0:s.$el)==null||n.focus());break;case"Enter":t.preventDefault(),e&&K(e);break;case"Escape":c.value=!1,(w=(x=v.value)==null?void 0:x.$el)==null||w.focus();break}},H=async()=>{if(a.value.length!==0){h.roles_ids=a.value.map(t=>t.id),h.guard_id=R.guard.id,p.value=!0;try{await h.post(route("guards.roles.store")),k.value=!0,setTimeout(()=>{_.value=!1,M("asignRoles",a.value),h.reset(),a.value=[],k.value=!1,p.value=!1},1500)}catch{p.value=!1}}},v=g(null),z=g(null),T=t=>{var e;(e=v.value)!=null&&e.$el&&!v.value.$el.contains(t.target)&&z.value&&!z.value.contains(t.target)&&(c.value=!1)},J=()=>{c.value=!0};return j(_,t=>{t?(c.value=!1,document.addEventListener("click",T),E(()=>{var e,s;(s=(e=v.value)==null?void 0:e.$el)==null||s.focus()}),a.value=[]):(document.removeEventListener("click",T),c.value=!1,d.value="",a.value=[],k.value=!1,p.value=!1)}),(t,e)=>(i(),P(r(re),{open:_.value,"onUpdate:open":e[4]||(e[4]=s=>_.value=s)},{default:m(()=>[l(r(ne),null,{default:m(()=>[l(A,{class:"h-auto bg-green-500 text-white transition-colors duration-200 hover:bg-green-400"},{default:m(()=>[l(r($),{size:16,class:"mr-2"}),e[5]||(e[5]=y(" Agregar roles"))]),_:1})]),_:1}),l(r(te),{class:"max-w-md sm:max-w-lg"},{default:m(()=>[l(r(ae),null,{default:m(()=>[l(r(le),{class:"flex items-center gap-2"},{default:m(()=>[l(r($),{size:20,class:"text-green-500"}),y(" Asignar roles a "+f(L.guard.name),1)]),_:1}),e[6]||(e[6]=o("p",{class:"mt-1 text-sm text-gray-500"},"Puedes agregar múltiples instancias del mismo rol",-1))]),_:1}),k.value?(i(),u("div",me,[l(r(ue),{size:20,class:"flex-shrink-0 text-green-500"}),o("div",null,[e[7]||(e[7]=o("p",{class:"font-medium text-green-800"},"Roles asignados correctamente",-1)),o("p",fe,"Se han agregado "+f(a.value.length)+" roles a la guardia",1)])])):(i(),u("div",ge,[o("div",pe,[o("div",ve,[l(r(F),{size:18,class:"absolute top-1/2 left-3 -translate-y-1/2 transform text-gray-400"}),l(r(ie),{ref_key:"searchInputRef",ref:v,placeholder:"Buscar roles (ej: Líder, Supervisor...)",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),class:"w-full pr-10 pl-10",onClick:J,onKeydown:[e[1]||(e[1]=ee(s=>c.value=!1,["esc"])),N],autocomplete:"off"},null,8,["modelValue"]),d.value?(i(),u("button",{key:0,onClick:e[2]||(e[2]=s=>{d.value="",c.value=!1}),class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[l(r(D),{size:16})])):b("",!0)]),c.value?(i(),u("div",{key:0,ref_key:"resultsContainerRef",ref:z,class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},[(i(!0),u(C,null,U(V.value,s=>(i(),u("div",{key:s.id,"data-role-result":!0,onClick:n=>K(s),onKeydown:n=>N(n,s),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[l(r($),{size:16,class:"flex-shrink-0 text-green-500"}),o("span",ye,f(s.name),1),e[8]||(e[8]=o("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,xe))),128)),V.value.length===0&&d.value?(i(),u("div",be,[l(r(de),{size:20,class:"mx-auto mb-2 text-gray-400"}),e[9]||(e[9]=o("p",null,"No se encontraron roles",-1)),e[10]||(e[10]=o("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):b("",!0)],512)):b("",!0)]),o("div",_e,[o("div",he,[o("h3",ke,"Roles seleccionados ("+f(a.value.length)+")",1),a.value.length>0?(i(),u("button",{key:0,onClick:O,class:"flex items-center gap-1 text-xs text-red-500 hover:text-red-700"},[l(r(D),{size:12}),e[11]||(e[11]=y(" Limpiar todos "))])):b("",!0)]),o("div",{class:q(["min-h-[100px] rounded-lg border-2 border-dashed border-gray-200 p-4 transition-colors",{"border-green-300 bg-green-50":a.value.length>0,"bg-gray-50":a.value.length===0}])},[a.value.length===0?(i(),u("div",we,[l(r(F),{size:32,class:"mx-auto mb-2 text-gray-300"}),e[12]||(e[12]=o("p",{class:"text-sm text-gray-500"},"Busca y selecciona roles para agregar",-1)),e[13]||(e[13]=o("p",{class:"mt-1 text-xs text-gray-400"},"Usa las flechas y Enter para seleccionar rápido",-1))])):b("",!0),o("div",Ce,[(i(!0),u(C,null,U(a.value,s=>(i(),P(r(se),{key:s.instanceId,variant:"secondary",class:"group cursor-pointer bg-green-100 pr-2 text-green-800 transition-colors hover:bg-green-200",onClick:n=>X(s.instanceId)},{default:m(()=>[y(f(s.name)+" ",1),l(r(D),{size:14,class:"ml-1 opacity-0 transition-opacity group-hover:opacity-100",title:"Remover rol"})]),_:2},1032,["onClick"]))),128))])],2)]),o("div",$e,[o("span",null,f(a.value.length)+" rol"+f(a.value.length!==1?"es":"")+" seleccionado"+f(a.value.length!==1?"s":""),1),a.value.length>0?(i(),u("span",Re," Listo para asignar ")):b("",!0)])])),l(r(oe),{class:"flex gap-2 sm:gap-0"},{default:m(()=>[l(A,{variant:"outline",onClick:e[3]||(e[3]=s=>_.value=!1),disabled:p.value,class:"flex-1 sm:flex-none"},{default:m(()=>e[14]||(e[14]=[y(" Cancelar ")])),_:1},8,["disabled"]),l(A,{type:"submit",onClick:H,disabled:r(h).processing||a.value.length===0||p.value,class:q(["flex-1 bg-green-500 text-white transition-all duration-200 hover:bg-green-600 disabled:cursor-not-allowed disabled:bg-gray-300 sm:flex-none",{"cursor-not-allowed opacity-50":a.value.length===0,"animate-pulse":p.value}])},{default:m(()=>[p.value?(i(),u(C,{key:0},[e[15]||(e[15]=o("div",{class:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"},null,-1)),e[16]||(e[16]=y(" Procesando... "))],64)):(i(),u(C,{key:1},[l(r($),{size:16,class:"mr-2"}),y(" Agregar "+f(a.value.length)+" rol"+f(a.value.length!==1?"es":""),1)],64))]),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Je=ce(ze,[["__scopeId","data-v-33e54458"]]);export{Je as default};
