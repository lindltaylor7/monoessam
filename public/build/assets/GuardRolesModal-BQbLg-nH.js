import{d as Q,j as g,C as Z,y as ee,s as T,V as E,g as q,o as i,w as m,a as l,u as r,e as x,c as u,b as o,t as f,i as b,Y as se,F as C,p as P,n as U}from"./app-DRRK01BI.js";import{_ as te}from"./index-DnaS8GEh.js";import{_ as L}from"./index-B6ncOGks.js";import{_ as ae,a as le,b as re,c as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C-gB7tDj.js";import{_ as ne}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DNOwfWfw.js";import{_ as ie}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Dpqj7SKd.js";import{_ as ue}from"./Input.vue_vue_type_script_setup_true_lang-Z__jyveg.js";import{P as $}from"./plus-DdDIEIC-.js";import{c as G}from"./createLucideIcon-CDDhTeDD.js";import{X as V}from"./x-7EKBnId8.js";import{C as ce}from"./circle-alert-BruNxsKS.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Primitive-Cf2KC43s.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-BaNce0Yv.js";import"./useForwardExpose-Xt_Gwdjq.js";import"./DialogTitle-wL9t22AL.js";import"./Teleport-DpX481fS.js";import"./utils-CELd6_U-.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=G("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=G("SearchIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),fe={key:0,class:"flex items-center gap-3 rounded-lg border border-green-200 bg-green-50 p-4"},ge={class:"text-sm text-green-600"},pe={key:1,class:"space-y-4"},ve={class:"relative"},ye={class:"relative"},xe=["onClick","onKeydown"],be={class:"flex-1"},he={key:0,class:"p-4 text-center text-gray-500"},_e={class:"space-y-3"},ke={class:"flex items-center justify-between"},we={class:"text-sm font-medium text-gray-700"},Ce={key:0,class:"py-6 text-center"},$e={class:"flex flex-wrap gap-2"},Re={class:"flex items-center justify-between text-sm text-gray-500"},ze={key:0,class:"font-medium text-green-600"},Ie=Q({__name:"GuardRolesModal",props:{guard:{type:Object,required:!0},roles:{type:Array,default:()=>[]}},emits:["asignRoles"],setup(A,{emit:M}){const R=A,W=M,h=g(!1),c=g(""),a=g([]),d=g(!1),p=g(!1),k=g(!1);let O=0;const _=Z({guard_id:0,roles_ids:[]}),D=ee(()=>{if(!c.value)return R.roles.slice(0,5);const t=c.value.toLowerCase();return R.roles.map(s=>{const n=s.name.toLowerCase();let y=0;return n.startsWith(t)&&(y+=3),n.includes(t)&&(y+=2),n.split(" ").some(w=>w.startsWith(t))&&(y+=1),{role:s,score:y}}).filter(s=>s.score>0).sort((s,n)=>n.score-s.score).slice(0,7).map(s=>s.role)}),j=g(!1);T(c,async(t,e)=>{if(d.value=t.length>0,j.value&&t.length>0){await E();const s=document.querySelector("[data-role-result]");s==null||s.focus()}j.value=!1});const B=t=>{const e={...t,instanceId:++O};a.value.push(e),c.value="",d.value=!1,E(()=>{var s,n;(n=(s=v.value)==null?void 0:s.$el)==null||n.focus()})},X=t=>{a.value=a.value.filter(e=>e.instanceId!==t)},Y=()=>{a.value=[]},K=(t,e)=>{var s,n,y,w;switch(t.key){case"ArrowDown":t.preventDefault();const I=t.target.nextElementSibling;I==null||I.focus();break;case"ArrowUp":t.preventDefault();const S=t.target.previousElementSibling;S!=null&&S.focus()||((n=(s=v.value)==null?void 0:s.$el)==null||n.focus());break;case"Enter":t.preventDefault(),e&&B(e);break;case"Escape":d.value=!1,(w=(y=v.value)==null?void 0:y.$el)==null||w.focus();break}},H=async()=>{if(a.value.length!==0){_.roles_ids=a.value.map(t=>t.id),_.guard_id=R.guard.id,p.value=!0;try{await _.post(route("guards.roles.store")),k.value=!0,setTimeout(()=>{h.value=!1,W("asignRoles",a.value),_.reset(),a.value=[],k.value=!1,p.value=!1},1500)}catch{p.value=!1}}},v=g(null),z=g(null),N=t=>{var e;(e=v.value)!=null&&e.$el&&!v.value.$el.contains(t.target)&&z.value&&!z.value.contains(t.target)&&(d.value=!1)},J=()=>{d.value=!0};return T(h,t=>{t?(d.value=!1,document.addEventListener("click",N),E(()=>{var e,s;(s=(e=v.value)==null?void 0:e.$el)==null||s.focus()}),a.value=[]):(document.removeEventListener("click",N),d.value=!1,c.value="",a.value=[],k.value=!1,p.value=!1)}),(t,e)=>(i(),q(r(oe),{open:h.value,"onUpdate:open":e[4]||(e[4]=s=>h.value=s)},{default:m(()=>[l(r(ie),null,{default:m(()=>[l(L,{class:"h-auto bg-green-500 text-white transition-colors duration-200 hover:bg-green-400"},{default:m(()=>[l(r($),{size:16,class:"mr-2"}),e[5]||(e[5]=x(" Agregar roles"))]),_:1})]),_:1}),l(r(ae),{class:"max-w-md sm:max-w-lg"},{default:m(()=>[l(r(le),null,{default:m(()=>[l(r(re),{class:"flex items-center gap-2"},{default:m(()=>[l(r($),{size:20,class:"text-green-500"}),x(" Asignar roles a "+f(A.guard.name),1)]),_:1}),e[6]||(e[6]=o("p",{class:"mt-1 text-sm text-gray-500"},"Puedes agregar múltiples instancias del mismo rol",-1))]),_:1}),k.value?(i(),u("div",fe,[l(r(me),{size:20,class:"flex-shrink-0 text-green-500"}),o("div",null,[e[7]||(e[7]=o("p",{class:"font-medium text-green-800"},"Roles asignados correctamente",-1)),o("p",ge,"Se han agregado "+f(a.value.length)+" roles a la guardia",1)])])):(i(),u("div",pe,[o("div",ve,[o("div",ye,[l(r(F),{size:18,class:"absolute top-1/2 left-3 -translate-y-1/2 transform text-gray-400"}),l(r(ue),{ref_key:"searchInputRef",ref:v,placeholder:"Buscar roles (ej: Líder, Supervisor...)",modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"w-full pr-10 pl-10",onClick:J,onKeydown:[e[1]||(e[1]=se(s=>d.value=!1,["esc"])),K],autocomplete:"off"},null,8,["modelValue"]),c.value?(i(),u("button",{key:0,onClick:e[2]||(e[2]=s=>{c.value="",d.value=!1}),class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[l(r(V),{size:16})])):b("",!0)]),d.value?(i(),u("div",{key:0,ref_key:"resultsContainerRef",ref:z,class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},[(i(!0),u(C,null,P(D.value,s=>(i(),u("div",{key:s.id,"data-role-result":!0,onClick:n=>B(s),onKeydown:n=>K(n,s),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[l(r($),{size:16,class:"flex-shrink-0 text-green-500"}),o("span",be,f(s.name),1),e[8]||(e[8]=o("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,xe))),128)),D.value.length===0&&c.value?(i(),u("div",he,[l(r(ce),{size:20,class:"mx-auto mb-2 text-gray-400"}),e[9]||(e[9]=o("p",null,"No se encontraron roles",-1)),e[10]||(e[10]=o("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):b("",!0)],512)):b("",!0)]),o("div",_e,[o("div",ke,[o("h3",we,"Roles seleccionados ("+f(a.value.length)+")",1),a.value.length>0?(i(),u("button",{key:0,onClick:Y,class:"flex items-center gap-1 text-xs text-red-500 hover:text-red-700"},[l(r(V),{size:12}),e[11]||(e[11]=x(" Limpiar todos "))])):b("",!0)]),o("div",{class:U(["min-h-[100px] rounded-lg border-2 border-dashed border-gray-200 p-4 transition-colors",{"border-green-300 bg-green-50":a.value.length>0,"bg-gray-50":a.value.length===0}])},[a.value.length===0?(i(),u("div",Ce,[l(r(F),{size:32,class:"mx-auto mb-2 text-gray-300"}),e[12]||(e[12]=o("p",{class:"text-sm text-gray-500"},"Busca y selecciona roles para agregar",-1)),e[13]||(e[13]=o("p",{class:"mt-1 text-xs text-gray-400"},"Usa las flechas y Enter para seleccionar rápido",-1))])):b("",!0),o("div",$e,[(i(!0),u(C,null,P(a.value,s=>(i(),q(r(te),{key:s.instanceId,variant:"secondary",class:"group cursor-pointer bg-green-100 pr-2 text-green-800 transition-colors hover:bg-green-200",onClick:n=>X(s.instanceId)},{default:m(()=>[x(f(s.name)+" ",1),l(r(V),{size:14,class:"ml-1 opacity-0 transition-opacity group-hover:opacity-100",title:"Remover rol"})]),_:2},1032,["onClick"]))),128))])],2)]),o("div",Re,[o("span",null,f(a.value.length)+" rol"+f(a.value.length!==1?"es":"")+" seleccionado"+f(a.value.length!==1?"s":""),1),a.value.length>0?(i(),u("span",ze," Listo para asignar ")):b("",!0)])])),l(r(ne),{class:"flex gap-2 sm:gap-0"},{default:m(()=>[l(L,{variant:"outline",onClick:e[3]||(e[3]=s=>h.value=!1),disabled:p.value,class:"flex-1 sm:flex-none"},{default:m(()=>e[14]||(e[14]=[x(" Cancelar ")])),_:1},8,["disabled"]),l(L,{type:"submit",onClick:H,disabled:r(_).processing||a.value.length===0||p.value,class:U(["flex-1 bg-green-500 text-white transition-all duration-200 hover:bg-green-600 disabled:cursor-not-allowed disabled:bg-gray-300 sm:flex-none",{"cursor-not-allowed opacity-50":a.value.length===0,"animate-pulse":p.value}])},{default:m(()=>[p.value?(i(),u(C,{key:0},[e[15]||(e[15]=o("div",{class:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"},null,-1)),e[16]||(e[16]=x(" Procesando... "))],64)):(i(),u(C,{key:1},[l(r($),{size:16,class:"mr-2"}),x(" Agregar "+f(a.value.length)+" rol"+f(a.value.length!==1?"es":""),1)],64))]),_:1},8,["disabled","class"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),Ye=de(Ie,[["__scopeId","data-v-b083082d"]]);export{Ye as default};
