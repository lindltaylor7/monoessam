import{_ as A}from"./index-DP0zSKu9.js";import{_ as ie,a as re,b as ce,c as ue}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DCmGcyu6.js";import{_ as de}from"./DialogDescription.vue_vue_type_script_setup_true_lang-s2SwQXtz.js";import{_ as fe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Dk4vx6cu.js";import{_ as pe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Co-0CexR.js";import{c as me,_ as ve,a as $,b as j}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-C66yvjPO.js";import{_ as be}from"./AlertErrors.vue_vue_type_script_setup_true_lang-CNZHHAbA.js";import{j as b,C as ge,d as _e,s as K,g as C,o as D,w as o,a as i,u as l,e as x,b as P,i as Q}from"./app-b9Q6WyoX.js";import{_ as xe}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-CXP8_YHX.js";import{_ as he}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-B3pqrSt1.js";import{_ as ye}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CN0WSBEJ.js";import{_ as Ie}from"./SizesTab.vue_vue_type_script_setup_true_lang-BOmfnQJt.js";import{P as Fe}from"./pencil-DBzflcpJ.js";const Ce=9*1024*1024;function De(){const s=b(!1),c=b(""),d=b([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:d,showAlert:s,alertMessage:c,handleFileUpload:(I,m,h)=>{const v=I.target.files;if(v.length>0){const _=v[0];if(_.size>Ce)c.value="El archivo es demasiado grande. El máximo es 9MB.",s.value=!0;else{const F=d.value.find(n=>n.label==m);if(F){const f=_.name.split(".").pop(),r=new File([_],`${m}_${Date.now()}.${f}`,{type:_.type});h.push({file:r,label:m}),F.file=r}}}},handleDateFile:(I,m)=>{d.value[m].expirationDate=I}}}function Ue(){const s=b(null),c=b(null),d=b(null);return{fileInput:s,imagePreview:c,selectedFile:d,triggerFileInput:()=>{var m;(m=s.value)==null||m.click()},handleImageUpload:m=>{var _;const v=(_=m.target.files)==null?void 0:_[0];if(v){if(!v.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const F=5*1024*1024;if(v.size>F){alert("La imagen es demasiado grande. Máximo 5MB");return}d.value=v;const n=new FileReader;n.onload=f=>{var r;c.value=(r=f.target)==null?void 0:r.result},n.readAsDataURL(v)}},removeImage:()=>{c.value=null,d.value=null,s.value&&(s.value.value="")},selectedFile:d}}function ke(){const s=ge({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0,workplace:""}),c=b([]),d=b(!1),u=b([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),a=b([]);return{form:s,errorsSend:c,showErrors:d,prendasFijas:u,cafesUnitSelected:a,handleSubmit:(n,f)=>{let r;Array.isArray(f)?r=f:f&&typeof f=="object"?r=Array.isArray(f.value)?f.value:Object.values(f):r=[],r.forEach(p=>{p&&p.expirationDate===null?s.filesData.push({expirationDate:"-"}):s.filesData.push({expirationDate:p.expirationDate})}),console.log("filesArray:",r);const U=r.filter(p=>p&&typeof p=="object").map(p=>p.file).filter(p=>p instanceof File);console.log("Archivos válidos a subir:",U.length,U),s.prendas=u.value,s.files=U,s.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:p=>{s.reset(),n()},onError:p=>{d.value=!0,c.value=p,console.error("Error al subir el archivo:",p)}})},updateStaff:(n,f)=>{console.log(s),s.prendas=u.value,s.transform(r=>({...r,_method:"PUT"})).post(route("staff.update",f),{forceFormData:!0,onSuccess:r=>{n()},onError:r=>{d.value=!0,c.value=r,console.error("Error al subir el archivo:",r)}})},selectCafe:n=>{s.cafeId=n.id},selectRole:n=>{s.roleId=n.id},selectUnit:n=>{s.unitId=n.id,a.value=n.cafes,s.unitSelectedText=n.name},selectArea:n=>{s.areaId=n}}}const Ae={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Se=_e({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(s){const c=s,d=b(!1),u=b("personal"),{form:a,errorsSend:I,showErrors:m,prendasFijas:h,cafesUnitSelected:v,handleSubmit:_,updateStaff:F,selectCafe:n,selectRole:f,selectUnit:r,selectArea:U}=ke(),{fileInput:p,imagePreview:E,triggerFileInput:Y,handleImageUpload:R,removeImage:q,selectedFile:ee}=Ue();K(()=>c.staff,e=>{var t,y,B,V,N,O,L,S,G,W,Z,w,X,H,J;if(e){if(console.log(e),a.name=e.name,a.dni=e.dni,a.cell=e.cell,a.birthdate=String(e.birthdate),a.age=e.age,a.sex=String(e.sex),a.email=e.email,a.country=e.country,a.civilstatus=String(e.civilstatus),a.contactname=e.contactname,a.contactcell=e.contactcell,a.district=(t=e.staff_financial)==null?void 0:t.district,a.province=(y=e.staff_financial)==null?void 0:y.province,a.department=(B=e.staff_financial)==null?void 0:B.department,a.address=(V=e.staff_financial)==null?void 0:V.address,a.workSystem=(N=e.staff_financial)==null?void 0:N.system_work,a.replacement=(O=e.staff_financial)==null?void 0:O.replacement,a.salary=(L=e.staff_financial)==null?void 0:L.salary,a.observations=(S=e.staff_financial)==null?void 0:S.observations,a.bankEntity=String((G=e.staff_financial)==null?void 0:G.bank_entity),a.cc=(W=e.staff_financial)==null?void 0:W.account_number,a.cci=(Z=e.staff_financial)==null?void 0:Z.cci,a.pensioncontribution=String((w=e.staff_financial)==null?void 0:w.pensioncontribution),a.startDate=String((X=e.staff_financial)==null?void 0:X.start_date),a.contractEndDate=String((H=e.staff_financial)==null?void 0:H.contract_end_date),a.children=(J=e.staff_financial)==null?void 0:J.children,h.value.forEach(g=>g.talla=""),e.staff_clothes.forEach(g=>{const k=h.value.find(T=>T.label==g.clothe_name);k&&(k.talla=g.clothing_size)}),a.roleId=e.role_id,e.staffable_type=="App\\Models\\Cafe"){a.workplace="2",a.cafeId=e.staffable_id;const g=e.staffable;if(g&&g.unit){a.unitId=g.unit.id;const k=c.units.find(T=>T.id===g.unit.id);k&&(v.value=k.cafes)}}else e.staffable_type=="App\\Models\\Area"?(a.workplace="1",a.areaId=e.staffable_id):(a.workplace=0,a.cafeId=null,a.unitId=0,a.areaId=0);console.log(a.workplace),e.photo?E.value=e.photo.url.startsWith("http")?e.photo.url:`/storage/${e.photo.url}`:E.value=null}else a.reset(),a.workplace=0,E.value=null,h.value.forEach(g=>g.talla="")},{immediate:!0}),K(ee,e=>{a.photo=e});const{filesRequired:z,showAlert:ae,alertMessage:le,handleFileUpload:M,handleDateFile:te}=De(),se=()=>{const e=["personal","adjuntos","financiero","tallas"],t=e.indexOf(u.value);c.staff&&t==0?u.value=e[t+2]:t<e.length-1&&(u.value=e[t+1])},oe=()=>{const e=["personal","adjuntos","financiero","tallas"],t=e.indexOf(u.value);c.staff&&t==2?u.value=e[t-2]:t>0&&(u.value=e[t-1])},ne=()=>{c.staff?F(()=>{d.value=!1,u.value="personal"},c.staff.id):_(()=>{d.value=!1,u.value="personal"},z)};return(e,t)=>(D(),C(l(ue),{open:d.value,"onUpdate:open":t[2]||(t[2]=y=>d.value=y)},{default:o(()=>[i(l(pe),{"as-child":""},{default:o(()=>[c.staff?(D(),C(l(A),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:o(()=>[i(l(Fe))]),_:1})):(D(),C(l(A),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:o(()=>t[3]||(t[3]=[x(" Nuevo Personal ")])),_:1}))]),_:1}),i(l(ie),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:o(()=>[P("input",{type:"file",ref_key:"fileInput",ref:p,onChange:t[0]||(t[0]=(...y)=>l(R)&&l(R)(...y)),accept:"image/*",class:"hidden"},null,544),i(l(re),{class:"z-10 border-b bg-white px-6 py-4"},{default:o(()=>[i(l(ce),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:o(()=>t[4]||(t[4]=[x(" Ficha de Registro de Colaborador ")])),_:1}),i(l(de),null,{default:o(()=>t[5]||(t[5]=[x(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),i(be,{show:l(m),errors:l(I)},null,8,["show","errors"])]),_:1}),P("div",Ae,[i(l(me),{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=y=>u.value=y),class:"w-full"},{default:o(()=>[i(l(ve),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:o(()=>[i(l($),{value:"personal",class:"text-xs md:text-sm"},{default:o(()=>t[6]||(t[6]=[x("Personal")])),_:1}),e.staff?Q("",!0):(D(),C(l($),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:o(()=>t[7]||(t[7]=[x("Adjuntos")])),_:1})),i(l($),{value:"financiero",class:"text-xs md:text-sm"},{default:o(()=>t[8]||(t[8]=[x("Financiero")])),_:1}),i(l($),{value:"tallas",class:"text-xs md:text-sm"},{default:o(()=>t[9]||(t[9]=[x("Tallas")])),_:1})]),_:1}),i(l(j),{value:"personal",class:"mt-0"},{default:o(()=>[i(ye,{staff:e.staff,form:l(a),cafes:l(v),units:e.units,roles:e.roles,businneses:e.businneses,"image-preview":l(E),onTriggerUpload:l(Y),onRemoveImage:l(q),onSelectCafe:l(n),onSelectUnit:l(r),onSelectRole:l(f),onSelectArea:l(U)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),i(l(j),{value:"adjuntos",class:"mt-0"},{default:o(()=>[i(xe,{"files-required":l(z),"show-alert":l(ae),"alert-message":l(le),form:l(a),onUploadFile:l(M),onUploadDate:l(te)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),i(l(j),{value:"financiero",class:"mt-0"},{default:o(()=>[i(he,{form:l(a),roles:e.roles,onSelectRole:l(f),onUploadFile:l(M),staff:e.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),i(l(j),{value:"tallas",class:"mt-0"},{default:o(()=>[i(Ie,{prendas:l(h)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),i(l(fe),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:o(()=>[P("div",null,[u.value!=="personal"?(D(),C(l(A),{key:0,onClick:oe,variant:"outline",type:"button"},{default:o(()=>t[10]||(t[10]=[x(" ← Anterior ")])),_:1})):Q("",!0)]),P("div",null,[u.value!=="tallas"?(D(),C(l(A),{key:0,onClick:se,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:o(()=>t[11]||(t[11]=[x(" Siguiente → ")])),_:1})):(D(),C(l(A),{key:1,onClick:ne,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:o(()=>t[12]||(t[12]=[x(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Se as _};
