import{d as Y,k as Z,r as f,C,s as K,g as L,o as c,w as d,a as n,u as i,b as e,e as m,i as v,t as p,c as u,F as B,l as N,E as T,bP as ee,n as O}from"./app-B_X2URcC.js";import{_ as te,a as ae,b as se}from"./index-DBHoJt6h.js";import{_ as y}from"./index-CTH2T4zU.js";import{_ as oe,a as ne,b as ie,c as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-MWgCHA31.js";import{_ as le}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B9_t91x9.js";import{_ as ce}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BD94KX-q.js";import{F as S,U as de}from"./upload-BrihE277.js";import{C as U}from"./calendar-B8fqe1sf.js";import{E as ue}from"./eye-f6GmzPK_.js";import{X as pe}from"./x-YF0p4YfW.js";const me={class:"flex-1 space-y-4 overflow-y-auto pr-2"},fe={class:"rounded-lg bg-blue-50 p-4"},xe={class:"flex items-center space-x-3"},_e={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100"},ve={class:"font-medium text-gray-900"},ge={class:"space-y-6"},he={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},be={class:"mb-3 flex items-center justify-between"},ye={class:"flex items-center space-x-3"},Ee={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100"},we={class:"text-sm font-medium"},ke={class:"font-medium text-gray-900"},Ce={class:"flex items-center space-x-2 text-sm text-gray-500"},Se={key:0,class:"inline-flex items-center"},De=["onUpdate:modelValue","min"],je={key:0},ze={key:1,class:"inline-flex items-center"},Fe=["accept","data-file-type","onChange"],$e={key:0,class:"space-y-2"},Ve={class:"flex items-center justify-between"},Ie={class:"flex items-center space-x-3"},Me={class:"flex items-center space-x-2"},Le={class:"text-sm font-medium text-gray-700"},Be={key:0,class:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"},Ne={class:"mt-1 space-y-1 text-xs text-gray-500"},Oe={class:"flex items-center space-x-2"},Ue={key:0},Ae={key:1,class:"inline-flex items-center"},qe={class:"flex items-center space-x-1"},Pe={key:0,class:"mr-2"},Ge=["value","onChange","min"],Re={key:1,class:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center"},He={class:"flex w-full items-center justify-between"},Je={class:"text-sm text-gray-500"},Xe={class:"font-medium"},nt=Y({__name:"FilesModal",props:{staff:{type:Object,required:!0}},emits:["update-files"],setup(D,{emit:Qe}){var F;const x=D,A=Z(),E=f(!1),_=f(!1),g=f(""),w=f(null);f(null),f("");const b=f([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1},{label:"Certificado Ãšnico Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"DNI escaneado",key:"dni_escaneado",accept:".pdf,.jpg,.jpeg,.png",maxSize:5,hasExpiration:!0,expirationDate:null},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"CarnÃ© de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"CarnÃ© de vacunaciÃ³n contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null}]),q=C({staff_id:x.staff.id,files:[],user_id:(F=A.props.auth.user)==null?void 0:F.id}),P=(o,t,a)=>{var V,I,M;const l=o.target;if(!l.files||l.files.length===0)return;const s=l.files[0],r=b.value.find(h=>h.label===t);if(!r)return;if(s.size>r.maxSize*1024*1024){_.value=!0,g.value=`El archivo excede el tamaÃ±o mÃ¡ximo de ${r.maxSize}MB`,l.value="";return}const Q=r.accept.split(",").map(h=>h.trim().toLowerCase()),W="."+((V=s.name.split(".").pop())==null?void 0:V.toLowerCase());if(!Q.includes(W)){_.value=!0,g.value=`Tipo de archivo no vÃ¡lido. Formatos aceptados: ${r.accept}`,l.value="";return}w.value=t;const $=(M=(I=x.staff.staff_files)==null?void 0:I.find(h=>h.file_type==t))==null?void 0:M.id;if(r.hasExpiration&&r.expirationDate==null){alert("Es necesario colocar la fecha de expiraciÃ³n a este archivo");return}else!r.hasExpiration&&r.expirationDate==null?j(s,{fileTypeKey:t,fileFoundId:$}):r.hasExpiration&&r.expirationDate!=null&&j(s,{fileTypeKey:t,fileFoundId:$},r.expirationDate);l.value=""},j=(o,t,a)=>{console.log(a),C({file:o,fileTypeKey:t.fileTypeKey||t.fileLabel,expirationDate:a,fileId:t.fileFoundId??0,staffId:x.staff.id}).post(route("staff.upload-file"),{forceFormData:!0,preserveState:!0,onSuccess:s=>{alert("Archivo actualizado correctamente")},onError:s=>{_.value=!0,g.value="Error en la conexiÃ³n",console.error(error)}})},G=o=>{confirm("Â¿EstÃ¡ seguro de eliminar este archivo?")&&q.delete(route("staff.delete-file",o),{onSuccess:()=>{alert("Archivo eliminado correctamente")},onError:t=>{_.value=!0,g.value="Error en la conexiÃ³n",console.error(t)}})},R=o=>{window.open("/storage/"+o.file_path,"_blank")},H=(o,t)=>{C({fileId:o,expirationDate:t}).post(route("staff.update-filedate"),{onSuccess:()=>{alert("Fecha actualizada correctamente")},onError:l=>{alert("Error en la actualizacion")}})},k=K(()=>{const o={};return b.value.forEach(t=>{o[t.label]=[]}),x.staff.staff_files&&x.staff.staff_files.forEach(t=>{const a=b.value.find(l=>l.label===t.file_type);a&&o[a.label].push(t)}),o}),J=o=>new Date(o).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),X=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",z=o=>o?new Date(o)<new Date:!1;return(o,t)=>(c(),L(i(re),{open:E.value,"onUpdate:open":t[2]||(t[2]=a=>E.value=a)},{default:d(()=>[n(i(ce),{"as-child":""},{default:d(()=>[n(y,{variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:d(()=>[n(i(S),{class:"h-4 w-4"})]),_:1})]),_:1}),n(i(oe),{class:"flex max-h-[90vh] w-full flex-col sm:max-w-[900px]"},{default:d(()=>[n(i(ne),{class:"shrink-0 border-b pb-3"},{default:d(()=>[n(i(ie),null,{default:d(()=>t[3]||(t[3]=[m("GestiÃ³n de Documentos del Personal")])),_:1})]),_:1}),e("div",me,[e("div",fe,[e("div",xe,[e("div",_e,[n(i(S),{class:"h-5 w-5 text-blue-600"})]),e("div",null,[e("h3",ve,p(D.staff.name),1),t[4]||(t[4]=e("p",{class:"text-sm text-gray-600"},"GestiÃ³n de documentos y archivos",-1))])])]),t[12]||(t[12]=e("div",{class:"rounded-lg border border-amber-200 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 mr-3"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-600"},"!")]),e("div",null,[e("h4",{class:"text-sm font-medium text-amber-800"},"AtenciÃ³n"),e("p",{class:"mt-1 text-sm text-amber-700"}," AsegÃºrese de que los archivos sean legibles (PDF, DOC, JPG, PNG) y que pesen menos de 10MB. Los documentos marcados con ðŸ“… requieren fecha de expiraciÃ³n. ")])])],-1)),_.value?(c(),L(i(te),{key:0,variant:"destructive",class:"relative"},{default:d(()=>[e("button",{class:"absolute top-3 right-3 text-sm",onClick:t[0]||(t[0]=a=>_.value=!1)},"âœ•"),n(i(ae),null,{default:d(()=>t[5]||(t[5]=[m("Error")])),_:1}),n(i(se),null,{default:d(()=>[m(p(g.value),1)]),_:1})]),_:1})):v("",!0),e("div",ge,[(c(!0),u(B,null,N(b.value,(a,l)=>(c(),u("div",{key:l,class:"space-y-3"},[e("div",he,[e("div",be,[e("div",ye,[e("div",Ee,[e("span",we,p(l+1),1)]),e("div",null,[e("h4",ke,p(a.label),1),e("div",Ce,[e("span",null,"Formatos: "+p(a.accept.replace(/\./g,"").toUpperCase()),1),t[7]||(t[7]=e("span",null,"â€¢",-1)),e("span",null,"MÃ¡x: "+p(a.maxSize)+"MB",1),a.hasExpiration?(c(),u("span",Se,[n(i(U),{class:"ml-2 h-4 w-4 text-amber-600"}),t[6]||(t[6]=e("span",{class:"ml-1 text-amber-600"},"Requiere fecha",-1)),T(e("input",{type:"date","onUpdate:modelValue":s=>a.expirationDate=s,class:"ms-1 rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,8,De),[[ee,a.expirationDate]])])):v("",!0)])])]),e("label",{class:O(["cursor-pointer rounded-md px-4 py-2 text-sm font-medium transition-colors",w.value===a.key?"cursor-not-allowed bg-blue-400 text-white":"bg-blue-600 text-white hover:bg-blue-700"])},[w.value===a.key?(c(),u("span",je,t[8]||(t[8]=[e("span",{class:"inline-flex items-center"},[e("svg",{class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),m(" Subiendo... ")],-1)]))):(c(),u("span",ze,[n(i(de),{class:"mr-2 h-4 w-4"}),t[9]||(t[9]=m(" Subir "))])),e("input",{type:"file",accept:a.accept,class:"hidden","data-file-type":a.key,onChange:s=>P(s,a.label,l)},null,40,Fe)],2)]),k.value[a.label]&&k.value[a.label].length>0?(c(),u("div",$e,[(c(!0),u(B,null,N(k.value[a.label],s=>(c(),u("div",{key:s.id,class:O(["rounded-lg border p-3 transition-colors",z(s.expiration_date)?"border-red-200 bg-red-50":"border-green-200 bg-green-50"])},[e("div",Ve,[e("div",Ie,[e("div",null,[e("div",Me,[e("p",Le,p(s.path),1),z(s.expiration_date)?(c(),u("span",Be," VENCIDO ")):v("",!0)]),e("div",Ne,[e("p",null,"Subido: "+p(J(s.created_at)),1),e("div",Oe,[s.user_name?(c(),u("span",Ue,"Por: "+p(s.user_name),1)):v("",!0),a.hasExpiration?(c(),u("span",Ae,[n(i(U),{class:"mr-1 h-3 w-3"}),m(" Vence: "+p(X(s.expiration_date)),1)])):v("",!0)])])])]),e("div",qe,[a.hasExpiration?(c(),u("div",Pe,[e("input",{type:"date",value:s.expiration_date||"",onChange:r=>H(s.id,r.target.value),class:"rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,40,Ge)])):v("",!0),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-blue-600 hover:bg-blue-100",onClick:r=>R(s),title:"Vista previa"},{default:d(()=>[n(i(ue),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600 hover:bg-red-100",onClick:r=>G(s.id),title:"Eliminar"},{default:d(()=>[n(i(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])],2))),128))])):(c(),u("div",Re,[n(i(S),{class:"mx-auto h-8 w-8 text-gray-400"}),t[10]||(t[10]=e("p",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay archivos subidos",-1)),t[11]||(t[11]=e("p",{class:"mt-1 text-xs text-gray-500"},'Haz clic en "Subir" para agregar un documento',-1))]))])]))),128))])]),n(i(le),{class:"border-t pt-4"},{default:d(()=>{var a;return[e("div",He,[e("div",Je,[e("span",Xe,p(((a=x.staff.staff_files)==null?void 0:a.length)||0),1),t[13]||(t[13]=m(" archivos en total "))]),n(y,{variant:"outline",onClick:t[1]||(t[1]=l=>E.value=!1)},{default:d(()=>t[14]||(t[14]=[m("Cerrar")])),_:1})])]}),_:1})]),_:1})]),_:1},8,["open"]))}});export{nt as _};
