import{_ as k}from"./index-V6DVQKWY.js";import{_ as te,a as ne,b as se,c as oe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DuE_IA5R.js";import{_ as ie}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DiI_EKP_.js";import{_ as re}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B8pdQ50R.js";import{_ as ce}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-C5AADT_U.js";import{_ as ue,a as de,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-gGCSoVAO.js";import{_ as T}from"./TabsContent.vue_vue_type_script_setup_true_lang-U1EJ0hrd.js";import{_ as fe}from"./AlertErrors.vue_vue_type_script_setup_true_lang-D6SKrF4I.js";import{r as x,C as pe,d as me,s as be,q as A,g as C,o as y,w as r,a as u,u as l,e as I,b as V,v as ve,i as O,n as ge,c as _e}from"./app-B1UaLdox.js";import{_ as he}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-BYYjE3qq.js";import{_ as xe}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-DBaPzIUb.js";import{_ as Se}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CAWsSogT.js";import{_ as Ie}from"./SizesTab.vue_vue_type_script_setup_true_lang-gmlJE-Jf.js";import{P as ye}from"./pencil-BbRtOs6y.js";const Ce=15*1024*1024;function we(){const e=x(!1),t=x(""),c=x([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:e,alertMessage:t,handleFileUpload:(S,m,a)=>{const s=S.target.files;if(s.length>0){const o=s[0];if(o.size>Ce)t.value="El archivo es demasiado grande. El máximo es 15MB.",e.value=!0;else{const h=c.value.find(v=>v.label==m);if(h){const i=o.name.split(".").pop(),f=new File([o],`${m}_${Date.now()}.${i}`,{type:o.type});a.push({file:f,label:m}),h.file=f}}}},handleDateFile:(S,m)=>{c.value[m].expirationDate=S}}}function De(){const e=x(null),t=x(null),c=x(null);return{fileInput:e,imagePreview:t,selectedFile:c,triggerFileInput:()=>{var m;(m=e.value)==null||m.click()},handleImageUpload:m=>{var o;const s=(o=m.target.files)==null?void 0:o[0];if(s){if(!s.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const h=5*1024*1024;if(s.size>h){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=s;const v=new FileReader;v.onload=i=>{var f;t.value=(f=i.target)==null?void 0:f.result},v.readAsDataURL(s)}},removeImage:()=>{t.value=null,c.value=null,e.value&&(e.value.value="")}}}function Fe(){const e=pe({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],files:[],areaId:0,workplace:"",guard:""}),t=x([]),c=x(!1),p=x([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),d=x([]);return{form:e,errorsSend:t,showErrors:c,prendasFijas:p,cafesUnitSelected:d,handleSubmit:(i,f)=>{let g;Array.isArray(f)?g=f:f&&typeof f=="object"?g=Array.isArray(f.value)?f.value:Object.values(f):g=[],g.forEach(b=>{b&&b.expirationDate===null?e.filesData.push({expirationDate:"-"}):e.filesData.push({expirationDate:b.expirationDate})}),console.log("filesArray:",g);const D=g.filter(b=>b&&typeof b=="object").map(b=>b.file).filter(b=>b instanceof File);console.log("Archivos válidos a subir:",D.length,D),e.prendas=p.value,e.files=D,e.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:b=>{e.reset(),i()},onError:b=>{c.value=!0,t.value=b,console.error("Error al subir el archivo:",b)}})},updateStaff:(i,f)=>{e.prendas=p.value,e.transform(g=>({...g,_method:"PUT"})).post(route("staff.update",f),{forceFormData:!0,onSuccess:g=>{i()},onError:g=>{c.value=!0,t.value=g,console.error("Error al subir el archivo:",g)}})},selectCafe:i=>{e.cafeId=i.id},selectRole:i=>{e.roleId=i.id},selectUnit:i=>{e.unitId=i.id,d.value=i.cafes,e.unitSelectedText=i.name},selectArea:i=>{e.areaId=i},selectGuard:i=>{e.guard=String(i)}}}function ke(e,t,c,p){const d=(a,s)=>{var o,h;if(!a){m();return}e.name=a.name,e.dni=a.dni,e.cell=a.cell,e.birthdate=String(a.birthdate),e.age=a.age,e.sex=String(a.sex),e.email=a.email,e.country=a.country,e.civilstatus=String(a.civilstatus),e.contactname=a.contactname,e.contactcell=a.contactcell,e.roleId=a.role_id,a.staff_financial&&(e.district=a.staff_financial.district,e.province=a.staff_financial.province,e.department=a.staff_financial.department,e.address=a.staff_financial.address,e.workSystem=a.staff_financial.system_work,e.replacement=a.staff_financial.replacement,e.salary=a.staff_financial.salary,e.observations=a.staff_financial.observations,e.bankEntity=String(a.staff_financial.bank_entity),e.cc=a.staff_financial.account_number,e.cci=a.staff_financial.cci,e.pensioncontribution=String(a.staff_financial.pensioncontribution),e.startDate=String(a.staff_financial.start_date),e.contractEndDate=String(a.staff_financial.contract_end_date),e.children=a.staff_financial.children),t.value.forEach(v=>v.talla=""),a.staff_clothes.forEach(v=>{const i=t.value.find(f=>f.label===v.clothe_name);i&&(i.talla=v.clothing_size)}),S(a,s),e.guard=(h=(o=a.guard_role)==null?void 0:o.guard_selected)==null?void 0:h.name,c.value=a.photo?a.photo.url.startsWith("http")?a.photo.url:`/storage/${a.photo.url}`:null},S=(a,s)=>{if(a.staffable_type==="App\\Models\\Cafe"){e.workplace="2",e.cafeId=a.staffable_id;const o=a.staffable;if(o!=null&&o.unit){e.unitId=o.unit.id;const h=s.find(v=>v.id===o.unit.id);h&&(p.value=h.cafes)}}else a.staffable_type==="App\\Models\\Area"?(e.workplace="1",e.areaId=a.staffable_id):(e.workplace=0,e.cafeId=null,e.unitId=0,e.areaId=0)},m=()=>{e.reset(),e.workplace=0,c.value=null,t.value.forEach(a=>a.talla="")};return{initializeStaffData:d}}function Ue(e){const t=x("personal"),c=["personal","adjuntos","financiero","tallas"],p=()=>e.value?c.filter(s=>s!=="adjuntos"):c;return{activeTab:t,nextTab:()=>{const s=p(),o=s.indexOf(t.value);o<s.length-1&&(t.value=s[o+1])},prevTab:()=>{const s=p(),o=s.indexOf(t.value);o>0&&(t.value=s[o-1])},resetTab:()=>{t.value="personal"},shouldShowTab:s=>p().includes(s)}}const Te={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ae={key:1},Ze=me({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{},roleClothes:{}},setup(e){const t=e,c=x(!1),p=be(()=>!!t.staff),{form:d,errorsSend:S,showErrors:m,prendasFijas:a,cafesUnitSelected:s,handleSubmit:o,updateStaff:h,selectCafe:v,selectRole:i,selectUnit:f,selectArea:g,selectGuard:D}=Fe(),{fileInput:b,imagePreview:E,triggerFileInput:G,handleImageUpload:$,removeImage:L,selectedFile:W}=De(),{filesRequired:z,showAlert:Z,alertMessage:X,handleFileUpload:j,handleDateFile:q}=we(),{initializeStaffData:H}=ke(d,a,E,s),{activeTab:F,nextTab:J,prevTab:K,resetTab:Q,shouldShowTab:R}=Ue(p);A(W,_=>{d.photo=_});const Y=_=>{var M;if(!t.roleClothes||!d.roleId){t.staff||(a.value=[]);return}const n=Number(d.roleId),w=d.cafeId?String(d.cafeId):"all",ae=((M=t.roleClothes[n])==null?void 0:M[w])||[];a.value=ae.map(P=>{let B="";const N=a.value.find(le=>le.label===P.name);return N&&(B=N.talla),{label:P.name,talla:B}})};A(()=>t.staff,_=>{H(_,t.units)},{immediate:!0}),A([()=>d.roleId,()=>d.cafeId],()=>{Y()});const ee=()=>{const _=()=>{c.value=!1,Q()};p.value?h(_,t.staff.id):o(_,z)};return(_,n)=>(y(),C(l(oe),{open:c.value,"onUpdate:open":n[2]||(n[2]=w=>c.value=w)},{default:r(()=>[u(l(ce),{"as-child":""},{default:r(()=>[p.value?(y(),C(l(k),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:r(()=>[u(l(ye))]),_:1})):(y(),C(l(k),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>n[3]||(n[3]=[I(" Nuevo Personal ")])),_:1}))]),_:1}),u(l(te),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:r(()=>[V("input",{type:"file",ref_key:"fileInput",ref:b,onChange:n[0]||(n[0]=(...w)=>l($)&&l($)(...w)),accept:"image/*",class:"hidden"},null,544),u(l(ne),{class:"z-10 border-b bg-white px-6 py-4"},{default:r(()=>[u(l(se),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:r(()=>n[4]||(n[4]=[I(" Ficha de Registro de Colaborador ")])),_:1}),u(l(ie),null,{default:r(()=>n[5]||(n[5]=[I(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),u(fe,{show:l(m),errors:l(S)},null,8,["show","errors"])]),_:1}),V("div",Te,[u(l(ue),{modelValue:l(F),"onUpdate:modelValue":n[1]||(n[1]=w=>ve(F)?F.value=w:null),class:"w-full"},{default:r(()=>[u(l(de),{class:ge(["mb-6 grid w-full bg-zinc-100 p-1",p.value?"grid-cols-3":"grid-cols-4"])},{default:r(()=>[u(l(U),{value:"personal",class:"text-xs md:text-sm"},{default:r(()=>n[6]||(n[6]=[I("Personal")])),_:1}),l(R)("adjuntos")?(y(),C(l(U),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:r(()=>n[7]||(n[7]=[I("Adjuntos")])),_:1})):O("",!0),u(l(U),{value:"financiero",class:"text-xs md:text-sm"},{default:r(()=>n[8]||(n[8]=[I("Financiero")])),_:1}),u(l(U),{value:"tallas",class:"text-xs md:text-sm"},{default:r(()=>n[9]||(n[9]=[I("Tallas")])),_:1})]),_:1},8,["class"]),u(l(T),{value:"personal",class:"mt-0"},{default:r(()=>[u(Se,{staff:_.staff,form:l(d),cafes:l(s),units:_.units,roles:_.roles,businneses:_.businneses,"image-preview":l(E),onTriggerUpload:l(G),onRemoveImage:l(L),onSelectCafe:l(v),onSelectUnit:l(f),onSelectRole:l(i),onSelectArea:l(g),onSelectGuard:l(D)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea","onSelectGuard"])]),_:1}),l(R)("adjuntos")?(y(),C(l(T),{key:0,value:"adjuntos",class:"mt-0"},{default:r(()=>[u(he,{"files-required":l(z),"show-alert":l(Z),"alert-message":l(X),form:l(d),onUploadFile:l(j),onUploadDate:l(q)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1})):O("",!0),u(l(T),{value:"financiero",class:"mt-0"},{default:r(()=>[u(xe,{form:l(d),roles:_.roles,onSelectRole:l(i),onUploadFile:l(j),staff:_.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),u(l(T),{value:"tallas",class:"mt-0"},{default:r(()=>[u(Ie,{prendas:l(a)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),u(l(re),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:r(()=>[l(F)!=="personal"?(y(),C(l(k),{key:0,onClick:l(K),variant:"outline",type:"button"},{default:r(()=>n[10]||(n[10]=[I(" ← Anterior ")])),_:1},8,["onClick"])):(y(),_e("div",Ae)),l(F)!=="tallas"?(y(),C(l(k),{key:2,onClick:l(J),type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>n[11]||(n[11]=[I(" Siguiente → ")])),_:1},8,["onClick"])):(y(),C(l(k),{key:3,onClick:ee,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:r(()=>n[12]||(n[12]=[I(" Finalizar Registro ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ze as _};
