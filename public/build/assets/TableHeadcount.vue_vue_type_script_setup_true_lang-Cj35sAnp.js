import{d as Q,C as R,j as w,c as b,o as d,b as o,a as l,E as N,bQ as j,w as a,u as t,e as i,F as v,p as g,g as y,t as p,h as q,i as J,n as K,y as k}from"./app-DQ0sg1ny.js";import{_ as W}from"./index-BVausCie.js";import{a as F,b as X,c as P,d as m,_ as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-CDvApbBA.js";import{_ as Y,a as Z}from"./SelectLabel.vue_vue_type_script_setup_true_lang-yloaYE-m.js";import{_ as ee,a as L,b as V,c as te,d as E,e as ae}from"./TableHeader.vue_vue_type_script_setup_true_lang-Drc_3Qgo.js";import{T as S}from"./trash-CWVB-1eS.js";const le={class:"space-y-4"},se={class:"flex items-end gap-4 rounded-lg border bg-gray-50 p-4"},oe={class:"flex flex-col gap-1"},ne={class:"flex flex-col gap-1"},re={class:"flex flex-col gap-1"},ie={class:"flex flex-col items-center justify-center gap-1"},de=["onClick"],ue={class:"mt-1 flex justify-center"},fe=["onClick"],ve=Q({__name:"TableHeadcount",props:{users:{},cafeId:{},periods:{},guards:{}},emits:["fetchCafeData"],setup(B,{emit:M}){const u=B,C=M,f=R({cafe_id:0,start_date:"",end_date:"",status:"0",users:[]}),_=w(""),x=w("");w([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);const T={1:{label:"Trabajando",color:"bg-green-400 hover:bg-green-500"},2:{label:"Libre",color:"bg-blue-400 hover:bg-blue-500"},3:{label:"Falta",color:"bg-red-400 hover:bg-red-500"},4:{label:"Nuevo",color:"bg-zinc-400 hover:bg-zinc-500"},default:{label:"Pendiente",color:"bg-zinc-200 hover:bg-zinc-300"}},h=n=>T[n]||T.default,D=(n,e)=>{var r;const s=e.staffs.find($=>$.id===(n==null?void 0:n.id));return(r=s==null?void 0:s.pivot)!=null&&r.status?String(s.pivot.status):void 0},I=n=>{if(!n)return"";const[e,s,r]=n.split("-");return`${r}/${s}/${e}`},O=()=>{if(!_.value||!x.value){alert("Por favor selecciona ambas fechas");return}f.cafe_id=u.cafeId,f.start_date=_.value,f.end_date=x.value,f.users=u.users,k.post("/periods",f).then(()=>{C("fetchCafeData",u.cafeId),_.value="",x.value="",f.status="0"}).catch(n=>console.error(n))},z=n=>{confirm("¿Está seguro de eliminar este periodo?")&&k.delete("/periods/"+n).then(()=>C("fetchCafeData",u.cafeId)).catch(e=>console.error(e))},A=n=>{console.log(n)},G=(n,e,s)=>{k.put(`/periods/user/${s}`,{staff_id:e,period_id:s,status:n}).then(()=>{C("fetchCafeData",u.cafeId)}).catch(r=>{console.error("Error actualizando estado:",r),alert("No se pudo actualizar el estado")})};return(n,e)=>(d(),b("div",le,[o("div",se,[o("div",oe,[e[3]||(e[3]=o("label",{class:"text-sm font-medium text-gray-700"},"Fecha Inicio",-1)),N(o("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),class:"rounded border px-3 py-2 text-sm"},null,512),[[j,_.value]])]),o("div",ne,[e[4]||(e[4]=o("label",{class:"text-sm font-medium text-gray-700"},"Fecha Fin",-1)),N(o("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),class:"rounded border px-3 py-2 text-sm"},null,512),[[j,x.value]])]),o("div",re,[e[9]||(e[9]=o("label",{class:"text-sm font-medium text-gray-700"},"Estado Inicial",-1)),l(t(U),{modelValue:t(f).status,"onUpdate:modelValue":e[2]||(e[2]=s=>t(f).status=s)},{default:a(()=>[l(t(F),null,{default:a(()=>[l(t(X),{placeholder:"Estado"})]),_:1}),l(t(P),null,{default:a(()=>[l(t(m),{value:"1"},{default:a(()=>e[5]||(e[5]=[i("Trabajando")])),_:1}),l(t(m),{value:"2"},{default:a(()=>e[6]||(e[6]=[i("Libre")])),_:1}),l(t(m),{value:"3"},{default:a(()=>e[7]||(e[7]=[i("Falta")])),_:1}),l(t(m),{value:"4"},{default:a(()=>e[8]||(e[8]=[i("Nuevo")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("button",{onClick:O,class:"h-10 rounded bg-black px-4 py-2 text-sm text-white transition hover:bg-gray-800"}," Agregar Periodo ")]),l(t(ae),null,{default:a(()=>[l(t(ee),null,{default:a(()=>[l(t(L),null,{default:a(()=>[l(t(V),{class:"w-[150px] font-bold"},{default:a(()=>e[10]||(e[10]=[i(" Guardia ")])),_:1}),l(t(V),{class:"w-[150px] font-bold"},{default:a(()=>e[11]||(e[11]=[i(" Personal ")])),_:1}),(d(!0),b(v,null,g(u.periods,s=>(d(),y(t(V),{key:s.id,class:"min-w-[120px] text-center"},{default:a(()=>[o("div",ie,[o("span",null,p(I(s.start_date)),1),e[12]||(e[12]=o("span",{class:"text-xs text-gray-400"},"al",-1)),o("span",null,p(I(s.end_date)),1),o("button",{class:"absolute top-2 right-2 opacity-0 transition-opacity group-hover:opacity-100",onClick:q(r=>z(s.id),["stop"])},[l(t(S),{class:"text-red-400 hover:text-red-600",size:14})],8,de)]),o("div",ue,[o("button",{onClick:r=>z(s.id),title:"Eliminar periodo"},[l(t(S),{class:"cursor-pointer text-red-300 hover:text-red-500",size:16})],8,fe)])]),_:2},1024))),128))]),_:1})]),_:1}),l(t(te),null,{default:a(()=>[(d(!0),b(v,null,g(u.guards,s=>(d(),b(v,{key:s.id},[(d(!0),b(v,null,g(s.assigned_roles,(r,$)=>(d(),y(t(L),{key:r.id},{default:a(()=>[$===0?(d(),y(t(E),{key:0,class:"font-medium",rowspan:s.assigned_roles.length},{default:a(()=>[i(p(s.name),1)]),_:2},1032,["rowspan"])):J("",!0),l(t(E),{class:"font-medium"},{default:a(()=>{var c;return[i(p(r.role.name)+" - "+p((c=r.staff)==null?void 0:c.name)+" "+p(A(r.staff)),1)]}),_:2},1024),(d(!0),b(v,null,g(u.periods,c=>(d(),y(t(E),{key:c.id,class:"p-2 text-center"},{default:a(()=>[l(t(U),{"model-value":D(r.staff,c),"onUpdate:modelValue":H=>G(H,r.staff.id,c.id)},{default:a(()=>[l(t(F),{class:"flex h-auto w-full justify-center border-0 bg-transparent p-0 shadow-none focus:ring-0"},{default:a(()=>[l(W,{class:K(["cursor-pointer border-0 px-3 py-1 text-white shadow-sm transition-all hover:scale-105",h(D(r.staff,c)).color])},{default:a(()=>[i(p(h(D(r.staff,c)).label),1)]),_:2},1032,["class"]),e[13]||(e[13]=o("span",{class:"sr-only"},"Toggle menu",-1))]),_:2},1024),l(t(P),null,{default:a(()=>[l(t(Y),null,{default:a(()=>[l(t(Z),null,{default:a(()=>e[14]||(e[14]=[i("Cambiar Estado")])),_:1}),l(t(m),{value:"1"},{default:a(()=>e[15]||(e[15]=[i("Trabajando")])),_:1}),l(t(m),{value:"2"},{default:a(()=>e[16]||(e[16]=[i("Libre")])),_:1}),l(t(m),{value:"3"},{default:a(()=>e[17]||(e[17]=[i("Falta")])),_:1}),l(t(m),{value:"4"},{default:a(()=>e[18]||(e[18]=[i("Nuevo")])),_:1})]),_:1})]),_:1})]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]))}});export{ve as _};
