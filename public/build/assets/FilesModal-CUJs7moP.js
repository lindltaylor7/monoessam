import{d as Q,k as X,r as b,C as N,s as W,y as Y,g as M,o as r,w as c,a as o,u as l,b as e,e as x,t as f,i as k,c as u,F as z,l as V,G as Z,bQ as ee,n as S,ab as te}from"./app-D-LqQbZa.js";import{_ as ae,a as se,b as oe}from"./index-DWxuIRGj.js";import{_ as D}from"./index-DpgMMlKQ.js";import{_ as ie,a as le,b as ne,c as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DwCCe1VU.js";import{_ as ce}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B0NV6Kd9.js";import{_ as de}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-D0htdjR-.js";import{F as A}from"./file-BvbRlJBE.js";import{X as U}from"./x-b92faefF.js";import{C as O}from"./calendar-CWgTl_K1.js";import{U as ue}from"./upload-BciA0lU5.js";import{E as pe}from"./eye-mSdyq9CV.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Primitive-D2E4zh-F.js";import"./Presence-5rM4SnOx.js";import"./useForwardExpose-C0s566w4.js";import"./DialogTitle-CIiJ2IkS.js";import"./Teleport-C90D5m2n.js";import"./utils-DrB2bsOv.js";import"./createLucideIcon-Ds2iLTpM.js";const xe={class:"text-sm text-zinc-500"},me={class:"flex-1 overflow-y-auto bg-zinc-50/50"},be={class:"space-y-6 px-6 py-6"},he={class:"grid grid-cols-1 gap-4 lg:grid-cols-3"},ge={class:"col-span-1 rounded-xl border border-blue-100 bg-blue-50/50 p-4 lg:col-span-2"},ve={class:"flex gap-4"},_e={class:"flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-blue-600 text-white shadow-lg shadow-blue-200"},we={class:"rounded-xl border border-zinc-200 bg-white p-4 shadow-sm"},ye={class:"flex h-full flex-col justify-center gap-1 text-center"},ke={class:"text-3xl font-black text-zinc-800"},ze={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ce={class:"mb-4 flex items-start justify-between"},Ee={class:"flex gap-4"},Se={class:"flex h-12 w-12 shrink-0 items-center justify-center rounded-xl bg-zinc-100 text-zinc-500 transition-colors group-hover:bg-blue-50 group-hover:text-blue-600"},De={class:"space-y-1"},je={class:"font-bold text-zinc-900 leading-tight"},Fe={class:"flex flex-wrap items-center gap-x-3 gap-y-1"},$e={class:"text-[10px] font-bold text-zinc-400 uppercase tracking-tighter"},Me={key:0,class:"flex items-center gap-1 rounded bg-amber-50 px-1.5 py-0.5 text-[10px] font-bold text-amber-600 uppercase"},Ve={class:"mb-4 space-y-3"},Ae={key:0,class:"space-y-1.5"},Be=["onUpdate:modelValue","min"],Ie=["accept","disabled","onChange"],Ge={key:0,class:"mt-auto space-y-2"},Ne={class:"min-w-0 flex-1 space-y-1"},Ue={class:"flex items-center gap-2"},Oe={class:"truncate text-xs font-bold text-zinc-900"},Pe={class:"flex flex-wrap items-center gap-2 text-[10px] font-medium text-zinc-500 uppercase"},He={class:"flex items-center gap-1.5 ml-2"},Le={key:0,class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24"},qe={class:"flex w-full items-center justify-between"},Ke={class:"flex items-center gap-2"},Te={class:"flex -space-x-2"},Re={class:"text-xs font-medium text-zinc-500"},Je=Q({__name:"FilesModal",props:{staff:{type:Object,required:!0}},setup(B){var G;const h=B,I=X(),j=b(!1),v=b(!1),C=b(""),m=b(null),g=b(null);b(null),b("");const _=b([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1,icon:"FileText"},{label:"Certificado Único Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"Award"},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1,icon:"GraduationCap"},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1,icon:"Briefcase"},{label:"DNI escaneado",key:"dni_escaneado",accept:".pdf,.jpg,.jpeg,.png",maxSize:5,hasExpiration:!0,expirationDate:null,icon:"CreditCard"},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"ShieldAlert"},{label:"Carné de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"Stethoscope"},{label:"Carné de vacunación contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1,icon:"Syringe"},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"ClipboardCheck"},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"Activity"},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null,icon:"FileSignature"}]),P=N({staff_id:h.staff.id,files:[],user_id:(G=I.props.auth.user)==null?void 0:G.id}),H=(s,t,d)=>{var w,i;const n=s.target;if(!n.files||n.files.length===0)return;const a=n.files[0],p=_.value.find(y=>y.label===d);if(!p)return;if(a.size>p.maxSize*1024*1024){v.value=!0,C.value=`El archivo excede el tamaño máximo de ${p.maxSize}MB`,n.value="";return}m.value=t;const E=(i=(w=h.staff.staff_files)==null?void 0:w.find(y=>y.file_type==d))==null?void 0:i.id;if(p.hasExpiration&&!p.expirationDate){alert("Es necesario colocar la fecha de expiración para este archivo antes de subirlo."),m.value=null,n.value="";return}L(a,{fileTypeKey:d,fileFoundId:E},p.expirationDate||void 0),n.value=""},L=(s,t,d)=>{N({file:s,fileTypeKey:t.fileTypeKey,expirationDate:d,fileId:t.fileFoundId??0,staffId:h.staff.id}).post(route("staff.upload-file"),{forceFormData:!0,preserveState:!0,onSuccess:()=>{m.value=null},onFinish:()=>{m.value=null},onError:a=>{v.value=!0,C.value="Error al subir el archivo.",m.value=null}})},q=s=>{confirm("¿Está seguro de eliminar este archivo?")&&(g.value=s,P.delete(route("staff.delete-file",s),{onSuccess:()=>{g.value=null},onFinish:()=>{g.value=null},onError:t=>{v.value=!0,C.value="Error al eliminar el archivo.",g.value=null}}))},K=s=>{window.open("/storage/"+s.path,"_blank")},F=W(()=>{const s={};return _.value.forEach(t=>{s[t.label]=[]}),h.staff.staff_files&&h.staff.staff_files.forEach(t=>{const d=_.value.find(n=>n.label===t.file_type);d&&s[d.label].push(t)}),s}),T=s=>new Date(s).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}),R=s=>s?new Date(s).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",$=s=>{if(!s)return!1;const t=new Date;return t.setHours(0,0,0,0),new Date(s)<t},J=s=>{if(!s)return!1;const t=new Date(s),d=new Date;d.setHours(0,0,0,0);const n=t.getTime()-d.getTime(),a=Math.ceil(n/(1e3*60*60*24));return a>0&&a<=30};return(s,t)=>{const d=Y("AlertCircle");return r(),M(l(re),{open:j.value,"onUpdate:open":t[2]||(t[2]=n=>j.value=n)},{default:c(()=>[o(l(de),{"as-child":""},{default:c(()=>[o(D,{variant:"ghost",size:"icon",class:"h-9 w-9 cursor-pointer rounded-full text-blue-600 transition-all hover:bg-blue-50 hover:text-blue-800"},{default:c(()=>[o(l(A),{class:"h-4 w-4"})]),_:1})]),_:1}),o(l(ie),{class:"flex h-[95vh] w-full flex-col gap-0 overflow-hidden p-0 sm:max-w-[950px]"},{default:c(()=>{var n;return[o(l(le),{class:"shrink-0 border-b bg-white px-6 py-4 shadow-sm"},{default:c(()=>[o(l(ne),{class:"text-xl font-bold text-zinc-800"},{default:c(()=>t[3]||(t[3]=[x("Expediente Digital")])),_:1}),e("p",xe,"Gestión de documentos para "+f(B.staff.name),1)]),_:1}),e("div",me,[e("div",be,[e("div",he,[e("div",ge,[e("div",ve,[e("div",_e,[o(l(A),{class:"h-6 w-6"})]),t[4]||(t[4]=e("div",{class:"space-y-1"},[e("h4",{class:"font-bold text-blue-900"},"Instrucciones de Carga"),e("p",{class:"text-xs leading-relaxed text-blue-700/80"},[x(" Suba los documentos en formato "),e("span",{class:"font-bold"},"PDF, JPG o PNG"),x(". El tamaño máximo permitido es de "),e("span",{class:"font-bold"},"15MB"),x(" por archivo. Los documentos resaltados en naranja requieren una fecha de vigencia. ")])],-1))])]),e("div",we,[e("div",ye,[t[5]||(t[5]=e("span",{class:"text-xs font-semibold text-zinc-400 uppercase tracking-wider"},"Total Documentos",-1)),e("span",ke,f(((n=h.staff.staff_files)==null?void 0:n.length)||0)+" / "+f(_.value.length),1)])])]),v.value?(r(),M(l(ae),{key:0,variant:"destructive",class:"border-red-200 bg-red-50 text-red-900"},{default:c(()=>[o(d,{class:"h-4 w-4"}),o(l(se),{class:"font-bold"},{default:c(()=>t[6]||(t[6]=[x("Error en la operación")])),_:1}),o(l(oe),null,{default:c(()=>[x(f(C.value),1)]),_:1}),e("button",{class:"absolute top-4 right-4 text-red-400 hover:text-red-600",onClick:t[0]||(t[0]=a=>v.value=!1)},[o(l(U),{class:"h-4 w-4"})])]),_:1})):k("",!0),e("div",ze,[(r(!0),u(z,null,V(_.value,(a,p)=>{var E,w;return r(),u("div",{key:p,class:"group relative flex flex-col rounded-2xl border border-zinc-200 bg-white p-5 transition-all duration-300 hover:border-blue-300 hover:shadow-xl hover:shadow-blue-500/5 shadow-sm"},[e("div",Ce,[e("div",Ee,[e("div",Se,[o(l(A),{class:"h-6 w-6"})]),e("div",De,[e("h4",je,f(a.label),1),e("div",Fe,[e("span",$e,"Máx "+f(a.maxSize)+"MB",1),a.hasExpiration?(r(),u("span",Me,[o(l(O),{class:"h-3 w-3"}),t[7]||(t[7]=x(" Vigencia obligatoria "))])):k("",!0)])])])]),e("div",Ve,[a.hasExpiration?(r(),u("div",Ae,[t[8]||(t[8]=e("label",{class:"text-[10px] font-bold text-zinc-400 uppercase tracking-wider"},"Establecer fecha de expiración",-1)),Z(e("input",{type:"date","onUpdate:modelValue":i=>a.expirationDate=i,class:"w-full rounded-lg border-2 border-zinc-100 bg-zinc-50 px-3 py-2 text-sm font-medium transition-all focus:border-blue-500 focus:bg-white focus:ring-4 focus:ring-blue-100 outline-none",min:new Date().toISOString().split("T")[0]},null,8,Be),[[ee,a.expirationDate]])])):k("",!0),e("label",{class:S(["relative flex cursor-pointer items-center justify-center gap-2 rounded-xl border-2 border-dashed px-4 py-3 text-sm font-bold transition-all duration-300",m.value===a.key?"border-blue-500 bg-blue-50 text-blue-600":"border-zinc-200 bg-zinc-50 text-zinc-600 hover:border-blue-400 hover:bg-blue-50 hover:text-blue-600"])},[m.value===a.key?(r(),u(z,{key:0},[t[9]||(t[9]=e("svg",{class:"h-5 w-5 animate-spin text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t[10]||(t[10]=e("span",null,"Procesando...",-1))],64)):(r(),u(z,{key:1},[o(l(ue),{class:"h-4 w-4"}),e("span",null,f(((E=F.value[a.label])==null?void 0:E.length)>0?"Actualizar archivo":"Subir documento"),1)],64)),e("input",{type:"file",accept:a.accept,class:"hidden",disabled:m.value===a.key,onChange:i=>H(i,a.key,a.label)},null,40,Ie)],2)]),((w=F.value[a.label])==null?void 0:w.length)>0?(r(),u("div",Ge,[o(te,{name:"list"},{default:c(()=>[(r(!0),u(z,null,V(F.value[a.label],i=>(r(),u("div",{key:i.id,class:S(["flex items-center justify-between rounded-xl border p-3 transition-all duration-300",[$(i.expiration_date)?"bg-red-50/50 border-red-200 ring-1 ring-red-100":J(i.expiration_date)?"bg-amber-50/50 border-amber-200":"bg-emerald-50/30 border-emerald-100"]])},[e("div",Ne,[e("div",Ue,[e("div",{class:S(["h-2 w-2 rounded-full",$(i.expiration_date)?"bg-red-500 animate-pulse":"bg-emerald-500"])},null,2),e("p",Oe,f(i.path),1)]),e("div",Pe,[e("span",null,f(T(i.created_at)),1),i.expiration_date?(r(),u("span",{key:0,class:S(["flex items-center gap-1",$(i.expiration_date)?"text-red-600 font-bold":"text-zinc-400"])},[o(l(O),{class:"h-3 w-3"}),x(" Vence: "+f(R(i.expiration_date)),1)],2)):k("",!0)])]),e("div",He,[o(D,{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg bg-white/50 text-blue-600 shadow-sm hover:bg-blue-600 hover:text-white",onClick:y=>K(i),title:"Ver documentación"},{default:c(()=>[o(l(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(D,{variant:"ghost",size:"icon",class:"h-8 w-8 rounded-lg bg-white/50 text-red-600 shadow-sm hover:bg-red-600 hover:text-white",disabled:g.value===i.id,onClick:y=>q(i.id),title:"Eliminar"},{default:c(()=>[g.value===i.id?(r(),u("svg",Le,t[11]||(t[11]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(r(),M(l(U),{key:1,class:"h-4 w-4"}))]),_:2},1032,["disabled","onClick"])])],2))),128))]),_:2},1024)])):k("",!0)])}),128))])])]),o(l(ce),{class:"z-20 border-t bg-white px-6 py-4"},{default:c(()=>{var a;return[e("div",qe,[e("div",Ke,[e("div",Te,[(r(),u(z,null,V(3,p=>e("div",{key:p,class:"h-8 w-8 rounded-full border-2 border-white bg-zinc-200"})),64))]),e("span",Re,"Expediente auditado por "+f((a=l(I).props.auth.user)==null?void 0:a.name),1)]),o(D,{variant:"outline",onClick:t[1]||(t[1]=p=>j.value=!1),class:"rounded-xl font-bold px-6"},{default:c(()=>t[12]||(t[12]=[x("Finalizar Gestión")])),_:1})])]}),_:1})]}),_:1})]),_:1},8,["open"])}}}),bt=fe(Je,[["__scopeId","data-v-5cf70ead"]]);export{bt as default};
