import{_ as k}from"./index-CzpGNwk8.js";import{_ as J,a as K,b as Q,c as q}from"./DialogTitle.vue_vue_type_script_setup_true_lang-C1S457e7.js";import{_ as ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang--evU5lfn.js";import{_ as ae}from"./DialogFooter.vue_vue_type_script_setup_true_lang-SuVbo-Nw.js";import{_ as le}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BU__5AnL.js";import{_ as te,a as ne,b as U,c as T}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DFf67Tgh.js";import{_ as se}from"./AlertErrors.vue_vue_type_script_setup_true_lang-aZCnwPXd.js";import{j as h,C as ie,d as oe,x as re,s as R,g as I,o as w,w as r,a as u,u as a,e as y,b as M,Y as ce,i as P,n as ue,c as de}from"./app-DQ0sg1ny.js";import{_ as fe}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-C-iAuYE7.js";import{_ as pe}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-CFvJ0Z11.js";import{_ as me}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CkADofYw.js";import{_ as be}from"./SizesTab.vue_vue_type_script_setup_true_lang-DfdGIhAt.js";import{P as ve}from"./pencil-Ca5NdUhh.js";const ge=9*1024*1024;function _e(){const e=h(!1),n=h(""),c=h([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:e,alertMessage:n,handleFileUpload:(S,p,l)=>{const t=S.target.files;if(t.length>0){const i=t[0];if(i.size>ge)n.value="El archivo es demasiado grande. El máximo es 9MB.",e.value=!0;else{const _=c.value.find(b=>b.label==p);if(_){const o=i.name.split(".").pop(),d=new File([i],`${p}_${Date.now()}.${o}`,{type:i.type});l.push({file:d,label:p}),_.file=d}}}},handleDateFile:(S,p)=>{c.value[p].expirationDate=S}}}function xe(){const e=h(null),n=h(null),c=h(null);return{fileInput:e,imagePreview:n,selectedFile:c,triggerFileInput:()=>{var p;(p=e.value)==null||p.click()},handleImageUpload:p=>{var i;const t=(i=p.target.files)==null?void 0:i[0];if(t){if(!t.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const _=5*1024*1024;if(t.size>_){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=t;const b=new FileReader;b.onload=o=>{var d;n.value=(d=o.target)==null?void 0:d.result},b.readAsDataURL(t)}},removeImage:()=>{n.value=null,c.value=null,e.value&&(e.value.value="")}}}function he(){const e=ie({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0,workplace:"",guard:""}),n=h([]),c=h(!1),f=h([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),g=h([]);return{form:e,errorsSend:n,showErrors:c,prendasFijas:f,cafesUnitSelected:g,handleSubmit:(o,d)=>{let v;Array.isArray(d)?v=d:d&&typeof d=="object"?v=Array.isArray(d.value)?d.value:Object.values(d):v=[],v.forEach(m=>{m&&m.expirationDate===null?e.filesData.push({expirationDate:"-"}):e.filesData.push({expirationDate:m.expirationDate})}),console.log("filesArray:",v);const C=v.filter(m=>m&&typeof m=="object").map(m=>m.file).filter(m=>m instanceof File);console.log("Archivos válidos a subir:",C.length,C),e.prendas=f.value,e.files=C,e.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:m=>{e.reset(),o()},onError:m=>{c.value=!0,n.value=m,console.error("Error al subir el archivo:",m)}})},updateStaff:(o,d)=>{console.log(e),e.prendas=f.value,e.transform(v=>({...v,_method:"PUT"})).post(route("staff.update",d),{forceFormData:!0,onSuccess:v=>{o()},onError:v=>{c.value=!0,n.value=v,console.error("Error al subir el archivo:",v)}})},selectCafe:o=>{e.cafeId=o.id},selectRole:o=>{e.roleId=o.id},selectUnit:o=>{e.unitId=o.id,g.value=o.cafes,e.unitSelectedText=o.name},selectArea:o=>{e.areaId=o},selectGuard:o=>{e.guard=o}}}function Se(e,n,c,f){const g=(l,t)=>{var i,_;if(!l){p();return}e.name=l.name,e.dni=l.dni,e.cell=l.cell,e.birthdate=String(l.birthdate),e.age=l.age,e.sex=String(l.sex),e.email=l.email,e.country=l.country,e.civilstatus=String(l.civilstatus),e.contactname=l.contactname,e.contactcell=l.contactcell,e.roleId=l.role_id,l.staff_financial&&(e.district=l.staff_financial.district,e.province=l.staff_financial.province,e.department=l.staff_financial.department,e.address=l.staff_financial.address,e.workSystem=l.staff_financial.system_work,e.replacement=l.staff_financial.replacement,e.salary=l.staff_financial.salary,e.observations=l.staff_financial.observations,e.bankEntity=String(l.staff_financial.bank_entity),e.cc=l.staff_financial.account_number,e.cci=l.staff_financial.cci,e.pensioncontribution=String(l.staff_financial.pensioncontribution),e.startDate=String(l.staff_financial.start_date),e.contractEndDate=String(l.staff_financial.contract_end_date),e.children=l.staff_financial.children),n.value.forEach(b=>b.talla=""),l.staff_clothes.forEach(b=>{const o=n.value.find(d=>d.label===b.clothe_name);o&&(o.talla=b.clothing_size)}),S(l,t),e.guard=(_=(i=l.guard_role)==null?void 0:i.guard_selected)==null?void 0:_.name,c.value=l.photo?l.photo.url.startsWith("http")?l.photo.url:`/storage/${l.photo.url}`:null},S=(l,t)=>{if(l.staffable_type==="App\\Models\\Cafe"){e.workplace="2",e.cafeId=l.staffable_id;const i=l.staffable;if(i!=null&&i.unit){e.unitId=i.unit.id;const _=t.find(b=>b.id===i.unit.id);_&&(f.value=_.cafes)}}else l.staffable_type==="App\\Models\\Area"?(e.workplace="1",e.areaId=l.staffable_id):(e.workplace=0,e.cafeId=null,e.unitId=0,e.areaId=0)},p=()=>{e.reset(),e.workplace=0,c.value=null,n.value.forEach(l=>l.talla="")};return{initializeStaffData:g}}function ye(e){const n=h("personal"),c=["personal","adjuntos","financiero","tallas"],f=()=>e.value?c.filter(t=>t!=="adjuntos"):c;return{activeTab:n,nextTab:()=>{const t=f(),i=t.indexOf(n.value);i<t.length-1&&(n.value=t[i+1])},prevTab:()=>{const t=f(),i=t.indexOf(n.value);i>0&&(n.value=t[i-1])},resetTab:()=>{n.value="personal"},shouldShowTab:t=>f().includes(t)}}const we={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ie={key:1},Pe=oe({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(e){const n=e,c=h(!1),f=re(()=>!!n.staff),{form:g,errorsSend:S,showErrors:p,prendasFijas:l,cafesUnitSelected:t,handleSubmit:i,updateStaff:_,selectCafe:b,selectRole:o,selectUnit:d,selectArea:v,selectGuard:C}=he(),{fileInput:m,imagePreview:A,triggerFileInput:B,handleImageUpload:E,removeImage:N,selectedFile:V}=xe(),{filesRequired:$,showAlert:O,alertMessage:G,handleFileUpload:z,handleDateFile:L}=_e(),{initializeStaffData:W}=Se(g,l,A,t),{activeTab:D,nextTab:Z,prevTab:X,resetTab:Y,shouldShowTab:j}=ye(f);R(()=>n.staff,x=>W(x,n.units),{immediate:!0}),R(V,x=>{g.photo=x});const H=()=>{const x=()=>{c.value=!1,Y()};f.value?_(x,n.staff.id):i(x,$)};return(x,s)=>(w(),I(a(q),{open:c.value,"onUpdate:open":s[2]||(s[2]=F=>c.value=F)},{default:r(()=>[u(a(le),{"as-child":""},{default:r(()=>[f.value?(w(),I(a(k),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:r(()=>[u(a(ve))]),_:1})):(w(),I(a(k),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>s[3]||(s[3]=[y(" Nuevo Personal ")])),_:1}))]),_:1}),u(a(J),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:r(()=>[M("input",{type:"file",ref_key:"fileInput",ref:m,onChange:s[0]||(s[0]=(...F)=>a(E)&&a(E)(...F)),accept:"image/*",class:"hidden"},null,544),u(a(K),{class:"z-10 border-b bg-white px-6 py-4"},{default:r(()=>[u(a(Q),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:r(()=>s[4]||(s[4]=[y(" Ficha de Registro de Colaborador ")])),_:1}),u(a(ee),null,{default:r(()=>s[5]||(s[5]=[y(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),u(se,{show:a(p),errors:a(S)},null,8,["show","errors"])]),_:1}),M("div",we,[u(a(te),{modelValue:a(D),"onUpdate:modelValue":s[1]||(s[1]=F=>ce(D)?D.value=F:null),class:"w-full"},{default:r(()=>[u(a(ne),{class:ue(["mb-6 grid w-full bg-zinc-100 p-1",f.value?"grid-cols-3":"grid-cols-4"])},{default:r(()=>[u(a(U),{value:"personal",class:"text-xs md:text-sm"},{default:r(()=>s[6]||(s[6]=[y("Personal")])),_:1}),a(j)("adjuntos")?(w(),I(a(U),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:r(()=>s[7]||(s[7]=[y("Adjuntos")])),_:1})):P("",!0),u(a(U),{value:"financiero",class:"text-xs md:text-sm"},{default:r(()=>s[8]||(s[8]=[y("Financiero")])),_:1}),u(a(U),{value:"tallas",class:"text-xs md:text-sm"},{default:r(()=>s[9]||(s[9]=[y("Tallas")])),_:1})]),_:1},8,["class"]),u(a(T),{value:"personal",class:"mt-0"},{default:r(()=>[u(me,{staff:x.staff,form:a(g),cafes:a(t),units:x.units,roles:x.roles,businneses:x.businneses,"image-preview":a(A),onTriggerUpload:a(B),onRemoveImage:a(N),onSelectCafe:a(b),onSelectUnit:a(d),onSelectRole:a(o),onSelectArea:a(v),onSelectGuard:a(C)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea","onSelectGuard"])]),_:1}),a(j)("adjuntos")?(w(),I(a(T),{key:0,value:"adjuntos",class:"mt-0"},{default:r(()=>[u(fe,{"files-required":a($),"show-alert":a(O),"alert-message":a(G),form:a(g),onUploadFile:a(z),onUploadDate:a(L)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1})):P("",!0),u(a(T),{value:"financiero",class:"mt-0"},{default:r(()=>[u(pe,{form:a(g),roles:x.roles,onSelectRole:a(o),onUploadFile:a(z),staff:x.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),u(a(T),{value:"tallas",class:"mt-0"},{default:r(()=>[u(be,{prendas:a(l)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),u(a(ae),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:r(()=>[a(D)!=="personal"?(w(),I(a(k),{key:0,onClick:a(X),variant:"outline",type:"button"},{default:r(()=>s[10]||(s[10]=[y(" ← Anterior ")])),_:1},8,["onClick"])):(w(),de("div",Ie)),a(D)!=="tallas"?(w(),I(a(k),{key:2,onClick:a(Z),type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>s[11]||(s[11]=[y(" Siguiente → ")])),_:1},8,["onClick"])):(w(),I(a(k),{key:3,onClick:H,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:r(()=>s[12]||(s[12]=[y(" Finalizar Registro ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Pe as _};
