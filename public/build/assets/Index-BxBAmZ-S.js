import{_ as I}from"./index-CZl21aCP.js";import{_ as y,a as $,b as S,c as w,d as U}from"./SelectValue.vue_vue_type_script_setup_true_lang-BvmSQ1U2.js";import{_ as b,a as G}from"./SelectLabel.vue_vue_type_script_setup_true_lang-CvXEnM2b.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-B0-XQLda.js";import{d as H,j as c,s as O,v as J,c as f,o as u,a as l,u as t,m as K,w as o,b as n,e as m,F as v,p as h,g as V,t as C}from"./app-f5Wc-EOw.js";import Q from"./GuardAreaDroppable-Dbc3SKqR.js";import{_ as W}from"./GuardModal.vue_vue_type_script_setup_true_lang-BqvdALeQ.js";import{_ as X}from"./StaffSelectables.vue_vue_type_script_setup_true_lang-DTTkD1cx.js";import{_ as Y}from"./TableHeadcount.vue_vue_type_script_setup_true_lang-U0wTCf_g.js";import{c as Z}from"./createLucideIcon-BhRFwtFV.js";import{S as ee}from"./sheet-D-8CVfDK.js";import"./Primitive-Bp-7n0bT.js";import"./utils-bRKmu4jq.js";import"./index-dkW4UkYo.js";import"./Presence-D77GemDU.js";import"./useForwardExpose-jL2GneGl.js";import"./Teleport-C4Dy0_kJ.js";import"./chevron-down-CTWZT-P6.js";import"./Collection-Dv1NiuE1.js";import"./usePrimitiveElement-B3IQMJkX.js";import"./check-BHS4xYJp.js";import"./PopperContent-D2AYwBO0.js";import"./useTypeahead-BKPNMHIv.js";import"./utils-CVDC0OXN.js";import"./VisuallyHidden-D1azGQJI.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-CdFCt4Sj.js";import"./RovingFocusGroup-Bkq05XnE.js";import"./DialogTitle-y9zm2rjP.js";import"./x-IDcWNnUT.js";import"./DialogDescription-B3jyRJHj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./hand-helping-Bu-GdFE2.js";import"./building-2-w9DVri2h.js";import"./user-iKqgs82F.js";import"./chevron-right-DDFAGQox.js";import"./GuardRolesDropzone-DNUxRCs7.js";import"./Draggable-CmSTjoK2.js";import"./GuardRolesModal-sx-J8DY0.js";import"./index-B6jUhVJu.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-BOKYTpjN.js";import"./DialogFooter.vue_vue_type_script_setup_true_lang-CobMxMqV.js";import"./DialogTrigger.vue_vue_type_script_setup_true_lang-CjAJ2NUe.js";import"./Input.vue_vue_type_script_setup_true_lang-Bv8BhjLl.js";import"./plus-BynTTgzo.js";import"./circle-alert-BB-WBv7T.js";import"./trash-iC-Wo0wT.js";import"./Label.vue_vue_type_script_setup_true_lang-6ZyhFM8V.js";import"./TableHeader.vue_vue_type_script_setup_true_lang-Cj3ahKBf.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=Z("ListIcon",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]),ae={class:"flex h-full flex-1 flex-col gap-6 p-6"},le={class:"flex w-full flex-row gap-2"},te={class:"flex gap-2"},oe=["hidden"],ne={key:0,class:"grid h-full auto-rows-fr gap-6 md:grid-cols-8"},ie={class:"md:col-span-6"},re={class:"flex h-full gap-6"},ue={key:1,class:"flex h-full items-center justify-center p-10 text-center"},de=["hidden"],ce={class:"grid h-full"},ns=H({__name:"Index",props:{users:{},roles:{},permissions:{},areas:{},headquarters:{},mines:{},units:{}},setup(z){const D=z,i=c({mine:null,unit:null,cafe:null}),x=c([]),k=c([]),M=c([]),d=c([]),_=c(!1),p=c([]),g=c([]);O(i,a=>{if(a.mine!==null&&a.mine!==void 0){const s=D.mines.find(e=>String(e.id)===String(a.mine));x.value=s?s.units:[]}if(a.unit){const s=x.value.find(e=>e.id==a.unit);k.value=s?s.cafes:[]}a.cafe&&E(Number(a.cafe))},{deep:!0});const E=async a=>{try{const e=(await J.get(`/cafes/${a}`)).data;d.value=e.guards,p.value=e.users.unassigned,g.value=e.users.assigned,M.value=e.periods,console.log(g)}catch(s){console.error("Error fetching cafe data:",s)}},L=a=>{p.value=p.value.filter(s=>s.id!==a)},R=a=>{console.log("updating guards",a),d.value=a},j=(a,s)=>{const e=d.value.find(r=>r.id===a);e&&(e.assigned_roles=[],s.forEach(r=>{const q={role:{id:r.id,guard_id:a,role_id:r.id,name:r.name}};e.assigned_roles.push(q)}))},A=(a,s)=>{const e=d.value.find(r=>r.id===a);console.log(s),e&&(e.assigned_roles=e.assigned_roles.filter(r=>r.id!==s))},B=a=>{d.value=d.value.filter(s=>s.id!==a)},N=a=>{const s=k.value.find(e=>e.id==i.value.cafe);if(s){const e=s.staffs.find(r=>r.id===a);e&&p.value.unshift(e)}},P=()=>{_.value=!_.value},T=()=>{const a=i.value.cafe;if(!a){alert("Por favor seleccione un comedor antes de exportar.");return}window.location.href=`/cafes/${a}/export-headcount`};return(a,s)=>(u(),f(v,null,[l(t(K),{title:"Headcount"}),l(F,null,{default:o(()=>[n("div",ae,[s[9]||(s[9]=n("div",{class:"flex"},[n("h1",{class:"text-2xl font-bold"},"Puestos")],-1)),n("div",le,[l(I,{title:"Ver en lista",class:"cursor-pointer",onClick:s[0]||(s[0]=e=>P())},{default:o(()=>[l(t(se))]),_:1}),l(I,{class:"cursor-pointer bg-green-500",title:"Exportar Headcount en Excel",onClick:s[1]||(s[1]=e=>T())},{default:o(()=>[l(t(ee))]),_:1})]),s[10]||(s[10]=n("p",null,"Seleccione una mina, unidad y comedor para asignar guardias y roles",-1)),n("div",te,[l(t(y),{class:"w-full",modelValue:i.value.mine,"onUpdate:modelValue":s[2]||(s[2]=e=>i.value.mine=e)},{default:o(()=>[l(t($),{class:"w-full"},{default:o(()=>[l(t(S),{placeholder:"Selecciona una mina"})]),_:1}),l(t(w),null,{default:o(()=>[l(t(b),null,{default:o(()=>[l(t(G),null,{default:o(()=>s[5]||(s[5]=[m("Minas")])),_:1}),(u(!0),f(v,null,h(D.mines,e=>(u(),V(t(U),{value:String(e.id),key:e.id},{default:o(()=>[m(C(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(t(y),{class:"w-full",modelValue:i.value.unit,"onUpdate:modelValue":s[3]||(s[3]=e=>i.value.unit=e)},{default:o(()=>[l(t($),{class:"w-full"},{default:o(()=>[l(t(S),{placeholder:"Selecciona una unidad minera"})]),_:1}),l(t(w),null,{default:o(()=>[l(t(b),null,{default:o(()=>[l(t(G),null,{default:o(()=>s[6]||(s[6]=[m("Unidades mineras")])),_:1}),(u(!0),f(v,null,h(x.value,e=>(u(),V(t(U),{value:e.id,key:e.id},{default:o(()=>[m(C(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(t(y),{class:"w-full",modelValue:i.value.cafe,"onUpdate:modelValue":s[4]||(s[4]=e=>i.value.cafe=e)},{default:o(()=>[l(t($),{class:"w-full"},{default:o(()=>[l(t(S),{placeholder:"Selecciona un comedor"})]),_:1}),l(t(w),null,{default:o(()=>[l(t(b),null,{default:o(()=>[l(t(G),null,{default:o(()=>s[7]||(s[7]=[m("Comedores")])),_:1}),(u(!0),f(v,null,h(k.value,e=>(u(),V(t(U),{value:e.id,key:e.id},{default:o(()=>[m(C(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{cafeId:i.value.cafe,onAssignGuards:R},null,8,["cafeId"])]),n("div",{class:"h-full",hidden:_.value},[d.value&&d.value.length>0?(u(),f("div",ne,[l(X,{users:p.value,class:"md:col-span-2"},null,8,["users"]),n("div",ie,[(u(!0),f(v,null,h(d.value,e=>(u(),f("div",{class:"overflow-x-auto",key:e.id},[n("div",re,[l(Q,{users:g.value,roles:a.roles,guard:e,onDropped:L,onAsignRolesToGuard:j,onDeleteGuardRole:A,onDeleteGuard:B,onUnassignUser:N,unassignedUsers:p.value},null,8,["users","roles","guard","unassignedUsers"])])]))),128))])])):(u(),f("div",ue,s[8]||(s[8]=[n("p",{class:"text-xl font-semibold text-gray-500"},[m(" ⚠️ Por favor seleccione un comedor y asigne guardias para continuar. "),n("br"),m(" (La lista de guardias aparecerá aquí una vez se asignen). ")],-1)])))],8,oe),n("div",{class:"h-full",hidden:!_.value},[n("div",ce,[l(Y,{guards:d.value,users:g.value,cafeId:i.value.cafe,periods:M.value,onFetchCafeData:E},null,8,["guards","users","cafeId","periods"])])],8,de)])]),_:1})],64))}});export{ns as default};
