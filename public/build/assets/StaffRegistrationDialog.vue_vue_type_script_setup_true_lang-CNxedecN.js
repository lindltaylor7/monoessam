import{_ as w}from"./index-BIu6T84f.js";import{_ as oe,a as ie,b as re,c as fe}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BzYxAdMC.js";import{_ as ce}from"./DialogDescription.vue_vue_type_script_setup_true_lang-CNnq_yDE.js";import{_ as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Bu6QoxvG.js";import{_ as de}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-VzJlSINT.js";import{c as me,_ as pe,a as I,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CbW9ClWe.js";import{_ as ve}from"./AlertErrors.vue_vue_type_script_setup_true_lang-B7lnnPb7.js";import{j as v,C as be,d as ge,s as J,g as S,o as F,w as o,a as r,u as a,e as _,b as $,i as K}from"./app-mR_rd72W.js";import{_ as _e}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-DdIijzfU.js";import{_ as xe}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-Ch8L7Ezd.js";import{_ as he}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CgUyg0B7.js";import{_ as ye}from"./SizesTab.vue_vue_type_script_setup_true_lang-BcIL8zbr.js";import{P as Se}from"./pencil-BDolfds7.js";const Fe=9*1024*1024;function De(){const n=v(!1),e=v(""),u=v([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:u,showAlert:n,alertMessage:e,handleFileUpload:(x,p,D)=>{const b=x.target.files;if(b.length>0){const g=b[0];if(g.size>Fe)e.value="El archivo es demasiado grande. El máximo es 9MB.",n.value=!0;else{const h=u.value.find(i=>i.label==p);if(h){const d=g.name.split(".").pop(),f=new File([g],`${p}_${Date.now()}.${d}`,{type:g.type});D.push({file:f,label:p}),h.file=f}}}},handleDateFile:(x,p)=>{u.value[p].expirationDate=x}}}function Ce(){const n=v(null),e=v(null),u=v(null);return{fileInput:n,imagePreview:e,selectedFile:u,triggerFileInput:()=>{var p;(p=n.value)==null||p.click()},handleImageUpload:p=>{var g;const b=(g=p.target.files)==null?void 0:g[0];if(b){if(!b.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const h=5*1024*1024;if(b.size>h){alert("La imagen es demasiado grande. Máximo 5MB");return}u.value=b;const i=new FileReader;i.onload=d=>{var f;e.value=(f=d.target)==null?void 0:f.result},i.readAsDataURL(b)}},removeImage:()=>{e.value=null,u.value=null,n.value&&(n.value.value="")},selectedFile:u}}function we(){const n=be({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),e=v([]),u=v(!1),c=v([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),l=v([]);return{form:n,errorsSend:e,showErrors:u,prendasFijas:c,cafesUnitSelected:l,handleSubmit:(i,d)=>{let f;Array.isArray(d)?f=d:d&&typeof d=="object"?f=Array.isArray(d.value)?d.value:Object.values(d):f=[],f.forEach(m=>{m&&m.expirationDate===null?n.filesData.push({expirationDate:"-"}):n.filesData.push({expirationDate:m.expirationDate})}),console.log("filesArray:",f);const C=f.filter(m=>m&&typeof m=="object").map(m=>m.file).filter(m=>m instanceof File);console.log("Archivos válidos a subir:",C.length,C),n.prendas=c.value,n.files=C,n.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:m=>{n.reset(),i()},onError:m=>{u.value=!0,e.value=m,console.error("Error al subir el archivo:",m)}})},updateStaff:(i,d)=>{console.log(n),n.prendas=c.value,n.transform(f=>({...f,_method:"PUT"})).post(route("staff.update",d),{forceFormData:!0,onSuccess:f=>{i()},onError:f=>{u.value=!0,e.value=f,console.error("Error al subir el archivo:",f)}})},selectCafe:i=>{n.cafeId=i.id},selectRole:i=>{n.roleId=i.id},selectUnit:i=>{n.unitId=i.id,l.value=i.cafes,n.unitSelectedText=i.name},selectArea:i=>{n.areaId=i}}}const Ie={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ne=ge({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(n){var P,T,R,z,B,V,M,N,O,L,G,W,Z,X,H;const e=n,u=v(!1),c=v("personal"),{form:l,errorsSend:x,showErrors:p,prendasFijas:D,cafesUnitSelected:b,handleSubmit:g,updateStaff:h,selectCafe:i,selectRole:d,selectUnit:f,selectArea:C}=we();e.staff&&(console.log(e.staff),l.name=e.staff.name,l.dni=e.staff.dni,l.cell=e.staff.cell,l.birthdate=String(e.staff.birthdate),l.age=e.staff.age,l.sex=String(e.staff.sex),l.email=e.staff.email,l.country=e.staff.country,l.civilstatus=String(e.staff.civilstatus),l.contactname=e.staff.contactname,l.contactcell=e.staff.contactcell,l.district=(P=e.staff.staff_financial)==null?void 0:P.district,l.province=(T=e.staff.staff_financial)==null?void 0:T.province,l.department=(R=e.staff.staff_financial)==null?void 0:R.department,l.address=(z=e.staff.staff_financial)==null?void 0:z.address,l.workSystem=(B=e.staff.staff_financial)==null?void 0:B.system_work,l.replacement=(V=e.staff.staff_financial)==null?void 0:V.replacement,l.salary=(M=e.staff.staff_financial)==null?void 0:M.salary,l.observations=(N=e.staff.staff_financial)==null?void 0:N.observations,l.bankEntity=String((O=e.staff.staff_financial)==null?void 0:O.bank_entity),l.cc=(L=e.staff.staff_financial)==null?void 0:L.account_number,l.cci=(G=e.staff.staff_financial)==null?void 0:G.cci,l.pensioncontribution=String((W=e.staff.staff_financial)==null?void 0:W.pensioncontribution),l.startDate=String((Z=e.staff.staff_financial)==null?void 0:Z.start_date),l.contractEndDate=String((X=e.staff.staff_financial)==null?void 0:X.contract_end_date),l.children=(H=e.staff.staff_financial)==null?void 0:H.children,e.staff.staff_clothes.forEach(s=>{const t=D.value.find(y=>y.label==s.clothe_name);t.talla=s.clothing_size}));const{fileInput:m,imagePreview:k,triggerFileInput:Q,handleImageUpload:A,removeImage:Y,selectedFile:q}=Ce();J(()=>e.staff,s=>{s&&s.photo&&(k.value=s.photo.url.startsWith("http")?s.photo.url:`/storage/${s.photo.url}`)},{immediate:!0}),J(q,s=>{l.photo=s});const{filesRequired:E,showAlert:ee,alertMessage:ae,handleFileUpload:j,handleDateFile:te}=De(),le=()=>{const s=["personal","adjuntos","financiero","tallas"],t=s.indexOf(c.value);e.staff&&t==0?c.value=s[t+2]:t<s.length-1&&(c.value=s[t+1])},se=()=>{const s=["personal","adjuntos","financiero","tallas"],t=s.indexOf(c.value);e.staff&&t==2?c.value=s[t-2]:t>0&&(c.value=s[t-1])},ne=()=>{e.staff?h(()=>{u.value=!1,c.value="personal"},e.staff.id):g(()=>{u.value=!1,c.value="personal"},E)};return(s,t)=>(F(),S(a(fe),{open:u.value,"onUpdate:open":t[2]||(t[2]=y=>u.value=y)},{default:o(()=>[r(a(de),{"as-child":""},{default:o(()=>[e.staff?(F(),S(a(w),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:o(()=>[r(a(Se))]),_:1})):(F(),S(a(w),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:o(()=>t[3]||(t[3]=[_(" Nuevo Personal ")])),_:1}))]),_:1}),r(a(oe),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:o(()=>[$("input",{type:"file",ref_key:"fileInput",ref:m,onChange:t[0]||(t[0]=(...y)=>a(A)&&a(A)(...y)),accept:"image/*",class:"hidden"},null,544),r(a(ie),{class:"z-10 border-b bg-white px-6 py-4"},{default:o(()=>[r(a(re),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:o(()=>t[4]||(t[4]=[_(" Ficha de Registro de Colaborador ")])),_:1}),r(a(ce),null,{default:o(()=>t[5]||(t[5]=[_(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),r(ve,{show:a(p),errors:a(x)},null,8,["show","errors"])]),_:1}),$("div",Ie,[r(a(me),{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=y=>c.value=y),class:"w-full"},{default:o(()=>[r(a(pe),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:o(()=>[r(a(I),{value:"personal",class:"text-xs md:text-sm"},{default:o(()=>t[6]||(t[6]=[_("Personal")])),_:1}),s.staff?K("",!0):(F(),S(a(I),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:o(()=>t[7]||(t[7]=[_("Adjuntos")])),_:1})),r(a(I),{value:"financiero",class:"text-xs md:text-sm"},{default:o(()=>t[8]||(t[8]=[_("Financiero")])),_:1}),r(a(I),{value:"tallas",class:"text-xs md:text-sm"},{default:o(()=>t[9]||(t[9]=[_("Tallas")])),_:1})]),_:1}),r(a(U),{value:"personal",class:"mt-0"},{default:o(()=>[r(he,{staff:s.staff,form:a(l),cafes:a(b),units:s.units,roles:s.roles,businneses:s.businneses,"image-preview":a(k),onTriggerUpload:a(Q),onRemoveImage:a(Y),onSelectCafe:a(i),onSelectUnit:a(f),onSelectRole:a(d),onSelectArea:a(C)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),r(a(U),{value:"adjuntos",class:"mt-0"},{default:o(()=>[r(_e,{"files-required":a(E),"show-alert":a(ee),"alert-message":a(ae),form:a(l),onUploadFile:a(j),onUploadDate:a(te)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),r(a(U),{value:"financiero",class:"mt-0"},{default:o(()=>[r(xe,{form:a(l),roles:s.roles,onSelectRole:a(d),onUploadFile:a(j),staff:s.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),r(a(U),{value:"tallas",class:"mt-0"},{default:o(()=>[r(ye,{prendas:a(D)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),r(a(ue),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:o(()=>[$("div",null,[c.value!=="personal"?(F(),S(a(w),{key:0,onClick:se,variant:"outline",type:"button"},{default:o(()=>t[10]||(t[10]=[_(" ← Anterior ")])),_:1})):K("",!0)]),$("div",null,[c.value!=="tallas"?(F(),S(a(w),{key:0,onClick:le,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:o(()=>t[11]||(t[11]=[_(" Siguiente → ")])),_:1})):(F(),S(a(w),{key:1,onClick:ne,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:o(()=>t[12]||(t[12]=[_(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ne as _};
