import{d as Z,l as K,j as f,C,y as T,g as L,o as c,w as d,a as n,u as i,b as e,e as m,i as v,t as p,c as u,F as B,p as N,D as ee,bQ as te,n as O}from"./app-b9Q6WyoX.js";import{b as ae,_ as se,a as oe}from"./index-CXV49l-E.js";import{_ as y}from"./index-DP0zSKu9.js";import{_ as ne,a as ie,b as re,c as le}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DCmGcyu6.js";import{_ as ce}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Dk4vx6cu.js";import{_ as de}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-Co-0CexR.js";import{F as S}from"./file-Coz0Sdne.js";import{C as U}from"./calendar-lOK6oqqn.js";import{c as A}from"./createLucideIcon-C_EVhasT.js";import{X as ue}from"./x-Bw07CgV6.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=A("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=A("UploadIcon",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),fe={class:"flex-1 space-y-4 overflow-y-auto pr-2"},xe={class:"rounded-lg bg-blue-50 p-4"},_e={class:"flex items-center space-x-3"},ve={class:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100"},he={class:"font-medium text-gray-900"},ge={class:"space-y-6"},be={class:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm"},ye={class:"mb-3 flex items-center justify-between"},ke={class:"flex items-center space-x-3"},we={class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100"},Ee={class:"text-sm font-medium"},Ce={class:"font-medium text-gray-900"},Se={class:"flex items-center space-x-2 text-sm text-gray-500"},De={key:0,class:"inline-flex items-center"},je=["onUpdate:modelValue","min"],ze={key:0},Fe={key:1,class:"inline-flex items-center"},$e=["accept","data-file-type","onChange"],Ie={key:0,class:"space-y-2"},Me={class:"flex items-center justify-between"},Ve={class:"flex items-center space-x-3"},Le={class:"flex items-center space-x-2"},Be={class:"text-sm font-medium text-gray-700"},Ne={key:0,class:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800"},Oe={class:"mt-1 space-y-1 text-xs text-gray-500"},Ue={class:"flex items-center space-x-2"},Ae={key:0},qe={key:1,class:"inline-flex items-center"},Pe={class:"flex items-center space-x-1"},Ge={key:0,class:"mr-2"},He=["value","onChange","min"],Re={key:1,class:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center"},Je={class:"flex w-full items-center justify-between"},Qe={class:"text-sm text-gray-500"},Xe={class:"font-medium"},it=Z({__name:"FilesModal",props:{staff:{type:Object,required:!0}},emits:["update-files"],setup(D,{emit:We}){var F;const x=D,q=K(),k=f(!1),_=f(!1),h=f(""),w=f(null);f(null),f("");const b=f([{label:"CV Documentado",key:"cv_documentado",accept:".pdf,.doc,.docx",maxSize:10,hasExpiration:!1},{label:"Certificado Ãšnico Laboral (CUL)",key:"certificado_unico_laboral",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"Certificado de Estudios",key:"certificado_estudios",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Certificados de Trabajo",key:"certificados_trabajo",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"DNI escaneado",key:"dni_escaneado",accept:".pdf,.jpg,.jpeg,.png",maxSize:5,hasExpiration:!0,expirationDate:null},{label:"Antecedentes Penales y Policiales",key:"antecedentes_penales",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"CarnÃ© de sanidad",key:"carne_sanidad",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"CarnÃ© de vacunaciÃ³n contra el COVID",key:"carne_vacunacion_covid",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!1},{label:"Examen Medico Ocupacional (EMO)",key:"examen_medico_ocupacional",accept:".pdf,.jpg,.jpeg,.png",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"SCTR",key:"sctr",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null},{label:"Contrato",key:"contrato",accept:".pdf",maxSize:10,hasExpiration:!0,expirationDate:null}]),P=C({staff_id:x.staff.id,files:[],user_id:(F=q.props.auth.user)==null?void 0:F.id}),G=(o,t,a)=>{var I,M,V;const l=o.target;if(!l.files||l.files.length===0)return;const s=l.files[0],r=b.value.find(g=>g.label===t);if(!r)return;if(s.size>r.maxSize*1024*1024){_.value=!0,h.value=`El archivo excede el tamaÃ±o mÃ¡ximo de ${r.maxSize}MB`,l.value="";return}const W=r.accept.split(",").map(g=>g.trim().toLowerCase()),Y="."+((I=s.name.split(".").pop())==null?void 0:I.toLowerCase());if(!W.includes(Y)){_.value=!0,h.value=`Tipo de archivo no vÃ¡lido. Formatos aceptados: ${r.accept}`,l.value="";return}w.value=t;const $=(V=(M=x.staff.staff_files)==null?void 0:M.find(g=>g.file_type==t))==null?void 0:V.id;if(r.hasExpiration&&r.expirationDate==null){alert("Es necesario colocar la fecha de expiraciÃ³n a este archivo");return}else!r.hasExpiration&&r.expirationDate==null?j(s,{fileTypeKey:t,fileFoundId:$}):r.hasExpiration&&r.expirationDate!=null&&j(s,{fileTypeKey:t,fileFoundId:$},r.expirationDate);l.value=""},j=(o,t,a)=>{console.log(a),C({file:o,fileTypeKey:t.fileTypeKey||t.fileLabel,expirationDate:a,fileId:t.fileFoundId??0,staffId:x.staff.id}).post(route("staff.upload-file"),{forceFormData:!0,preserveState:!0,onSuccess:s=>{alert("Archivo actualizado correctamente")},onError:s=>{_.value=!0,h.value="Error en la conexiÃ³n",console.error(error)}})},H=o=>{confirm("Â¿EstÃ¡ seguro de eliminar este archivo?")&&P.delete(route("staff.delete-file",o),{onSuccess:()=>{alert("Archivo eliminado correctamente")},onError:t=>{_.value=!0,h.value="Error en la conexiÃ³n",console.error(t)}})},R=o=>{window.open("/storage/"+o.file_path,"_blank")},J=(o,t)=>{C({fileId:o,expirationDate:t}).post(route("staff.update-filedate"),{onSuccess:()=>{alert("Fecha actualizada correctamente")},onError:l=>{alert("Error en la actualizacion")}})},E=T(()=>{const o={};return b.value.forEach(t=>{o[t.label]=[]}),x.staff.staff_files&&x.staff.staff_files.forEach(t=>{const a=b.value.find(l=>l.label===t.file_type);a&&o[a.label].push(t)}),o}),Q=o=>new Date(o).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),X=o=>o?new Date(o).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"Sin fecha",z=o=>o?new Date(o)<new Date:!1;return(o,t)=>(c(),L(i(le),{open:k.value,"onUpdate:open":t[2]||(t[2]=a=>k.value=a)},{default:d(()=>[n(i(de),{"as-child":""},{default:d(()=>[n(y,{variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:d(()=>[n(i(S),{class:"h-4 w-4"})]),_:1})]),_:1}),n(i(ne),{class:"flex max-h-[90vh] w-full flex-col sm:max-w-[900px]"},{default:d(()=>[n(i(ie),{class:"shrink-0 border-b pb-3"},{default:d(()=>[n(i(re),null,{default:d(()=>t[3]||(t[3]=[m("GestiÃ³n de Documentos del Personal")])),_:1})]),_:1}),e("div",fe,[e("div",xe,[e("div",_e,[e("div",ve,[n(i(S),{class:"h-5 w-5 text-blue-600"})]),e("div",null,[e("h3",he,p(D.staff.name),1),t[4]||(t[4]=e("p",{class:"text-sm text-gray-600"},"GestiÃ³n de documentos y archivos",-1))])])]),t[12]||(t[12]=e("div",{class:"rounded-lg border border-amber-200 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 mr-3"},[e("div",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-600"},"!")]),e("div",null,[e("h4",{class:"text-sm font-medium text-amber-800"},"AtenciÃ³n"),e("p",{class:"mt-1 text-sm text-amber-700"}," AsegÃºrese de que los archivos sean legibles (PDF, DOC, JPG, PNG) y que pesen menos de 10MB. Los documentos marcados con ðŸ“… requieren fecha de expiraciÃ³n. ")])])],-1)),_.value?(c(),L(i(ae),{key:0,variant:"destructive",class:"relative"},{default:d(()=>[e("button",{class:"absolute top-3 right-3 text-sm",onClick:t[0]||(t[0]=a=>_.value=!1)},"âœ•"),n(i(se),null,{default:d(()=>t[5]||(t[5]=[m("Error")])),_:1}),n(i(oe),null,{default:d(()=>[m(p(h.value),1)]),_:1})]),_:1})):v("",!0),e("div",ge,[(c(!0),u(B,null,N(b.value,(a,l)=>(c(),u("div",{key:l,class:"space-y-3"},[e("div",be,[e("div",ye,[e("div",ke,[e("div",we,[e("span",Ee,p(l+1),1)]),e("div",null,[e("h4",Ce,p(a.label),1),e("div",Se,[e("span",null,"Formatos: "+p(a.accept.replace(/\./g,"").toUpperCase()),1),t[7]||(t[7]=e("span",null,"â€¢",-1)),e("span",null,"MÃ¡x: "+p(a.maxSize)+"MB",1),a.hasExpiration?(c(),u("span",De,[n(i(U),{class:"ml-2 h-4 w-4 text-amber-600"}),t[6]||(t[6]=e("span",{class:"ml-1 text-amber-600"},"Requiere fecha",-1)),ee(e("input",{type:"date","onUpdate:modelValue":s=>a.expirationDate=s,class:"ms-1 rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,8,je),[[te,a.expirationDate]])])):v("",!0)])])]),e("label",{class:O(["cursor-pointer rounded-md px-4 py-2 text-sm font-medium transition-colors",w.value===a.key?"cursor-not-allowed bg-blue-400 text-white":"bg-blue-600 text-white hover:bg-blue-700"])},[w.value===a.key?(c(),u("span",ze,t[8]||(t[8]=[e("span",{class:"inline-flex items-center"},[e("svg",{class:"mr-2 h-4 w-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),m(" Subiendo... ")],-1)]))):(c(),u("span",Fe,[n(i(me),{class:"mr-2 h-4 w-4"}),t[9]||(t[9]=m(" Subir "))])),e("input",{type:"file",accept:a.accept,class:"hidden","data-file-type":a.key,onChange:s=>G(s,a.label,l)},null,40,$e)],2)]),E.value[a.label]&&E.value[a.label].length>0?(c(),u("div",Ie,[(c(!0),u(B,null,N(E.value[a.label],s=>(c(),u("div",{key:s.id,class:O(["rounded-lg border p-3 transition-colors",z(s.expiration_date)?"border-red-200 bg-red-50":"border-green-200 bg-green-50"])},[e("div",Me,[e("div",Ve,[e("div",null,[e("div",Le,[e("p",Be,p(s.path),1),z(s.expiration_date)?(c(),u("span",Ne," VENCIDO ")):v("",!0)]),e("div",Oe,[e("p",null,"Subido: "+p(Q(s.created_at)),1),e("div",Ue,[s.user_name?(c(),u("span",Ae,"Por: "+p(s.user_name),1)):v("",!0),a.hasExpiration?(c(),u("span",qe,[n(i(U),{class:"mr-1 h-3 w-3"}),m(" Vence: "+p(X(s.expiration_date)),1)])):v("",!0)])])])]),e("div",Pe,[a.hasExpiration?(c(),u("div",Ge,[e("input",{type:"date",value:s.expiration_date||"",onChange:r=>J(s.id,r.target.value),class:"rounded border border-gray-300 px-2 py-1 text-xs",min:new Date().toISOString().split("T")[0]},null,40,He)])):v("",!0),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-blue-600 hover:bg-blue-100",onClick:r=>R(s),title:"Vista previa"},{default:d(()=>[n(i(pe),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(y,{variant:"ghost",size:"icon",class:"h-8 w-8 text-red-600 hover:bg-red-100",onClick:r=>H(s.id),title:"Eliminar"},{default:d(()=>[n(i(ue),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])])],2))),128))])):(c(),u("div",Re,[n(i(S),{class:"mx-auto h-8 w-8 text-gray-400"}),t[10]||(t[10]=e("p",{class:"mt-2 text-sm font-medium text-gray-900"},"No hay archivos subidos",-1)),t[11]||(t[11]=e("p",{class:"mt-1 text-xs text-gray-500"},'Haz clic en "Subir" para agregar un documento',-1))]))])]))),128))])]),n(i(ce),{class:"border-t pt-4"},{default:d(()=>{var a;return[e("div",Je,[e("div",Qe,[e("span",Xe,p(((a=x.staff.staff_files)==null?void 0:a.length)||0),1),t[13]||(t[13]=m(" archivos en total "))]),n(y,{variant:"outline",onClick:t[1]||(t[1]=l=>k.value=!1)},{default:d(()=>t[14]||(t[14]=[m("Cerrar")])),_:1})])]}),_:1})]),_:1})]),_:1},8,["open"]))}});export{it as _};
