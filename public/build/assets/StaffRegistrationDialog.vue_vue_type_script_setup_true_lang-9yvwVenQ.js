import{_ as k}from"./index-CGJRz2mZ.js";import{_ as se,a as ie,b as oe,c as re}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BzN-X2xZ.js";import{_ as ce}from"./DialogDescription.vue_vue_type_script_setup_true_lang-nAPOyAHZ.js";import{_ as ue}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BMR61Fl8.js";import{_ as de}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-By9k9cgj.js";import{_ as fe,a as pe,b as E}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-HyRZrUDx.js";import{_ as $}from"./TabsContent.vue_vue_type_script_setup_true_lang-Bd7JCevN.js";import{_ as me}from"./AlertErrors.vue_vue_type_script_setup_true_lang-BY1O8oWG.js";import{r as x,C as be,d as ve,v as ge,s as z,g as w,o as y,w as r,a as u,u as t,e as I,b as W,x as _e,i as X,n as he,c as xe}from"./app-BDzroith.js";import{_ as Se}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-DGNwTbIS.js";import{_ as Ie}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-BK4bpdPz.js";import{_ as ye}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CjLqxtNe.js";import{_ as we}from"./SizesTab.vue_vue_type_script_setup_true_lang-CjXg47kF.js";import{P as Ce}from"./pencil-ZftsbL49.js";const De=9*1024*1024;function Fe(){const e=x(!1),l=x(""),c=x([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:e,alertMessage:l,handleFileUpload:(S,b,a)=>{const s=S.target.files;if(s.length>0){const i=s[0];if(i.size>De)l.value="El archivo es demasiado grande. El máximo es 9MB.",e.value=!0;else{const h=c.value.find(g=>g.label==b);if(h){const o=i.name.split(".").pop(),f=new File([i],`${b}_${Date.now()}.${o}`,{type:i.type});a.push({file:f,label:b}),h.file=f}}}},handleDateFile:(S,b)=>{c.value[b].expirationDate=S}}}function ke(){const e=x(null),l=x(null),c=x(null);return{fileInput:e,imagePreview:l,selectedFile:c,triggerFileInput:()=>{var b;(b=e.value)==null||b.click()},handleImageUpload:b=>{var i;const s=(i=b.target.files)==null?void 0:i[0];if(s){if(!s.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const h=5*1024*1024;if(s.size>h){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=s;const g=new FileReader;g.onload=o=>{var f;l.value=(f=o.target)==null?void 0:f.result},g.readAsDataURL(s)}},removeImage:()=>{l.value=null,c.value=null,e.value&&(e.value.value="")}}}function Ue(){const e=be({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],files:[],areaId:0,workplace:"",guard:""}),l=x([]),c=x(!1),m=x([]),d=x([]);return{form:e,errorsSend:l,showErrors:c,prendasFijas:m,cafesUnitSelected:d,handleSubmit:(o,f)=>{let _;Array.isArray(f)?_=f:f&&typeof f=="object"?_=Array.isArray(f.value)?f.value:Object.values(f):_=[],_.forEach(v=>{v&&v.expirationDate===null?e.filesData.push({expirationDate:"-"}):e.filesData.push({expirationDate:v.expirationDate})}),console.log("filesArray:",_);const D=_.filter(v=>v&&typeof v=="object").map(v=>v.file).filter(v=>v instanceof File);console.log("Archivos válidos a subir:",D.length,D),e.prendas=m.value,e.files=D,e.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:v=>{e.reset(),o()},onError:v=>{c.value=!0,l.value=v,console.error("Error al subir el archivo:",v)}})},updateStaff:(o,f)=>{console.log(e),e.prendas=m.value,e.transform(_=>({..._,_method:"PUT"})).post(route("staff.update",f),{forceFormData:!0,onSuccess:_=>{o()},onError:_=>{c.value=!0,l.value=_,console.error("Error al subir el archivo:",_)}})},selectCafe:o=>{e.cafeId=o.id},selectRole:o=>{e.roleId=o.id},selectUnit:o=>{e.unitId=o.id,d.value=o.cafes,e.unitSelectedText=o.name},selectArea:o=>{e.areaId=o},selectGuard:o=>{e.guard=String(o)}}}function Te(e,l,c,m){const d=(a,s)=>{var i,h;if(!a){b();return}e.name=a.name,e.dni=a.dni,e.cell=a.cell,e.birthdate=String(a.birthdate),e.age=a.age,e.sex=String(a.sex),e.email=a.email,e.country=a.country,e.civilstatus=String(a.civilstatus),e.contactname=a.contactname,e.contactcell=a.contactcell,e.roleId=a.role_id,a.staff_financial&&(e.district=a.staff_financial.district,e.province=a.staff_financial.province,e.department=a.staff_financial.department,e.address=a.staff_financial.address,e.workSystem=a.staff_financial.system_work,e.replacement=a.staff_financial.replacement,e.salary=a.staff_financial.salary,e.observations=a.staff_financial.observations,e.bankEntity=String(a.staff_financial.bank_entity),e.cc=a.staff_financial.account_number,e.cci=a.staff_financial.cci,e.pensioncontribution=String(a.staff_financial.pensioncontribution),e.startDate=String(a.staff_financial.start_date),e.contractEndDate=String(a.staff_financial.contract_end_date),e.children=a.staff_financial.children),l.value.forEach(g=>g.talla=""),a.staff_clothes.forEach(g=>{const o=l.value.find(f=>f.label===g.clothe_name);o&&(o.talla=g.clothing_size)}),S(a,s),e.guard=(h=(i=a.guard_role)==null?void 0:i.guard_selected)==null?void 0:h.name,c.value=a.photo?a.photo.url.startsWith("http")?a.photo.url:`/storage/${a.photo.url}`:null},S=(a,s)=>{if(a.staffable_type==="App\\Models\\Cafe"){e.workplace="2",e.cafeId=a.staffable_id;const i=a.staffable;if(i!=null&&i.unit){e.unitId=i.unit.id;const h=s.find(g=>g.id===i.unit.id);h&&(m.value=h.cafes)}}else a.staffable_type==="App\\Models\\Area"?(e.workplace="1",e.areaId=a.staffable_id):(e.workplace=0,e.cafeId=null,e.unitId=0,e.areaId=0)},b=()=>{e.reset(),e.workplace=0,c.value=null,l.value.forEach(a=>a.talla="")};return{initializeStaffData:d}}function Ae(e){const l=x("personal"),c=["personal","adjuntos","financiero","tallas"],m=()=>e.value?c.filter(s=>s!=="adjuntos"):c;return{activeTab:l,nextTab:()=>{const s=m(),i=s.indexOf(l.value);i<s.length-1&&(l.value=s[i+1])},prevTab:()=>{const s=m(),i=s.indexOf(l.value);i>0&&(l.value=s[i-1])},resetTab:()=>{l.value="personal"},shouldShowTab:s=>m().includes(s)}}const Ee={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},$e={key:1},He=ve({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{},roleClothes:{}},setup(e){const l=e,c=x(!1),m=ge(()=>!!l.staff),{form:d,errorsSend:S,showErrors:b,prendasFijas:a,cafesUnitSelected:s,handleSubmit:i,updateStaff:h,selectCafe:g,selectRole:o,selectUnit:f,selectArea:_,selectGuard:D}=Ue(),{fileInput:v,imagePreview:j,triggerFileInput:Z,handleImageUpload:R,removeImage:H,selectedFile:J}=ke(),{filesRequired:M,showAlert:K,alertMessage:Q,handleFileUpload:N,handleDateFile:Y}=Fe(),{initializeStaffData:q}=Te(d,a,j,s),{activeTab:F,nextTab:ee,prevTab:ae,resetTab:te,shouldShowTab:P}=Ae(m);z(J,p=>{d.photo=p});const V=p=>{var O;if(!l.roleClothes||!d.roleId){l.staff||(a.value=[]);return}const n=Number(d.roleId),C=d.cafeId?String(d.cafeId):"all",ne=((O=l.roleClothes[n])==null?void 0:O[C])||[];a.value=ne.map(U=>{let T="";const B=a.value.find(A=>A.label===U.name);if(B&&(T=B.talla),!T&&p){const A=p.find(G=>{var L;return G.clothe_name===U.name||((L=G.cloth)==null?void 0:L.name)===U.name});A&&(T=A.clothing_size)}return{label:U.name,talla:T}})};z(()=>l.staff,p=>{q(p,l.units),p&&V(p.staff_clothes)},{immediate:!0}),z([()=>d.roleId,()=>d.cafeId],()=>{V()});const le=()=>{const p=()=>{c.value=!1,te()};m.value?h(p,l.staff.id):i(p,M)};return(p,n)=>(y(),w(t(re),{open:c.value,"onUpdate:open":n[2]||(n[2]=C=>c.value=C)},{default:r(()=>[u(t(de),{"as-child":""},{default:r(()=>[m.value?(y(),w(t(k),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:r(()=>[u(t(Ce))]),_:1})):(y(),w(t(k),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>n[3]||(n[3]=[I(" Nuevo Personal ")])),_:1}))]),_:1}),u(t(se),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:r(()=>[W("input",{type:"file",ref_key:"fileInput",ref:v,onChange:n[0]||(n[0]=(...C)=>t(R)&&t(R)(...C)),accept:"image/*",class:"hidden"},null,544),u(t(ie),{class:"z-10 border-b bg-white px-6 py-4"},{default:r(()=>[u(t(oe),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:r(()=>n[4]||(n[4]=[I(" Ficha de Registro de Colaborador ")])),_:1}),u(t(ce),null,{default:r(()=>n[5]||(n[5]=[I(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),u(me,{show:t(b),errors:t(S)},null,8,["show","errors"])]),_:1}),W("div",Ee,[u(t(fe),{modelValue:t(F),"onUpdate:modelValue":n[1]||(n[1]=C=>_e(F)?F.value=C:null),class:"w-full"},{default:r(()=>[u(t(pe),{class:he(["mb-6 grid w-full bg-zinc-100 p-1",m.value?"grid-cols-3":"grid-cols-4"])},{default:r(()=>[u(t(E),{value:"personal",class:"text-xs md:text-sm"},{default:r(()=>n[6]||(n[6]=[I("Personal")])),_:1}),t(P)("adjuntos")?(y(),w(t(E),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:r(()=>n[7]||(n[7]=[I("Adjuntos")])),_:1})):X("",!0),u(t(E),{value:"financiero",class:"text-xs md:text-sm"},{default:r(()=>n[8]||(n[8]=[I("Financiero")])),_:1}),u(t(E),{value:"tallas",class:"text-xs md:text-sm"},{default:r(()=>n[9]||(n[9]=[I("Tallas")])),_:1})]),_:1},8,["class"]),u(t($),{value:"personal",class:"mt-0"},{default:r(()=>[u(ye,{staff:p.staff,form:t(d),cafes:t(s),units:p.units,roles:p.roles,businneses:p.businneses,"image-preview":t(j),onTriggerUpload:t(Z),onRemoveImage:t(H),onSelectCafe:t(g),onSelectUnit:t(f),onSelectRole:t(o),onSelectArea:t(_),onSelectGuard:t(D)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea","onSelectGuard"])]),_:1}),t(P)("adjuntos")?(y(),w(t($),{key:0,value:"adjuntos",class:"mt-0"},{default:r(()=>[u(Se,{"files-required":t(M),"show-alert":t(K),"alert-message":t(Q),form:t(d),onUploadFile:t(N),onUploadDate:t(Y)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1})):X("",!0),u(t($),{value:"financiero",class:"mt-0"},{default:r(()=>[u(Ie,{form:t(d),roles:p.roles,onSelectRole:t(o),onUploadFile:t(N),staff:p.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),u(t($),{value:"tallas",class:"mt-0"},{default:r(()=>[u(we,{prendas:t(a)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),u(t(ue),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:r(()=>[t(F)!=="personal"?(y(),w(t(k),{key:0,onClick:t(ae),variant:"outline",type:"button"},{default:r(()=>n[10]||(n[10]=[I(" ← Anterior ")])),_:1},8,["onClick"])):(y(),xe("div",$e)),t(F)!=="tallas"?(y(),w(t(k),{key:2,onClick:t(ee),type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>n[11]||(n[11]=[I(" Siguiente → ")])),_:1},8,["onClick"])):(y(),w(t(k),{key:3,onClick:le,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:r(()=>n[12]||(n[12]=[I(" Finalizar Registro ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["open"]))}});export{He as _};
