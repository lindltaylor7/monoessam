import{d as z,j as p,s as D,V as E,v as $,c as i,o as u,b as d,i as y,a as f,Y as I,n as K,u as v,F as B,p as F,t as N}from"./app-vjxm5dno.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-Bu_0icfF.js";import{X as U}from"./x-YUcEfdmg.js";import{P as L}from"./plus-ynKwYTmd.js";import{C as T}from"./circle-alert-Hmaw4AGj.js";const P={class:"relative"},R={class:"relative"},W={key:0,ref:"resultsContainerRef",class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},j=["onClick","onKeydown"],q={class:"flex-1 text-sm"},X={key:0,class:"p-4 text-center text-gray-500"},O=z({__name:"InputSelectableUnit",props:{units:{},unitSelected:{}},emits:["selectUnit"],setup(S,{emit:_}){const c=S,V=_,o=p(""),l=p(!1),r=p(null),x=p(!1);D(o,async s=>{if(r.value){l.value=!1;return}if(l.value=s.length>0,x.value&&s.length>0){await E();const e=document.querySelector("[data-role-result]");e==null||e.focus()}x.value=!1});const k=$(()=>{if(r.value)return[];if(!o.value)return c.units.slice(0,5);const s=o.value.toLowerCase();return c.units.map(t=>{const a=t.name.toLowerCase();let n=0;return a.startsWith(s)&&(n+=3),a.includes(s)&&(n+=2),a.split(" ").some(m=>m.startsWith(s))&&(n+=1),{unit:t,score:n}}).filter(t=>t.score>0).sort((t,a)=>a.score-t.score).slice(0,7).map(t=>t.unit)}),h=s=>{r.value=s,o.value=s.name,l.value=!1,V("selectUnit",s)};if(c.unitSelected){const s=c.units.find(e=>e.id==c.unitSelected);h(s)}const w=()=>{r.value=null,o.value="",l.value=!1},C=(s,e)=>{var t,a,n,m;switch(s.key){case"ArrowDown":s.preventDefault();const g=s.target.nextElementSibling;g==null||g.focus();break;case"ArrowUp":s.preventDefault();const b=s.target.previousElementSibling;b!=null&&b.focus()||((a=(t=searchInputRef.value)==null?void 0:t.$el)==null||a.focus());break;case"Enter":s.preventDefault(),e&&addCafe(e);break;case"Escape":l.value=!1,(m=(n=searchInputRef.value)==null?void 0:n.$el)==null||m.focus();break}};return(s,e)=>(u(),i("div",P,[d("div",R,[f(A,{ref:"searchInputRef",placeholder:r.value?"Unidad seleccionada":"Buscar unidad",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),class:K(["w-full px-2 text-center",r.value?"border-green-200 bg-green-50":""]),onClick:e[1]||(e[1]=t=>l.value=!0),onKeydown:[e[2]||(e[2]=I(t=>l.value=!1,["esc"])),e[3]||(e[3]=t=>C(t))],autocomplete:"off",disabled:!!r.value},null,8,["placeholder","modelValue","class","disabled"]),r.value?(u(),i("button",{key:0,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-green-600 hover:text-green-800",title:"Cambiar comedor"},[f(v(U),{size:16})])):o.value?(u(),i("button",{key:1,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[f(v(U),{size:16})])):y("",!0)]),l.value&&!r.value?(u(),i("div",W,[(u(!0),i(B,null,F(k.value,t=>(u(),i("div",{key:t.id,"data-role-result":!0,onClick:a=>h(t),onKeydown:a=>C(a,t),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[f(v(L),{size:16,class:"flex-shrink-0 text-green-500"}),d("span",q,N(t.name),1),e[4]||(e[4]=d("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,j))),128)),k.value.length===0&&o.value?(u(),i("div",X,[f(v(T),{size:20,class:"mx-auto mb-2 text-gray-400"}),e[5]||(e[5]=d("p",null,"No se encontró unidad",-1)),e[6]||(e[6]=d("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):y("",!0)],512)):y("",!0)]))}});export{O as _};
