import{d as $,j as p,s as z,V as D,y as E,c as u,o as c,b as d,i as x,a as f,Y as I,n as K,u as v,F as B,p as F,t as N}from"./app-DHaWASGs.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-Bfjd_9Oz.js";import{X as S}from"./x-DiRws2QM.js";import{P as L}from"./plus-3sYIKzVS.js";import{C as T}from"./circle-alert-Way-lIMf.js";const P={class:"relative"},U={class:"relative"},W={key:0,ref:"resultsContainerRef",class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},j=["onClick","onKeydown"],q={class:"flex-1 text-sm"},X={key:0,class:"p-4 text-center text-gray-500"},O=$({__name:"InputSearchRole",props:{roles:{},roleSelected:{}},emits:["selectRole"],setup(R,{emit:V}){const i=R,_=V,a=p(""),l=p(!1),r=p(null),h=p(!1);z(a,async(s,t)=>{if(r.value){l.value=!1;return}if(l.value=s.length>0,h.value&&s.length>0){await D();const e=document.querySelector("[data-role-result]");e==null||e.focus()}h.value=!1});const k=E(()=>{if(r.value)return[];if(!a.value)return i.roles.slice(0,10);const s=a.value.toLowerCase();return i.roles.map(e=>{const o=e.name.toLowerCase();let n=0;return o.startsWith(s)&&(n+=3),o.includes(s)&&(n+=2),o.split(" ").some(m=>m.startsWith(s))&&(n+=1),{role:e,score:n}}).filter(e=>e.score>0).sort((e,o)=>o.score-e.score).slice(0,7).map(e=>e.role)}),g=s=>{r.value=s,a.value=s.name,l.value=!1,_("selectRole",s)};if(i.roleSelected){const s=i.roles.find(t=>t.id==i.roleSelected);g(s)}const w=()=>{var s,t;r.value=null,a.value="",l.value=!1,(t=(s=searchInputRef.value)==null?void 0:s.$el)==null||t.focus()},C=(s,t)=>{var e,o,n,m;switch(s.key){case"ArrowDown":s.preventDefault();const y=s.target.nextElementSibling;y==null||y.focus();break;case"ArrowUp":s.preventDefault();const b=s.target.previousElementSibling;b!=null&&b.focus()||((o=(e=searchInputRef.value)==null?void 0:e.$el)==null||o.focus());break;case"Enter":s.preventDefault(),t&&g(t);break;case"Escape":l.value=!1,(m=(n=searchInputRef.value)==null?void 0:n.$el)==null||m.focus();break}};return(s,t)=>(c(),u("div",P,[d("div",U,[f(A,{ref:"searchInputRef",placeholder:r.value?"Cargo seleccionado":"Buscar cargo",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),class:K(["w-full px-2 text-center",r.value?"border-green-200 bg-green-50":""]),onClick:t[1]||(t[1]=e=>l.value=!0),onKeydown:[t[2]||(t[2]=I(e=>l.value=!1,["esc"])),t[3]||(t[3]=e=>C(e))],autocomplete:"off",disabled:!!r.value},null,8,["placeholder","modelValue","class","disabled"]),r.value?(c(),u("button",{key:0,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-green-600 hover:text-green-800",title:"Cambiar comedor"},[f(v(S),{size:16})])):a.value?(c(),u("button",{key:1,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[f(v(S),{size:16})])):x("",!0)]),l.value&&!r.value?(c(),u("div",W,[(c(!0),u(B,null,F(k.value,e=>(c(),u("div",{key:e.id,"data-role-result":!0,onClick:o=>g(e),onKeydown:o=>C(o,e),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[f(v(L),{size:16,class:"flex-shrink-0 text-green-500"}),d("span",q,N(e.name),1),t[4]||(t[4]=d("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,j))),128)),k.value.length===0&&a.value?(c(),u("div",X,[f(v(T),{size:20,class:"mx-auto mb-2 text-gray-400"}),t[5]||(t[5]=d("p",null,"No se encontró comedor",-1)),t[6]||(t[6]=d("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):x("",!0)],512)):x("",!0)]))}});export{O as _};
