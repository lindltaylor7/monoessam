import{_ as k}from"./index-DpgMMlKQ.js";import{_ as J,a as K,b as Q,c as Y}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DwCCe1VU.js";import{_ as ee}from"./DialogDescription.vue_vue_type_script_setup_true_lang-LhN1IvpN.js";import{_ as ae}from"./DialogFooter.vue_vue_type_script_setup_true_lang-B0NV6Kd9.js";import{_ as le}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-D0htdjR-.js";import{_ as te,a as ne,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-B_BvddHV.js";import{_ as T}from"./TabsContent.vue_vue_type_script_setup_true_lang-BKJW9HOj.js";import{_ as se}from"./AlertErrors.vue_vue_type_script_setup_true_lang-CsUF3nsM.js";import{r as x,C as ie,d as oe,s as re,q as A,g as I,o as w,w as r,a as u,u as a,e as y,b as M,v as ce,i as P,n as ue,c as de}from"./app-D-LqQbZa.js";import{_ as fe}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-Byg4T0oN.js";import{_ as pe}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-CCznZAmA.js";import{_ as me}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-CYkf-veb.js";import{_ as be}from"./SizesTab.vue_vue_type_script_setup_true_lang-kvCSNGOX.js";import{P as ve}from"./pencil-Bs-09YM6.js";const ge=15*1024*1024;function _e(){const e=x(!1),n=x(""),c=x([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:e,alertMessage:n,handleFileUpload:(S,p,l)=>{const t=S.target.files;if(t.length>0){const i=t[0];if(i.size>ge)n.value="El archivo es demasiado grande. El máximo es 15MB.",e.value=!0;else{const _=c.value.find(v=>v.label==p);if(_){const o=i.name.split(".").pop(),d=new File([i],`${p}_${Date.now()}.${o}`,{type:i.type});l.push({file:d,label:p}),_.file=d}}}},handleDateFile:(S,p)=>{c.value[p].expirationDate=S}}}function he(){const e=x(null),n=x(null),c=x(null);return{fileInput:e,imagePreview:n,selectedFile:c,triggerFileInput:()=>{var p;(p=e.value)==null||p.click()},handleImageUpload:p=>{var i;const t=(i=p.target.files)==null?void 0:i[0];if(t){if(!t.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const _=5*1024*1024;if(t.size>_){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=t;const v=new FileReader;v.onload=o=>{var d;n.value=(d=o.target)==null?void 0:d.result},v.readAsDataURL(t)}},removeImage:()=>{n.value=null,c.value=null,e.value&&(e.value.value="")}}}function xe(){const e=ie({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],files:[],areaId:0,workplace:"",guard:""}),n=x([]),c=x(!1),f=x([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),b=x([]);return{form:e,errorsSend:n,showErrors:c,prendasFijas:f,cafesUnitSelected:b,handleSubmit:(o,d)=>{let g;Array.isArray(d)?g=d:d&&typeof d=="object"?g=Array.isArray(d.value)?d.value:Object.values(d):g=[],g.forEach(m=>{m&&m.expirationDate===null?e.filesData.push({expirationDate:"-"}):e.filesData.push({expirationDate:m.expirationDate})}),console.log("filesArray:",g);const C=g.filter(m=>m&&typeof m=="object").map(m=>m.file).filter(m=>m instanceof File);console.log("Archivos válidos a subir:",C.length,C),e.prendas=f.value,e.files=C,e.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:m=>{e.reset(),o()},onError:m=>{c.value=!0,n.value=m,console.error("Error al subir el archivo:",m)}})},updateStaff:(o,d)=>{e.prendas=f.value,e.transform(g=>({...g,_method:"PUT"})).post(route("staff.update",d),{forceFormData:!0,onSuccess:g=>{o()},onError:g=>{c.value=!0,n.value=g,console.error("Error al subir el archivo:",g)}})},selectCafe:o=>{e.cafeId=o.id},selectRole:o=>{e.roleId=o.id},selectUnit:o=>{e.unitId=o.id,b.value=o.cafes,e.unitSelectedText=o.name},selectArea:o=>{e.areaId=o},selectGuard:o=>{e.guard=String(o)}}}function Se(e,n,c,f){const b=(l,t)=>{var i,_;if(!l){p();return}e.name=l.name,e.dni=l.dni,e.cell=l.cell,e.birthdate=String(l.birthdate),e.age=l.age,e.sex=String(l.sex),e.email=l.email,e.country=l.country,e.civilstatus=String(l.civilstatus),e.contactname=l.contactname,e.contactcell=l.contactcell,e.roleId=l.role_id,l.staff_financial&&(e.district=l.staff_financial.district,e.province=l.staff_financial.province,e.department=l.staff_financial.department,e.address=l.staff_financial.address,e.workSystem=l.staff_financial.system_work,e.replacement=l.staff_financial.replacement,e.salary=l.staff_financial.salary,e.observations=l.staff_financial.observations,e.bankEntity=String(l.staff_financial.bank_entity),e.cc=l.staff_financial.account_number,e.cci=l.staff_financial.cci,e.pensioncontribution=String(l.staff_financial.pensioncontribution),e.startDate=String(l.staff_financial.start_date),e.contractEndDate=String(l.staff_financial.contract_end_date),e.children=l.staff_financial.children),n.value.forEach(v=>v.talla=""),l.staff_clothes.forEach(v=>{const o=n.value.find(d=>d.label===v.clothe_name);o&&(o.talla=v.clothing_size)}),S(l,t),e.guard=(_=(i=l.guard_role)==null?void 0:i.guard_selected)==null?void 0:_.name,c.value=l.photo?l.photo.url.startsWith("http")?l.photo.url:`/storage/${l.photo.url}`:null},S=(l,t)=>{if(l.staffable_type==="App\\Models\\Cafe"){e.workplace="2",e.cafeId=l.staffable_id;const i=l.staffable;if(i!=null&&i.unit){e.unitId=i.unit.id;const _=t.find(v=>v.id===i.unit.id);_&&(f.value=_.cafes)}}else l.staffable_type==="App\\Models\\Area"?(e.workplace="1",e.areaId=l.staffable_id):(e.workplace=0,e.cafeId=null,e.unitId=0,e.areaId=0)},p=()=>{e.reset(),e.workplace=0,c.value=null,n.value.forEach(l=>l.talla="")};return{initializeStaffData:b}}function ye(e){const n=x("personal"),c=["personal","adjuntos","financiero","tallas"],f=()=>e.value?c.filter(t=>t!=="adjuntos"):c;return{activeTab:n,nextTab:()=>{const t=f(),i=t.indexOf(n.value);i<t.length-1&&(n.value=t[i+1])},prevTab:()=>{const t=f(),i=t.indexOf(n.value);i>0&&(n.value=t[i-1])},resetTab:()=>{n.value="personal"},shouldShowTab:t=>f().includes(t)}}const we={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ie={key:1},Be=oe({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{},roleClothes:{}},setup(e){const n=e,c=x(!1),f=re(()=>!!n.staff),{form:b,errorsSend:S,showErrors:p,prendasFijas:l,cafesUnitSelected:t,handleSubmit:i,updateStaff:_,selectCafe:v,selectRole:o,selectUnit:d,selectArea:g,selectGuard:C}=xe(),{fileInput:m,imagePreview:E,triggerFileInput:B,handleImageUpload:$,removeImage:N,selectedFile:V}=he(),{filesRequired:z,showAlert:O,alertMessage:G,handleFileUpload:j,handleDateFile:L}=_e(),{initializeStaffData:W}=Se(b,l,E,t),{activeTab:D,nextTab:Z,prevTab:X,resetTab:q,shouldShowTab:R}=ye(f);A(V,h=>{b.photo=h}),A(()=>n.staff,h=>{W(h,n.units)},{immediate:!0}),A([()=>b.roleId,()=>b.cafeId],()=>{});const H=()=>{const h=()=>{c.value=!1,q()};f.value?_(h,n.staff.id):i(h,z)};return(h,s)=>(w(),I(a(Y),{open:c.value,"onUpdate:open":s[2]||(s[2]=F=>c.value=F)},{default:r(()=>[u(a(le),{"as-child":""},{default:r(()=>[f.value?(w(),I(a(k),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:r(()=>[u(a(ve))]),_:1})):(w(),I(a(k),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>s[3]||(s[3]=[y(" Nuevo Personal ")])),_:1}))]),_:1}),u(a(J),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:r(()=>[M("input",{type:"file",ref_key:"fileInput",ref:m,onChange:s[0]||(s[0]=(...F)=>a($)&&a($)(...F)),accept:"image/*",class:"hidden"},null,544),u(a(K),{class:"z-10 border-b bg-white px-6 py-4"},{default:r(()=>[u(a(Q),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:r(()=>s[4]||(s[4]=[y(" Ficha de Registro de Colaborador ")])),_:1}),u(a(ee),null,{default:r(()=>s[5]||(s[5]=[y(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),u(se,{show:a(p),errors:a(S)},null,8,["show","errors"])]),_:1}),M("div",we,[u(a(te),{modelValue:a(D),"onUpdate:modelValue":s[1]||(s[1]=F=>ce(D)?D.value=F:null),class:"w-full"},{default:r(()=>[u(a(ne),{class:ue(["mb-6 grid w-full bg-zinc-100 p-1",f.value?"grid-cols-3":"grid-cols-4"])},{default:r(()=>[u(a(U),{value:"personal",class:"text-xs md:text-sm"},{default:r(()=>s[6]||(s[6]=[y("Personal")])),_:1}),a(R)("adjuntos")?(w(),I(a(U),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:r(()=>s[7]||(s[7]=[y("Adjuntos")])),_:1})):P("",!0),u(a(U),{value:"financiero",class:"text-xs md:text-sm"},{default:r(()=>s[8]||(s[8]=[y("Financiero")])),_:1}),u(a(U),{value:"tallas",class:"text-xs md:text-sm"},{default:r(()=>s[9]||(s[9]=[y("Tallas")])),_:1})]),_:1},8,["class"]),u(a(T),{value:"personal",class:"mt-0"},{default:r(()=>[u(me,{staff:h.staff,form:a(b),cafes:a(t),units:h.units,roles:h.roles,businneses:h.businneses,"image-preview":a(E),onTriggerUpload:a(B),onRemoveImage:a(N),onSelectCafe:a(v),onSelectUnit:a(d),onSelectRole:a(o),onSelectArea:a(g),onSelectGuard:a(C)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea","onSelectGuard"])]),_:1}),a(R)("adjuntos")?(w(),I(a(T),{key:0,value:"adjuntos",class:"mt-0"},{default:r(()=>[u(fe,{"files-required":a(z),"show-alert":a(O),"alert-message":a(G),form:a(b),onUploadFile:a(j),onUploadDate:a(L)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1})):P("",!0),u(a(T),{value:"financiero",class:"mt-0"},{default:r(()=>[u(pe,{form:a(b),roles:h.roles,onSelectRole:a(o),onUploadFile:a(j),staff:h.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),u(a(T),{value:"tallas",class:"mt-0"},{default:r(()=>[u(be,{prendas:a(l)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),u(a(ae),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:r(()=>[a(D)!=="personal"?(w(),I(a(k),{key:0,onClick:a(X),variant:"outline",type:"button"},{default:r(()=>s[10]||(s[10]=[y(" ← Anterior ")])),_:1},8,["onClick"])):(w(),de("div",Ie)),a(D)!=="tallas"?(w(),I(a(k),{key:2,onClick:a(Z),type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>s[11]||(s[11]=[y(" Siguiente → ")])),_:1},8,["onClick"])):(w(),I(a(k),{key:3,onClick:H,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:r(()=>s[12]||(s[12]=[y(" Finalizar Registro ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Be as _};
