import{d as j,j as p,C as q,s as N,c as i,o as l,i as f,a as u,w as d,u as a,e as y,b as r,h as G,F as g,p as h,t as c,g as R,v as _}from"./app-RAqXLjNz.js";import{_ as k}from"./index-CzUmCOXQ.js";import{_ as H,a as J,b as K,c as O}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D2bS4ZUb.js";import{_ as P}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DgG5aIp1.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang-gsq01hTg.js";import{_ as Q,a as W,b as X,c as Y,d as Z}from"./SelectValue.vue_vue_type_script_setup_true_lang-DjkjKiev.js";import{_ as ee,a as ae}from"./SelectLabel.vue_vue_type_script_setup_true_lang-BiDFEr-r.js";const te={key:0,class:"fixed top-4 right-4 z-50 rounded-lg bg-green-500 p-4 text-white shadow-lg"},ne={class:"relative flex gap-2"},se={key:0},le={key:1},ie={key:0,class:"absolute top-full z-10 mt-1 max-h-40 w-[80%] overflow-auto rounded-md border bg-white shadow-lg"},oe=["onClick"],ue={key:0,class:"mt-1 text-sm text-green-600"},de={class:"relative flex gap-2"},re={key:0},me={key:1},fe={key:0,class:"absolute top-full z-10 mt-1 max-h-40 w-[80%] overflow-auto rounded-md border bg-white shadow-lg"},ce=["onClick"],ve={key:0,class:"mt-1 text-sm text-green-600"},pe={class:"relative flex gap-2"},_e={key:0},be={key:1},ge={key:0,class:"absolute top-full z-10 mt-1 max-h-40 w-[80%] overflow-auto rounded-md border bg-white shadow-lg"},Ie=["onClick"],ye={key:1,class:"mt-1 text-sm font-semibold text-red-500"},Ue=j({__name:"ManagementModal",props:{businesses:{}},setup(L){const z=L,b=p([]),v=p([]),m=p([]),x=p(!1),C=p(!1),o=p({mine:!1,unit:!1,cafe:!1}),e=q({mine:"",mineId:0,unit:"",unitId:0,cafe:"",cafeId:0,businessId:0});N(()=>e.mineId,(s,t)=>{s!==t&&(e.unit="",e.unitId=0,e.cafe="",e.cafeId=0,v.value=[],m.value=[],s!==0&&$(s))}),N(()=>e.unitId,(s,t)=>{s!==t&&(e.cafe="",e.cafeId=0,m.value=[],s!==0&&w(s))});const T=()=>{e.cafe.trim()!==""&&e.unitId>0&&e.cafeId===0&&B()},M=V(()=>{if(e.mine.trim().length<2){b.value=[];return}o.value.mine=!0,_.get("/search-mine/"+e.mine).then(s=>{b.value=s.data}).finally(()=>o.value.mine=!1)},300),$=V(s=>{if(e.unit.trim().length<2){v.value=[];return}o.value.unit=!0,_.get(`/search-unit/${e.unit}`).then(t=>{v.value=t.data}).finally(()=>o.value.unit=!1)},300),w=V(s=>{if(e.cafe.trim().length<2){m.value=[];return}o.value.cafe=!0,_.get(`/search-cafe/${s}/${e.cafe}`).then(t=>{m.value=t.data}).finally(()=>o.value.cafe=!1)},300),A=()=>{e.mine.trim()!==""&&(o.value.mine=!0,_.post("/mines",{name:e.mine}).then(s=>{F(s.data)}).catch(console.error).finally(()=>o.value.mine=!1))},S=()=>{e.unit.trim()===""||e.mineId===0||(o.value.unit=!0,_.post("/units",{name:e.unit,mine_id:e.mineId}).then(s=>{E(s.data)}).catch(console.error).finally(()=>o.value.unit=!1))},B=()=>{e.cafe.trim()===""||e.unitId===0||e.businessId===0||(o.value.cafe=!0,_.post("/cafes",{name:e.cafe,unit_id:e.unitId,business_id:e.businessId}).then(()=>{e.reset(),x.value=!1,C.value=!0,setTimeout(()=>C.value=!1,3e3)}).catch(console.error).finally(()=>o.value.cafe=!1))},F=s=>{e.mine=s.name,e.mineId=s.id,b.value=[]},E=s=>{e.unit=s.name,e.unitId=s.id,v.value=[],e.unit=s.name},D=s=>{e.cafe=s.name,e.cafeId=s.id,m.value=[]};function V(s,t){let n;return function(...I){clearTimeout(n),n=setTimeout(()=>s.apply(null,I),t)}}return(s,t)=>(l(),i(g,null,[C.value?(l(),i("div",te,"Lugar creado con éxito!")):f("",!0),u(a(O),{open:x.value,"onUpdate:open":t[8]||(t[8]=n=>x.value=n)},{default:d(()=>[u(a(P),{"as-child":""},{default:d(()=>[u(k,{variant:"outline"},{default:d(()=>t[9]||(t[9]=[y("Añadir Lugar")])),_:1})]),_:1}),u(a(H),{class:"max-w-md"},{default:d(()=>[u(a(J),null,{default:d(()=>[u(a(K),{class:"mb-4 text-lg font-semibold"},{default:d(()=>t[10]||(t[10]=[y("Agregar Nuevo Lugar (Mina → Unidad → Cafetería)")])),_:1})]),_:1}),r("form",{onSubmit:G(T,["prevent"]),class:"space-y-6"},[r("div",null,[t[11]||(t[11]=r("label",{class:"mb-1 block text-sm font-medium"},"1. Mina (Requerido)",-1)),r("div",ne,[u(U,{modelValue:a(e).mine,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).mine=n),type:"text",placeholder:"Buscar o nombrar nueva Mina...",onInput:a(M),onFocus:a(M),class:"flex-1"},null,8,["modelValue","onInput","onFocus"]),u(k,{type:"button",onClick:A,disabled:!a(e).mine.trim()||o.value.mine||a(e).mineId>0,title:"Crear nueva Mina con este nombre"},{default:d(()=>[o.value.mine?(l(),i("span",se,"...")):(l(),i("span",le,"+"))]),_:1},8,["disabled"]),b.value.length>0?(l(),i("ul",ie,[(l(!0),i(g,null,h(b.value,n=>(l(),i("li",{key:n.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:I=>F(n)},c(n.name),9,oe))),128))])):f("",!0)]),a(e).mineId>0?(l(),i("div",ue,"Mina seleccionada: "+c(a(e).mine)+".",1)):f("",!0)]),r("div",null,[t[12]||(t[12]=r("label",{class:"mb-1 block text-sm font-medium"},"2. Unidad",-1)),r("div",de,[u(U,{modelValue:a(e).unit,"onUpdate:modelValue":t[1]||(t[1]=n=>a(e).unit=n),type:"text",placeholder:"Buscar o nombrar nueva Unidad...",onInput:t[2]||(t[2]=n=>a($)(a(e).mineId)),onFocus:t[3]||(t[3]=n=>a($)(a(e).mineId)),class:"flex-1",disabled:a(e).mineId===0},null,8,["modelValue","disabled"]),u(k,{type:"button",onClick:S,disabled:!a(e).unit.trim()||o.value.unit||a(e).mineId===0||a(e).unitId>0,title:"Crear nueva Unidad dentro de la Mina seleccionada"},{default:d(()=>[o.value.unit?(l(),i("span",re,"...")):(l(),i("span",me,"+"))]),_:1},8,["disabled"]),v.value.length>0?(l(),i("ul",fe,[(l(!0),i(g,null,h(v.value,n=>(l(),i("li",{key:n.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:I=>E(n)},c(n.name),9,ce))),128))])):f("",!0)]),a(e).unitId>0?(l(),i("div",ve,"Unidad seleccionada: "+c(a(e).unit)+".",1)):f("",!0)]),r("div",null,[t[14]||(t[14]=r("label",{class:"mb-1 block text-sm font-medium"},"3. Cafetería y Empresa (Acción Final)",-1)),r("div",pe,[u(U,{modelValue:a(e).cafe,"onUpdate:modelValue":t[4]||(t[4]=n=>a(e).cafe=n),type:"text",placeholder:"Nombrar nueva Cafetería...",onInput:t[5]||(t[5]=n=>a(w)(a(e).unitId)),onFocus:t[6]||(t[6]=n=>a(w)(a(e).unitId)),class:"flex-1",disabled:a(e).unitId===0},null,8,["modelValue","disabled"]),u(a(Q),{class:"w-1/3",modelValue:a(e).businessId,"onUpdate:modelValue":t[7]||(t[7]=n=>a(e).businessId=n),disabled:a(e).unitId===0},{default:d(()=>[u(a(W),null,{default:d(()=>[u(a(X),{placeholder:"Empresa"})]),_:1}),u(a(Y),null,{default:d(()=>[u(a(ee),null,{default:d(()=>[u(a(ae),null,{default:d(()=>t[13]||(t[13]=[y("Empresas")])),_:1}),(l(!0),i(g,null,h(z.businesses,n=>(l(),R(a(Z),{value:n.id,key:n.id},{default:d(()=>[y(c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"]),u(k,{type:"button",onClick:B,disabled:!a(e).cafe.trim()||o.value.cafe||a(e).unitId===0||a(e).businessId===0,title:"Crear nueva Cafetería y asociarla a la Unidad y Empresa",variant:"default"},{default:d(()=>[o.value.cafe?(l(),i("span",_e,"Guardar")):(l(),i("span",be,"Crear"))]),_:1},8,["disabled"])]),m.value.length>0?(l(),i("ul",ge,[(l(!0),i(g,null,h(m.value,n=>(l(),i("li",{key:n.id,class:"cursor-pointer p-2 hover:bg-gray-100 hover:text-black",onClick:I=>D(n)},c(n.name),9,Ie))),128))])):f("",!0),a(e).cafeId>0?(l(),i("div",ye," ⚠️ Esta Cafetería ya existe (ID: "+c(a(e).cafeId)+"). ",1)):f("",!0)])],32)]),_:1})]),_:1},8,["open"])],64))}});export{Ue as _};
