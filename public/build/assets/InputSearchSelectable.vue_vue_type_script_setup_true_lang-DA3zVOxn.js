import{d as D,j as p,s as E,V as $,y as I,c as u,o as c,b as d,i as x,a as f,Y as K,n as B,u as v,F,p as N,t as A}from"./app-DRRK01BI.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-Z__jyveg.js";import{X as S}from"./x-7EKBnId8.js";import{P as T}from"./plus-DdDIEIC-.js";import{C as P}from"./circle-alert-BruNxsKS.js";const R={class:"relative"},U={class:"relative"},W={key:0,ref:"resultsContainerRef",class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},j=["onClick","onKeydown"],q={class:"flex-1 text-sm"},X={key:0,class:"p-4 text-center text-gray-500"},O=D({__name:"InputSearchSelectable",props:{cafes:{},cafeSelected:{}},emits:["selectCafe"],setup(V,{emit:_}){const i=V,z=_,o=p(""),l=p(!1),r=p(null),C=p(!1);E(o,async(s,t)=>{if(r.value){l.value=!1;return}if(l.value=s.length>0,C.value&&s.length>0){await $();const e=document.querySelector("[data-role-result]");e==null||e.focus()}C.value=!1});const h=I(()=>{if(r.value)return[];if(!o.value)return i.cafes.slice(0,5);console.log(i.cafes);const s=o.value.toLowerCase();return i.cafes.map(e=>{const a=e.name.toLowerCase();let n=0;return a.startsWith(s)&&(n+=3),a.includes(s)&&(n+=2),a.split(" ").some(m=>m.startsWith(s))&&(n+=1),{cafe:e,score:n}}).filter(e=>e.score>0).sort((e,a)=>a.score-e.score).slice(0,7).map(e=>e.cafe)}),g=s=>{r.value=s,o.value=s.name,l.value=!1,z("selectCafe",s)};if(i.cafeSelected){const s=i.cafes.find(t=>t.id==i.cafeSelected);g(s)}const k=()=>{r.value=null,o.value="",l.value=!1},w=(s,t)=>{var e,a,n,m;switch(s.key){case"ArrowDown":s.preventDefault();const b=s.target.nextElementSibling;b==null||b.focus();break;case"ArrowUp":s.preventDefault();const y=s.target.previousElementSibling;y!=null&&y.focus()||((a=(e=searchInputRef.value)==null?void 0:e.$el)==null||a.focus());break;case"Enter":s.preventDefault(),t&&g(t);break;case"Escape":l.value=!1,(m=(n=searchInputRef.value)==null?void 0:n.$el)==null||m.focus();break}};return(s,t)=>(c(),u("div",R,[d("div",U,[f(L,{ref:"searchInputRef",placeholder:r.value?"Comedor seleccionado":"Buscar comedor",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),class:B(["w-full px-2 text-center",r.value?"border-green-200 bg-green-50":""]),onClick:t[1]||(t[1]=e=>l.value=!0),onKeydown:[t[2]||(t[2]=K(e=>l.value=!1,["esc"])),t[3]||(t[3]=e=>w(e))],autocomplete:"off",disabled:!!r.value},null,8,["placeholder","modelValue","class","disabled"]),r.value?(c(),u("button",{key:0,onClick:k,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-green-600 hover:text-green-800",title:"Cambiar comedor"},[f(v(S),{size:16})])):o.value?(c(),u("button",{key:1,onClick:k,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[f(v(S),{size:16})])):x("",!0)]),l.value&&!r.value?(c(),u("div",W,[(c(!0),u(F,null,N(h.value,e=>(c(),u("div",{key:e.id,"data-role-result":!0,onClick:a=>g(e),onKeydown:a=>w(a,e),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[f(v(T),{size:16,class:"flex-shrink-0 text-green-500"}),d("span",q,A(e.name),1),t[4]||(t[4]=d("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,j))),128)),h.value.length===0&&o.value?(c(),u("div",X,[f(v(P),{size:20,class:"mx-auto mb-2 text-gray-400"}),t[5]||(t[5]=d("p",null,"No se encontró comedor",-1)),t[6]||(t[6]=d("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):x("",!0)],512)):x("",!0)]))}});export{O as _};
