import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-2zOl0_Zh.js";import{_ as m}from"./index-oFiWFObx.js";import{c as G,_ as H,a as Q,b as R}from"./DialogTitle.vue_vue_type_script_setup_true_lang-fZGcWMvr.js";import{_ as Y}from"./DialogFooter.vue_vue_type_script_setup_true_lang-BfBH85dL.js";import{_ as E}from"./Input.vue_vue_type_script_setup_true_lang-DofWQdID.js";import{_ as g}from"./Label.vue_vue_type_script_setup_true_lang-C3yTw1Pb.js";import{_ as j,a as T,b as I,c as F,d as L}from"./SelectValue.vue_vue_type_script_setup_true_lang-Cvj8s7Xu.js";import{d as ue,aQ as ce,r as x,C as z,s as pe,q as me,g as B,o as n,w as i,b as r,a as o,c,i as v,u as t,e as u,F as b,l as k,t as d,bY as ve}from"./app-fomrFkQZ.js";import{B as _e}from"./building-2-D-Caa-oC.js";import{P as J}from"./plus-DOZgqZJu.js";import{P as K}from"./pencil-DBn6pxY4.js";import{T as W}from"./trash-2-Cs54w2it.js";import{P as fe}from"./package-plus-WmZqvhMJ.js";import{S as ge}from"./search-C4qGOhnv.js";import{L as xe}from"./loader-circle-_55xEDmY.js";import"./utils-bRKmu4jq.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-CR9hpfbb.js";import"./Presence-4WqpHu5s.js";import"./Primitive-D7UgADSq.js";import"./useForwardExpose-B3tvnT3L.js";import"./PopperContent-DFl8Tbjs.js";import"./Teleport-BpnHmCys.js";import"./VisuallyHidden-DcKVyGdI.js";import"./index-dkW4UkYo.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-D_1z5tYj.js";import"./utils-Df-B55Kj.js";import"./useTypeahead-DZbV1e9K.js";import"./RovingFocusGroup-CUDDd4ho.js";import"./usePrimitiveElement-7YkADK9J.js";import"./Collection-CeR32Ioj.js";import"./utensils-BLD_WBR8.js";import"./createLucideIcon-CmUc2gDE.js";import"./DialogTitle-BStEHjuB.js";import"./x-BeCUyekq.js";import"./DialogDescription-C6cxIXKe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./hand-helping-DHaLZYsh.js";import"./user-pWHUwIa8.js";import"./chevron-right-CTUv8GHm.js";import"./chevron-down-Bh29We2u.js";import"./chevron-up-DHaVaXfh.js";import"./check-DntI5MKS.js";import"./useFormControl-P_Julbyk.js";const ye={class:"p-6"},he={class:"mb-8 flex flex-wrap items-center justify-between gap-4"},we={class:"flex gap-3"},be={class:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl"},ke={class:"bg-gradient-to-r from-slate-800 to-slate-900 px-6 py-5 text-white"},Ce={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-4"},Se={class:"flex h-12 w-12 items-center justify-center rounded-xl bg-white/10 text-xl font-bold"},Ve={class:"text-2xl font-bold"},$e={class:"mt-1 flex gap-4 text-xs text-slate-300"},Ae={key:0,class:"flex items-center gap-1"},Ee={key:1,class:"flex items-center gap-1"},Be={class:"flex gap-2"},Ue={class:"p-6"},ze={class:"mb-4 flex items-center gap-3"},Me={class:"text-lg font-bold text-gray-800"},Ne={class:"grid grid-cols-1 gap-4 lg:grid-cols-2"},je={class:"flex-1"},Te={class:"flex items-center gap-2"},Ie={class:"font-bold text-gray-900"},Fe={class:"rounded-lg bg-green-100 px-2 py-0.5 text-xs font-bold text-green-700"},Le={class:"mt-1 text-xs text-gray-500"},Oe={class:"mt-3 flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-600"},qe={class:"ml-4 flex flex-col gap-1 opacity-0 transition-opacity group-hover:opacity-100"},Ge={key:0,class:"flex flex-col items-center justify-center py-24 text-center"},He={class:"mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-slate-100 text-slate-300"},Qe={class:"mt-6 flex gap-4"},Re={class:"grid gap-4 py-4"},Ye={class:"grid gap-2"},Je={key:0,class:"text-xs text-red-500"},Ke={class:"grid gap-2"},We={key:0,class:"text-xs text-red-500"},Xe={class:"grid gap-2"},Ze={key:0,class:"text-xs text-red-500"},De={class:"grid gap-5 py-4"},et={class:"grid gap-2"},tt={key:0,class:"text-xs text-red-500"},st={class:"grid grid-cols-2 gap-4"},ot={class:"grid gap-2"},rt={key:0,class:"text-xs text-red-500"},it={class:"relative grid gap-2"},lt={class:"relative"},at={key:0,class:"absolute top-full z-50 mt-1 max-h-48 w-full overflow-y-auto rounded-md border bg-white shadow-lg"},nt=["onClick"],dt={class:"font-medium"},ut={class:"text-xs text-gray-500"},ct={key:1,class:"text-xs text-red-500"},pt={class:"grid grid-cols-2 gap-4"},mt={class:"grid gap-2"},vt={key:0,class:"text-xs text-red-500"},_t={class:"grid gap-2"},ft={key:0,class:"text-xs text-red-500"},ls=ue({__name:"Index",props:{ingredient_city_providers:{type:Array,required:!0,default:()=>[]},providers:{type:Array,default:()=>[]},ingredients:{type:Array,default:()=>[]},cities:{type:Array,default:()=>[]},measurement_units:{type:Array,default:()=>[]}},setup(A){const f=ce("$swal"),X=A,y=x(!1),h=x(!1),C=x(null),w=x(null),p=z({name:"",email:"",phone:""}),a=z({ingredient_id:"",provider_id:"",city_id:"",cost_price:"",measurement_unit_id:""}),P=x(""),S=x([]),M=x(!1),U=x(""),Z=pe(()=>{const l={};return X.ingredient_city_providers.forEach(e=>{const s=e.provider_id;l[s]||(l[s]={provider:e.provider,cities:{}});const V=e.city_id;l[s].cities[V]||(l[s].cities[V]={city:e.city,ingredients:[]}),l[s].cities[V].ingredients.push({...e.ingredient,assignment_id:e.id,cost_price:e.cost_price,presentation:e.ingredient.presentation,calories:e.ingredient.calories,measurement_unit:e.measurement_unit?e.measurement_unit.name:e.ingredient.measurement_unit,measurement_unit_id:e.measurement_unit_id,liquid_waste:e.ingredient.liquid_waste,solid_waste:e.ingredient.solid_waste})}),l}),O=()=>{C.value=null,p.reset(),p.clearErrors(),y.value=!0},D=l=>{C.value=l,p.name=l.name,p.email=l.email||"",p.phone=l.phone||"",p.clearErrors(),y.value=!0},ee=()=>{C.value?p.put(route("providers.update",C.value.id),{onSuccess:()=>{y.value=!1,f.fire("¡Éxito!","Proveedor actualizado correctamente","success")}}):p.post(route("providers.store"),{onSuccess:()=>{y.value=!1,f.fire("¡Éxito!","Proveedor registrado correctamente","success")}})},te=l=>{f.fire({title:"¿Estás seguro?",text:"Esta acción no se puede deshacer y podría eliminar las relaciones con ingredientes.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&z({}).delete(route("providers.destroy",l),{onSuccess:()=>{f.fire("Eliminado","El proveedor ha sido eliminado.","success")}})})},N=l=>{w.value=null,a.reset(),l&&(a.provider_id=l.toString()),a.clearErrors(),P.value="",S.value=[],U.value="",h.value=!0},se=(l,e,s)=>{w.value=l.assignment_id,a.ingredient_id=l.id.toString(),a.provider_id=e.toString(),a.city_id=s.toString(),a.cost_price=l.cost_price.toString(),a.measurement_unit_id=(l.measurement_unit_id||"").toString(),U.value=l.name,P.value=l.name,a.clearErrors(),h.value=!0};let q=null;const oe=async l=>{if(!l||l.length<2){S.value=[];return}M.value=!0;try{const e=await ve.get(route("ingredients.search",{word:l}));S.value=e.data}catch(e){console.error("Error searching ingredients:",e)}finally{M.value=!1}};me(P,l=>{l!==U.value&&(clearTimeout(q),q=setTimeout(()=>{oe(l)},300))});const re=l=>{a.ingredient_id=l.id.toString(),U.value=l.name,P.value=l.name,S.value=[]},ie=()=>{w.value?a.put(route("providers.assign.update",w.value),{onSuccess:()=>{h.value=!1,f.fire("¡Éxito!","Asignación actualizada correctamente","success")}}):a.post(route("providers.assign"),{onSuccess:()=>{h.value=!1,f.fire("¡Éxito!","Producto asignado correctamente","success")}})},le=l=>{f.fire({title:"¿Eliminar asignación?",text:"Se removerá el producto de la lista de este proveedor en esta ciudad.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:"Sí, eliminar"}).then(e=>{e.isConfirmed&&z({}).delete(route("providers.assign.destroy",l),{onSuccess:()=>{f.fire("Eliminado","La asignación ha sido eliminada.","success")}})})};return(l,e)=>(n(),B(de,null,{default:i(()=>[r("div",ye,[r("div",he,[e[16]||(e[16]=r("div",null,[r("h1",{class:"text-3xl font-bold text-gray-900"},"Gestión de Proveedores"),r("p",{class:"text-gray-500"},"Administra tus proveedores y los productos que ofrecen por ciudad.")],-1)),r("div",we,[o(t(m),{onClick:O,variant:"outline",class:"flex gap-2"},{default:i(()=>[o(t(_e),{class:"h-4 w-4"}),e[14]||(e[14]=u(" Nuevo Proveedor "))]),_:1}),o(t(m),{onClick:e[0]||(e[0]=s=>N())},{default:i(()=>[o(t(J),{class:"mr-2 h-4 w-4"}),e[15]||(e[15]=u(" Asignar Producto "))]),_:1})])]),(n(!0),c(b,null,k(Z.value,(s,V)=>(n(),c("div",{key:V,class:"mb-10 last:mb-0"},[r("div",be,[r("div",ke,[r("div",Ce,[r("div",Pe,[r("div",Se,d(s.provider.name.charAt(0)),1),r("div",null,[r("h2",Ve,d(s.provider.name),1),r("div",$e,[s.provider.email?(n(),c("span",Ae,[e[17]||(e[17]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),u(" "+d(s.provider.email),1)])):v("",!0),s.provider.phone?(n(),c("span",Ee,[e[18]||(e[18]=r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),u(" "+d(s.provider.phone),1)])):v("",!0)])])]),r("div",Be,[o(t(m),{onClick:$=>D(s.provider),variant:"ghost",size:"icon",class:"h-9 w-9 text-slate-300 hover:bg-white/10 hover:text-white"},{default:i(()=>[o(t(K),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(t(m),{onClick:$=>te(s.provider.id),variant:"ghost",size:"icon",class:"h-9 w-9 text-red-300 hover:bg-red-500/20 hover:text-red-400"},{default:i(()=>[o(t(W),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),o(t(m),{onClick:$=>N(s.provider.id),variant:"secondary",size:"sm",class:"ml-2 gap-1.5 px-3"},{default:i(()=>[o(t(J),{class:"h-3.5 w-3.5"}),e[19]||(e[19]=u(" Agregar Producto "))]),_:2},1032,["onClick"])])])]),r("div",Ue,[(n(!0),c(b,null,k(s.cities,($,ae)=>(n(),c("div",{key:ae,class:"mb-8 last:mb-0"},[r("div",ze,[e[20]||(e[20]=r("div",{class:"h-2 w-10 rounded-full bg-blue-500"},null,-1)),r("h3",Me,d($.city.name),1)]),r("div",Ne,[(n(!0),c(b,null,k($.ingredients,_=>(n(),c("div",{key:_.assignment_id,class:"group relative flex items-start justify-between rounded-xl border border-gray-100 bg-slate-50 p-4 transition-all hover:border-blue-200 hover:bg-white hover:shadow-md"},[r("div",je,[r("div",Te,[r("span",Ie,d(_.name),1),r("span",Fe,"S/ "+d(_.cost_price),1)]),r("p",Le,d(_.description),1),r("div",Oe,[r("span",null,[e[21]||(e[21]=r("strong",{class:"text-gray-400"},"Pres:",-1)),u(" "+d(_.presentation),1)]),r("span",null,[e[22]||(e[22]=r("strong",{class:"text-gray-400"},"UM:",-1)),u(" "+d(_.measurement_unit),1)]),r("span",null,[e[23]||(e[23]=r("strong",{class:"text-gray-400"},"Cal:",-1)),u(" "+d(_.calories)+" kcal",1)])])]),r("div",qe,[o(t(m),{onClick:ne=>se(_,s.provider.id,$.city.id),variant:"ghost",size:"icon",class:"h-8 w-8 text-gray-400 hover:text-blue-600"},{default:i(()=>[o(t(K),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"]),o(t(m),{onClick:ne=>le(_.assignment_id),variant:"ghost",size:"icon",class:"h-8 w-8 text-gray-400 hover:text-red-500"},{default:i(()=>[o(t(W),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"])])]))),128))])]))),128))])])]))),128)),A.ingredient_city_providers.length?v("",!0):(n(),c("div",Ge,[r("div",He,[o(t(fe),{class:"h-10 w-10"})]),e[26]||(e[26]=r("h3",{class:"text-xl font-semibold text-gray-900"},"No hay proveedores con productos",-1)),e[27]||(e[27]=r("p",{class:"mt-1 max-w-xs text-gray-500"},"Comienza registrando un proveedor y asignándole ingredientes por ciudad.",-1)),r("div",Qe,[o(t(m),{onClick:O,variant:"outline"},{default:i(()=>e[24]||(e[24]=[u("Nuevo Proveedor")])),_:1}),o(t(m),{onClick:e[1]||(e[1]=s=>N())},{default:i(()=>e[25]||(e[25]=[u("Asignar Producto")])),_:1})])]))]),o(t(G),{open:y.value,"onUpdate:open":e[6]||(e[6]=s=>y.value=s)},{default:i(()=>[o(t(H),{class:"sm:max-w-[425px]"},{default:i(()=>[o(t(Q),null,{default:i(()=>[o(t(R),null,{default:i(()=>[u(d(C.value?"Editar Proveedor":"Nuevo Proveedor"),1)]),_:1})]),_:1}),r("div",Re,[r("div",Ye,[o(t(g),{for:"provider_name"},{default:i(()=>e[28]||(e[28]=[u("Nombre del Proveedor")])),_:1}),o(t(E),{id:"provider_name",modelValue:t(p).name,"onUpdate:modelValue":e[2]||(e[2]=s=>t(p).name=s),placeholder:"Ej. Alimentos del Norte S.A.C."},null,8,["modelValue"]),t(p).errors.name?(n(),c("span",Je,d(t(p).errors.name),1)):v("",!0)]),r("div",Ke,[o(t(g),{for:"provider_email"},{default:i(()=>e[29]||(e[29]=[u("Email (Opcional)")])),_:1}),o(t(E),{id:"provider_email",modelValue:t(p).email,"onUpdate:modelValue":e[3]||(e[3]=s=>t(p).email=s),type:"email",placeholder:"contacto@proveedor.com"},null,8,["modelValue"]),t(p).errors.email?(n(),c("span",We,d(t(p).errors.email),1)):v("",!0)]),r("div",Xe,[o(t(g),{for:"provider_phone"},{default:i(()=>e[30]||(e[30]=[u("Teléfono (Opcional)")])),_:1}),o(t(E),{id:"provider_phone",modelValue:t(p).phone,"onUpdate:modelValue":e[4]||(e[4]=s=>t(p).phone=s),placeholder:"999 888 777"},null,8,["modelValue"]),t(p).errors.phone?(n(),c("span",Ze,d(t(p).errors.phone),1)):v("",!0)])]),o(t(Y),null,{default:i(()=>[o(t(m),{variant:"ghost",onClick:e[5]||(e[5]=s=>y.value=!1)},{default:i(()=>e[31]||(e[31]=[u("Cancelar")])),_:1}),o(t(m),{onClick:ee,disabled:t(p).processing},{default:i(()=>[u(d(C.value?"Guardar Cambios":"Registrar Proveedor"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),o(t(G),{open:h.value,"onUpdate:open":e[13]||(e[13]=s=>h.value=s)},{default:i(()=>[o(t(H),{class:"sm:max-w-[500px]"},{default:i(()=>[o(t(Q),null,{default:i(()=>[o(t(R),null,{default:i(()=>[u(d(w.value?"Editar Asignación":"Asignar Producto a Proveedor"),1)]),_:1})]),_:1}),r("div",De,[r("div",et,[o(t(g),null,{default:i(()=>e[32]||(e[32]=[u("Proveedor")])),_:1}),o(t(j),{modelValue:t(a).provider_id,"onUpdate:modelValue":e[7]||(e[7]=s=>t(a).provider_id=s),disabled:!!w.value},{default:i(()=>[o(t(T),null,{default:i(()=>[o(t(I),{placeholder:"Seleccionar proveedor"})]),_:1}),o(t(F),null,{default:i(()=>[(n(!0),c(b,null,k(A.providers,s=>(n(),B(t(L),{key:s.id,value:s.id.toString()},{default:i(()=>[u(d(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),t(a).errors.provider_id?(n(),c("span",tt,d(t(a).errors.provider_id),1)):v("",!0)]),r("div",st,[r("div",ot,[o(t(g),null,{default:i(()=>e[33]||(e[33]=[u("Ciudad")])),_:1}),o(t(j),{modelValue:t(a).city_id,"onUpdate:modelValue":e[8]||(e[8]=s=>t(a).city_id=s)},{default:i(()=>[o(t(T),null,{default:i(()=>[o(t(I),{placeholder:"Seleccionar ciudad"})]),_:1}),o(t(F),null,{default:i(()=>[(n(!0),c(b,null,k(A.cities,s=>(n(),B(t(L),{key:s.id,value:s.id.toString()},{default:i(()=>[u(d(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(a).errors.city_id?(n(),c("span",rt,d(t(a).errors.city_id),1)):v("",!0)]),r("div",it,[o(t(g),null,{default:i(()=>e[34]||(e[34]=[u("Ingrediente / Producto")])),_:1}),r("div",lt,[o(t(ge),{class:"absolute top-2.5 left-2.5 h-4 w-4 text-gray-400"}),o(t(E),{modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=s=>P.value=s),placeholder:"Buscar ingrediente...",class:"pl-9",autocomplete:"off"},null,8,["modelValue"]),M.value?(n(),B(t(xe),{key:0,class:"absolute top-2.5 right-2.5 h-4 w-4 animate-spin text-gray-400"})):v("",!0)]),S.value.length>0?(n(),c("div",at,[(n(!0),c(b,null,k(S.value,s=>(n(),c("div",{key:s.id,onClick:V=>re(s),class:"cursor-pointer px-4 py-2 text-sm hover:bg-slate-100"},[r("div",dt,d(s.name),1),r("div",ut,d(s.description||"Sin descripción"),1)],8,nt))),128))])):v("",!0),t(a).errors.ingredient_id?(n(),c("span",ct,d(t(a).errors.ingredient_id),1)):v("",!0)])]),r("div",pt,[r("div",mt,[o(t(g),{for:"cost_price"},{default:i(()=>e[35]||(e[35]=[u("Precio de Costo (S/)")])),_:1}),o(t(E),{id:"cost_price",modelValue:t(a).cost_price,"onUpdate:modelValue":e[10]||(e[10]=s=>t(a).cost_price=s),type:"number",step:"0.01",placeholder:"0.00"},null,8,["modelValue"]),t(a).errors.cost_price?(n(),c("span",vt,d(t(a).errors.cost_price),1)):v("",!0)]),r("div",_t,[o(t(g),null,{default:i(()=>e[36]||(e[36]=[u("Unidad de Medida")])),_:1}),o(t(j),{modelValue:t(a).measurement_unit_id,"onUpdate:modelValue":e[11]||(e[11]=s=>t(a).measurement_unit_id=s)},{default:i(()=>[o(t(T),null,{default:i(()=>[o(t(I),{placeholder:"Opcional"})]),_:1}),o(t(F),null,{default:i(()=>[(n(!0),c(b,null,k(A.measurement_units,s=>(n(),B(t(L),{key:s.id,value:s.id.toString()},{default:i(()=>[u(d(s.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(a).errors.measurement_unit_id?(n(),c("span",ft,d(t(a).errors.measurement_unit_id),1)):v("",!0)])])]),o(t(Y),null,{default:i(()=>[o(t(m),{variant:"ghost",onClick:e[12]||(e[12]=s=>h.value=!1)},{default:i(()=>e[37]||(e[37]=[u("Cancelar")])),_:1}),o(t(m),{onClick:ie,disabled:t(a).processing},{default:i(()=>[u(d(w.value?"Guardar Cambios":"Asignar Producto"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{ls as default};
