import{d as E,r as p,q as V,X as $,s as I,c as i,o as u,b as d,i as y,a as f,x as K,n as B,u as v,F,l as N,t as U}from"./app-CkZEfMms.js";import{_ as A}from"./Input.vue_vue_type_script_setup_true_lang-BzXStTK3.js";import{X as S}from"./x-B92Fb9I8.js";import{P as L}from"./plus-DOjgi2MK.js";import{C as T}from"./circle-alert-T2HUwl98.js";const q={class:"relative"},P={class:"relative"},R={key:0,ref:"resultsContainerRef",class:"absolute z-10 mt-2 max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-lg"},W=["onClick","onKeydown"],X={class:"flex-1 text-sm"},j={key:0,class:"p-4 text-center text-gray-500"},Q=E({__name:"InputSelectableUnit",props:{units:{},unitSelected:{}},emits:["selectUnit"],setup(_,{emit:z}){const c=_,D=z,r=p(""),n=p(!1),l=p(null),x=p(!1);V(r,async s=>{if(l.value){n.value=!1;return}if(n.value=s.length>0,x.value&&s.length>0){await $();const e=document.querySelector("[data-role-result]");e==null||e.focus()}x.value=!1});const k=I(()=>{if(l.value)return[];if(!r.value)return c.units.slice(0,5);const s=r.value.toLowerCase();return c.units.map(t=>{const a=t.name.toLowerCase();let o=0;return a.startsWith(s)&&(o+=3),a.includes(s)&&(o+=2),a.split(" ").some(m=>m.startsWith(s))&&(o+=1),{unit:t,score:o}}).filter(t=>t.score>0).sort((t,a)=>a.score-t.score).slice(0,7).map(t=>t.unit)}),h=s=>{l.value=s,r.value=s.name,n.value=!1,D("selectUnit",s)};if(c.unitSelected){const s=c.units.find(e=>e.id==c.unitSelected);h(s)}const w=()=>{l.value=null,r.value="",n.value=!1},C=(s,e)=>{var t,a,o,m;switch(s.key){case"ArrowDown":s.preventDefault();const g=s.target.nextElementSibling;g==null||g.focus();break;case"ArrowUp":s.preventDefault();const b=s.target.previousElementSibling;b!=null&&b.focus()||((a=(t=searchInputRef.value)==null?void 0:t.$el)==null||a.focus());break;case"Enter":s.preventDefault(),e&&addCafe(e);break;case"Escape":n.value=!1,(m=(o=searchInputRef.value)==null?void 0:o.$el)==null||m.focus();break}};return(s,e)=>(u(),i("div",q,[d("div",P,[f(A,{ref:"searchInputRef",placeholder:l.value?"Unidad seleccionada":"Buscar unidad",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),class:B(["w-full px-2 text-center",l.value?"border-green-200 bg-green-50":""]),onClick:e[1]||(e[1]=t=>n.value=!0),onKeydown:[e[2]||(e[2]=K(t=>n.value=!1,["esc"])),e[3]||(e[3]=t=>C(t))],autocomplete:"off",disabled:!!l.value},null,8,["placeholder","modelValue","class","disabled"]),l.value?(u(),i("button",{key:0,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-green-600 hover:text-green-800",title:"Cambiar comedor"},[f(v(S),{size:16})])):r.value?(u(),i("button",{key:1,onClick:w,class:"absolute top-1/2 right-3 -translate-y-1/2 transform text-gray-400 hover:text-gray-600"},[f(v(S),{size:16})])):y("",!0)]),n.value&&!l.value?(u(),i("div",R,[(u(!0),i(F,null,N(k.value,t=>{var a;return u(),i("div",{key:t.id,"data-role-result":!0,onClick:o=>h(t),onKeydown:o=>C(o,t),class:"flex cursor-pointer items-center gap-3 p-3 transition-colors hover:bg-gray-50 focus:bg-gray-50 focus:ring-2 focus:ring-green-500 focus:outline-none",tabindex:"0"},[f(v(L),{size:16,class:"flex-shrink-0 text-green-500"}),d("span",X,U(t.name)+" - "+U((a=t.mine)==null?void 0:a.name),1),e[4]||(e[4]=d("kbd",{class:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-400"},"Enter",-1))],40,W)}),128)),k.value.length===0&&r.value?(u(),i("div",j,[f(v(T),{size:20,class:"mx-auto mb-2 text-gray-400"}),e[5]||(e[5]=d("p",null,"No se encontró unidad",-1)),e[6]||(e[6]=d("p",{class:"mt-1 text-sm"},"Intenta con otros términos",-1))])):y("",!0)],512)):y("",!0)]))}});export{Q as _};
