import{_ as F}from"./index-CZl21aCP.js";import{_ as se,a as ne,b as oe,c as ie}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BOKYTpjN.js";import{_ as re}from"./DialogDescription.vue_vue_type_script_setup_true_lang-BfrluFLE.js";import{_ as fe}from"./DialogFooter.vue_vue_type_script_setup_true_lang-CobMxMqV.js";import{_ as ce}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CjAJ2NUe.js";import{c as ue,_ as de,a as I,b as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-jjEuiXwy.js";import{_ as me}from"./AlertErrors.vue_vue_type_script_setup_true_lang-_tMHkCy0.js";import{j as v,C as pe,d as ve,g as h,o as w,w as n,a as i,u as e,e as _,b as $,i as H}from"./app-f5Wc-EOw.js";import{_ as be}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-DU2LSe5_.js";import{_ as ge}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-DCLI6nWi.js";import{_ as _e}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-DT9ujRlw.js";import{_ as xe}from"./SizesTab.vue_vue_type_script_setup_true_lang-Be36TWzf.js";import{P as ye}from"./pencil-B1nMzJn9.js";const Se=9*1024*1024;function he(){const s=v(!1),a=v(""),c=v([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:s,alertMessage:a,handleFileUpload:(x,p,C)=>{const b=x.target.files;if(b.length>0){const g=b[0];if(g.size>Se)a.value="El archivo es demasiado grande. El máximo es 9MB.",s.value=!0;else{const y=c.value.find(o=>o.label==p);if(y){const d=g.name.split(".").pop(),r=new File([g],`${p}_${Date.now()}.${d}`,{type:g.type});C.push({file:r,label:p}),y.file=r}}}},handleDateFile:(x,p)=>{c.value[p].expirationDate=x}}}function we(){const s=v(null),a=v(null),c=v(null);return{fileInput:s,imagePreview:a,selectedFile:c,triggerFileInput:()=>{var p;(p=s.value)==null||p.click()},handleImageUpload:p=>{var g;const b=(g=p.target.files)==null?void 0:g[0];if(b){if(!b.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const y=5*1024*1024;if(b.size>y){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=b;const o=new FileReader;o.onload=d=>{var r;a.value=(r=d.target)==null?void 0:r.result},o.readAsDataURL(b)}},removeImage:()=>{a.value=null,c.value=null,s.value&&(s.value.value="")}}}function Ce(){const s=pe({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,files:[],tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0}),a=v([]),c=v(!1),u=v([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),t=v([]);return{form:s,errorsSend:a,showErrors:c,prendasFijas:u,cafesUnitSelected:t,handleSubmit:(o,d)=>{let r;Array.isArray(d)?r=d:d&&typeof d=="object"?r=Array.isArray(d.value)?d.value:Object.values(d):r=[],r.forEach(m=>{m&&m.expirationDate===null?s.filesData.push({expirationDate:"-"}):s.filesData.push({expirationDate:m.expirationDate})}),console.log("filesArray:",r);const D=r.filter(m=>m&&typeof m=="object").map(m=>m.file).filter(m=>m instanceof File);console.log("Archivos válidos a subir:",D.length,D),s.prendas=u.value,s.files=D,s.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:m=>{s.reset(),o()},onError:m=>{c.value=!0,a.value=m,console.error("Error al subir el archivo:",m)}})},updateStaff:(o,d)=>{console.log(s),s.prendas=u.value,s.put(route("staff.update",d),{onSuccess:r=>{o()},onError:r=>{c.value=!0,a.value=r,console.error("Error al subir el archivo:",r)}})},selectCafe:o=>{s.cafeId=o.id},selectRole:o=>{s.roleId=o.id},selectUnit:o=>{s.unitId=o.id,t.value=o.cafes,s.unitSelectedText=o.name},selectArea:o=>{s.areaId=o}}}const De={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},Ve=ve({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(s){var j,P,R,T,z,B,V,M,N,O,L,G,Z,W,X;const a=s,c=v(!1),u=v("personal"),{form:t,errorsSend:x,showErrors:p,prendasFijas:C,cafesUnitSelected:b,handleSubmit:g,updateStaff:y,selectCafe:o,selectRole:d,selectUnit:r,selectArea:D}=Ce();a.staff&&(console.log(a.staff),t.name=a.staff.name,t.dni=a.staff.dni,t.cell=a.staff.cell,t.birthdate=String(a.staff.birthdate),t.age=a.staff.age,t.sex=String(a.staff.sex),t.email=a.staff.email,t.country=a.staff.country,t.civilstatus=String(a.staff.civilstatus),t.contactname=a.staff.contactname,t.contactcell=a.staff.contactcell,t.district=(j=a.staff.staff_financial)==null?void 0:j.district,t.province=(P=a.staff.staff_financial)==null?void 0:P.province,t.department=(R=a.staff.staff_financial)==null?void 0:R.department,t.address=(T=a.staff.staff_financial)==null?void 0:T.address,t.workSystem=(z=a.staff.staff_financial)==null?void 0:z.system_work,t.replacement=(B=a.staff.staff_financial)==null?void 0:B.replacement,t.salary=(V=a.staff.staff_financial)==null?void 0:V.salary,t.observations=(M=a.staff.staff_financial)==null?void 0:M.observations,t.bankEntity=String((N=a.staff.staff_financial)==null?void 0:N.bank_entity),t.cc=(O=a.staff.staff_financial)==null?void 0:O.account_number,t.cci=(L=a.staff.staff_financial)==null?void 0:L.cci,t.pensioncontribution=String((G=a.staff.staff_financial)==null?void 0:G.pensioncontribution),t.startDate=String((Z=a.staff.staff_financial)==null?void 0:Z.start_date),t.contractEndDate=String((W=a.staff.staff_financial)==null?void 0:W.contract_end_date),t.children=(X=a.staff.staff_financial)==null?void 0:X.children,a.staff.staff_clothes.forEach(f=>{const l=C.value.find(S=>S.label==f.clothe_name);l.talla=f.clothing_size}));const{fileInput:m,imagePreview:J,triggerFileInput:K,handleImageUpload:k,removeImage:Q}=we(),{filesRequired:A,showAlert:Y,alertMessage:q,handleFileUpload:E,handleDateFile:ee}=he(),ae=()=>{const f=["personal","adjuntos","financiero","tallas"],l=f.indexOf(u.value);l<f.length-1&&(u.value=f[l+1])},te=()=>{const f=["personal","adjuntos","financiero","tallas"],l=f.indexOf(u.value);l>0&&(u.value=f[l-1])},le=()=>{a.staff?y(()=>{c.value=!1,u.value="personal"},a.staff.id):g(()=>{c.value=!1,u.value="personal"},A)};return(f,l)=>(w(),h(e(ie),{open:c.value,"onUpdate:open":l[2]||(l[2]=S=>c.value=S)},{default:n(()=>[i(e(ce),{"as-child":""},{default:n(()=>[a.staff?(w(),h(e(F),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:n(()=>[i(e(ye))]),_:1})):(w(),h(e(F),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>l[3]||(l[3]=[_(" Nuevo Personal ")])),_:1}))]),_:1}),i(e(se),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:n(()=>[$("input",{type:"file",ref_key:"fileInput",ref:m,onChange:l[0]||(l[0]=(...S)=>e(k)&&e(k)(...S)),accept:"image/*",class:"hidden"},null,544),i(e(ne),{class:"z-10 border-b bg-white px-6 py-4"},{default:n(()=>[i(e(oe),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:n(()=>l[4]||(l[4]=[_(" Ficha de Registro de Colaborador ")])),_:1}),i(e(re),null,{default:n(()=>l[5]||(l[5]=[_(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),i(me,{show:e(p),errors:e(x)},null,8,["show","errors"])]),_:1}),$("div",De,[i(e(ue),{modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=S=>u.value=S),class:"w-full"},{default:n(()=>[i(e(de),{class:"mb-6 grid w-full grid-cols-4 bg-zinc-100 p-1"},{default:n(()=>[i(e(I),{value:"personal",class:"text-xs md:text-sm"},{default:n(()=>l[6]||(l[6]=[_("Personal")])),_:1}),f.staff?H("",!0):(w(),h(e(I),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:n(()=>l[7]||(l[7]=[_("Adjuntos")])),_:1})),i(e(I),{value:"financiero",class:"text-xs md:text-sm"},{default:n(()=>l[8]||(l[8]=[_("Financiero")])),_:1}),i(e(I),{value:"tallas",class:"text-xs md:text-sm"},{default:n(()=>l[9]||(l[9]=[_("Tallas")])),_:1})]),_:1}),i(e(U),{value:"personal",class:"mt-0"},{default:n(()=>[i(_e,{staff:f.staff,form:e(t),cafes:e(b),units:f.units,roles:f.roles,businneses:f.businneses,"image-preview":e(J),onTriggerUpload:e(K),onRemoveImage:e(Q),onSelectCafe:e(o),onSelectUnit:e(r),onSelectRole:e(d),onSelectArea:e(D)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),i(e(U),{value:"adjuntos",class:"mt-0"},{default:n(()=>[i(be,{"files-required":e(A),"show-alert":e(Y),"alert-message":e(q),form:e(t),onUploadFile:e(E),onUploadDate:e(ee)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1}),i(e(U),{value:"financiero",class:"mt-0"},{default:n(()=>[i(ge,{form:e(t),roles:f.roles,onSelectRole:e(d),onUploadFile:e(E),staff:f.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),i(e(U),{value:"tallas",class:"mt-0"},{default:n(()=>[i(xe,{prendas:e(C)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),i(e(fe),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:n(()=>[$("div",null,[u.value!=="personal"?(w(),h(e(F),{key:0,onClick:te,variant:"outline",type:"button"},{default:n(()=>l[10]||(l[10]=[_(" ← Anterior ")])),_:1})):H("",!0)]),$("div",null,[u.value!=="tallas"?(w(),h(e(F),{key:0,onClick:ae,type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:n(()=>l[11]||(l[11]=[_(" Siguiente → ")])),_:1})):(w(),h(e(F),{key:1,onClick:le,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:n(()=>l[12]||(l[12]=[_(" Finalizar Registro ")])),_:1}))])]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Ve as _};
