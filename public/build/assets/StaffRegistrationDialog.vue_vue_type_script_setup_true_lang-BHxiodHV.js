import{_ as F}from"./index-DugFCX-b.js";import{_ as J,a as K,b as Q,c as Y}from"./DialogTitle.vue_vue_type_script_setup_true_lang-0mbjowD6.js";import{_ as q}from"./DialogDescription.vue_vue_type_script_setup_true_lang-DK5vTktY.js";import{_ as ee}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DsyqJLQZ.js";import{_ as ae}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BKNQyF_G.js";import{_ as le,a as te,b as k,c as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-BDUYB09n.js";import{_ as ne}from"./AlertErrors.vue_vue_type_script_setup_true_lang-B2jTeMQ-.js";import{j as x,C as se,d as ie,y as oe,s as j,g as w,o as y,w as r,a as d,u as a,e as S,b as R,X as re,i as M,n as ce,c as ue}from"./app-DHaWASGs.js";import{_ as de}from"./AttachmentsTab.vue_vue_type_script_setup_true_lang-FPBMOZKk.js";import{_ as fe}from"./FinancialDataTab.vue_vue_type_script_setup_true_lang-XgUCMgZc.js";import{_ as pe}from"./PersonalDataTab.vue_vue_type_script_setup_true_lang-DZjwaoHD.js";import{_ as me}from"./SizesTab.vue_vue_type_script_setup_true_lang-Bg7mRN8G.js";import{P as be}from"./pencil-BG0mzKe6.js";const ve=9*1024*1024;function ge(){const e=x(!1),s=x(""),c=x([{label:"CV Documentado",file:{}},{label:"Certificado Único Laboral (CUL)",file:{},expirationDate:null},{label:"Certificado de Estudios",file:{}},{label:"Certificados de Trabajo",file:{}},{label:"DNI escaneado",file:{},expirationDate:null},{label:"Antecedentes Penales y Policiales",file:{},expirationDate:null},{label:"Carné de sanidad",file:{},expirationDate:null},{label:"Carné de vacunación contra el COVID",file:{}},{label:"Examen Medico Ocupacional (EMO)",file:{},expirationDate:null},{label:"SCTR",file:{},expirationDate:null},{label:"Contrato",file:{},expirationDate:null}]);return{filesRequired:c,showAlert:e,alertMessage:s,handleFileUpload:(h,p,l)=>{const t=h.target.files;if(t.length>0){const n=t[0];if(n.size>ve)s.value="El archivo es demasiado grande. El máximo es 9MB.",e.value=!0;else{const g=c.value.find(o=>o.label==p);if(g){const m=n.name.split(".").pop(),u=new File([n],`${p}_${Date.now()}.${m}`,{type:n.type});l.push({file:u,label:p}),g.file=u}}}},handleDateFile:(h,p)=>{c.value[p].expirationDate=h}}}function _e(){const e=x(null),s=x(null),c=x(null);return{fileInput:e,imagePreview:s,selectedFile:c,triggerFileInput:()=>{var p;(p=e.value)==null||p.click()},handleImageUpload:p=>{var n;const t=(n=p.target.files)==null?void 0:n[0];if(t){if(!t.type.startsWith("image/")){alert("Por favor, selecciona solo archivos de imagen");return}const g=5*1024*1024;if(t.size>g){alert("La imagen es demasiado grande. Máximo 5MB");return}c.value=t;const o=new FileReader;o.onload=m=>{var u;s.value=(u=m.target)==null?void 0:u.result},o.readAsDataURL(t)}},removeImage:()=>{s.value=null,c.value=null,e.value&&(e.value.value="")}}}function xe(){const e=se({name:"",dni:"",cell:"",birthdate:"",age:0,sex:0,email:"",country:"",civilstatus:0,contactname:"",contactcell:"",cafeId:null,photo:null,tipoContrato:"",regimenLaboral:"",children:0,prendas:[],district:"",province:"",department:"",afp:"",onp:"",position:"",address:"",workSystem:"",replacement:"",unitId:0,salary:0,observations:"",bankEntity:0,pensioncontribution:"",cc:"",cci:"",startDate:"",contractEndDate:"",fondo:0,roleId:null,unitSelectedText:"",filesData:[],areaId:0,workplace:""}),s=x([]),c=x(!1),f=x([{label:"Polo",talla:""},{label:"Cafarena",talla:""},{label:"Overall",talla:""},{label:"Casaca",talla:""},{label:"Chaleco",talla:""},{label:"Chaqueta Blanca",talla:""},{label:"Pantalón",talla:""},{label:"Camisa/Blusa",talla:""},{label:"Guardapolvo",talla:""},{label:"Guantes",talla:""},{label:"Botas Blancas",talla:""},{label:"Zapatos",talla:""},{label:"Lentes",talla:""}]),v=x([]);return{form:e,errorsSend:s,showErrors:c,prendasFijas:f,cafesUnitSelected:v,handleSubmit:(o,m)=>{let u;Array.isArray(m)?u=m:m&&typeof m=="object"?u=Array.isArray(m.value)?m.value:Object.values(m):u=[],u.forEach(b=>{b&&b.expirationDate===null?e.filesData.push({expirationDate:"-"}):e.filesData.push({expirationDate:b.expirationDate})}),console.log("filesArray:",u);const I=u.filter(b=>b&&typeof b=="object").map(b=>b.file).filter(b=>b instanceof File);console.log("Archivos válidos a subir:",I.length,I),e.prendas=f.value,e.files=I,e.post(route("staff.store"),{forceFormData:!0,preserveState:!0,onSuccess:b=>{e.reset(),o()},onError:b=>{c.value=!0,s.value=b,console.error("Error al subir el archivo:",b)}})},updateStaff:(o,m)=>{console.log(e),e.prendas=f.value,e.transform(u=>({...u,_method:"PUT"})).post(route("staff.update",m),{forceFormData:!0,onSuccess:u=>{o()},onError:u=>{c.value=!0,s.value=u,console.error("Error al subir el archivo:",u)}})},selectCafe:o=>{e.cafeId=o.id},selectRole:o=>{e.roleId=o.id},selectUnit:o=>{e.unitId=o.id,v.value=o.cafes,e.unitSelectedText=o.name},selectArea:o=>{e.areaId=o}}}function he(e,s,c,f){const v=(l,t)=>{if(!l){p();return}e.name=l.name,e.dni=l.dni,e.cell=l.cell,e.birthdate=String(l.birthdate),e.age=l.age,e.sex=String(l.sex),e.email=l.email,e.country=l.country,e.civilstatus=String(l.civilstatus),e.contactname=l.contactname,e.contactcell=l.contactcell,e.roleId=l.role_id,l.staff_financial&&(e.district=l.staff_financial.district,e.province=l.staff_financial.province,e.department=l.staff_financial.department,e.address=l.staff_financial.address,e.workSystem=l.staff_financial.system_work,e.replacement=l.staff_financial.replacement,e.salary=l.staff_financial.salary,e.observations=l.staff_financial.observations,e.bankEntity=String(l.staff_financial.bank_entity),e.cc=l.staff_financial.account_number,e.cci=l.staff_financial.cci,e.pensioncontribution=String(l.staff_financial.pensioncontribution),e.startDate=String(l.staff_financial.start_date),e.contractEndDate=String(l.staff_financial.contract_end_date),e.children=l.staff_financial.children),s.value.forEach(n=>n.talla=""),l.staff_clothes.forEach(n=>{const g=s.value.find(o=>o.label===n.clothe_name);g&&(g.talla=n.clothing_size)}),h(l,t),c.value=l.photo?l.photo.url.startsWith("http")?l.photo.url:`/storage/${l.photo.url}`:null},h=(l,t)=>{if(l.staffable_type==="App\\Models\\Cafe"){e.workplace="2",e.cafeId=l.staffable_id;const n=l.staffable;if(n!=null&&n.unit){e.unitId=n.unit.id;const g=t.find(o=>o.id===n.unit.id);g&&(f.value=g.cafes)}}else l.staffable_type==="App\\Models\\Area"?(e.workplace="1",e.areaId=l.staffable_id):(e.workplace=0,e.cafeId=null,e.unitId=0,e.areaId=0)},p=()=>{e.reset(),e.workplace=0,c.value=null,s.value.forEach(l=>l.talla="")};return{initializeStaffData:v}}function Se(e){const s=x("personal"),c=["personal","adjuntos","financiero","tallas"],f=()=>e.value?c.filter(t=>t!=="adjuntos"):c;return{activeTab:s,nextTab:()=>{const t=f(),n=t.indexOf(s.value);n<t.length-1&&(s.value=t[n+1])},prevTab:()=>{const t=f(),n=t.indexOf(s.value);n>0&&(s.value=t[n-1])},resetTab:()=>{s.value="personal"},shouldShowTab:t=>f().includes(t)}}const ye={class:"flex-1 overflow-y-auto bg-gray-50/50 px-6 py-4"},we={key:1},Me=ie({__name:"StaffRegistrationDialog",props:{cafes:{},roles:{},units:{},businneses:{},staff:{}},setup(e){const s=e,c=x(!1),f=oe(()=>!!s.staff),{form:v,errorsSend:h,showErrors:p,prendasFijas:l,cafesUnitSelected:t,handleSubmit:n,updateStaff:g,selectCafe:o,selectRole:m,selectUnit:u,selectArea:I}=xe(),{fileInput:b,imagePreview:T,triggerFileInput:P,handleImageUpload:A,removeImage:B,selectedFile:N}=_e(),{filesRequired:E,showAlert:V,alertMessage:O,handleFileUpload:$,handleDateFile:L}=ge(),{initializeStaffData:W}=he(v,l,T,t),{activeTab:C,nextTab:G,prevTab:X,resetTab:Z,shouldShowTab:z}=Se(f);j(()=>s.staff,_=>W(_,s.units),{immediate:!0}),j(N,_=>{v.photo=_});const H=()=>{const _=()=>{c.value=!1,Z()};f.value?g(_,s.staff.id):n(_,E)};return(_,i)=>(y(),w(a(Y),{open:c.value,"onUpdate:open":i[2]||(i[2]=D=>c.value=D)},{default:r(()=>[d(a(ae),{"as-child":""},{default:r(()=>[f.value?(y(),w(a(F),{key:0,variant:"ghost",size:"icon",class:"cursor-pointer text-blue-600 hover:text-blue-800"},{default:r(()=>[d(a(be))]),_:1})):(y(),w(a(F),{key:1,variant:"default",class:"cursor-pointer bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>i[3]||(i[3]=[S(" Nuevo Personal ")])),_:1}))]),_:1}),d(a(J),{class:"flex h-[90vh] flex-col gap-0 overflow-hidden p-0 sm:max-w-5xl"},{default:r(()=>[R("input",{type:"file",ref_key:"fileInput",ref:b,onChange:i[0]||(i[0]=(...D)=>a(A)&&a(A)(...D)),accept:"image/*",class:"hidden"},null,544),d(a(K),{class:"z-10 border-b bg-white px-6 py-4"},{default:r(()=>[d(a(Q),{class:"text-xl font-bold text-zinc-800 md:text-2xl"},{default:r(()=>i[4]||(i[4]=[S(" Ficha de Registro de Colaborador ")])),_:1}),d(a(q),null,{default:r(()=>i[5]||(i[5]=[S(" Complete los datos del proceso de alta en las secciones a continuación. ")])),_:1}),d(ne,{show:a(p),errors:a(h)},null,8,["show","errors"])]),_:1}),R("div",ye,[d(a(le),{modelValue:a(C),"onUpdate:modelValue":i[1]||(i[1]=D=>re(C)?C.value=D:null),class:"w-full"},{default:r(()=>[d(a(te),{class:ce(["mb-6 grid w-full bg-zinc-100 p-1",f.value?"grid-cols-3":"grid-cols-4"])},{default:r(()=>[d(a(k),{value:"personal",class:"text-xs md:text-sm"},{default:r(()=>i[6]||(i[6]=[S("Personal")])),_:1}),a(z)("adjuntos")?(y(),w(a(k),{key:0,value:"adjuntos",class:"text-xs md:text-sm"},{default:r(()=>i[7]||(i[7]=[S("Adjuntos")])),_:1})):M("",!0),d(a(k),{value:"financiero",class:"text-xs md:text-sm"},{default:r(()=>i[8]||(i[8]=[S("Financiero")])),_:1}),d(a(k),{value:"tallas",class:"text-xs md:text-sm"},{default:r(()=>i[9]||(i[9]=[S("Tallas")])),_:1})]),_:1},8,["class"]),d(a(U),{value:"personal",class:"mt-0"},{default:r(()=>[d(pe,{staff:_.staff,form:a(v),cafes:a(t),units:_.units,roles:_.roles,businneses:_.businneses,"image-preview":a(T),onTriggerUpload:a(P),onRemoveImage:a(B),onSelectCafe:a(o),onSelectUnit:a(u),onSelectRole:a(m),onSelectArea:a(I)},null,8,["staff","form","cafes","units","roles","businneses","image-preview","onTriggerUpload","onRemoveImage","onSelectCafe","onSelectUnit","onSelectRole","onSelectArea"])]),_:1}),a(z)("adjuntos")?(y(),w(a(U),{key:0,value:"adjuntos",class:"mt-0"},{default:r(()=>[d(de,{"files-required":a(E),"show-alert":a(V),"alert-message":a(O),form:a(v),onUploadFile:a($),onUploadDate:a(L)},null,8,["files-required","show-alert","alert-message","form","onUploadFile","onUploadDate"])]),_:1})):M("",!0),d(a(U),{value:"financiero",class:"mt-0"},{default:r(()=>[d(fe,{form:a(v),roles:_.roles,onSelectRole:a(m),onUploadFile:a($),staff:_.staff},null,8,["form","roles","onSelectRole","onUploadFile","staff"])]),_:1}),d(a(U),{value:"tallas",class:"mt-0"},{default:r(()=>[d(me,{prendas:a(l)},null,8,["prendas"])]),_:1})]),_:1},8,["modelValue"])]),d(a(ee),{class:"z-10 flex w-full flex-row items-center justify-between border-t bg-white px-6 py-4"},{default:r(()=>[a(C)!=="personal"?(y(),w(a(F),{key:0,onClick:a(X),variant:"outline",type:"button"},{default:r(()=>i[10]||(i[10]=[S(" ← Anterior ")])),_:1},8,["onClick"])):(y(),ue("div",we)),a(C)!=="tallas"?(y(),w(a(F),{key:2,onClick:a(G),type:"button",class:"bg-blue-600 text-white hover:bg-blue-700"},{default:r(()=>i[11]||(i[11]=[S(" Siguiente → ")])),_:1},8,["onClick"])):(y(),w(a(F),{key:3,onClick:H,type:"button",class:"bg-green-600 text-white hover:bg-green-700"},{default:r(()=>i[12]||(i[12]=[S(" Finalizar Registro ")])),_:1}))]),_:1})]),_:1})]),_:1},8,["open"]))}});export{Me as _};
