import{d as Q,C as q,j as N,c,o as u,b as o,a as s,D as j,bQ as F,w as a,u as t,e as d,F as g,p as x,g as y,t as _,h as J,i as K,n as O,v as k}from"./app-Bfd0z9E7.js";import{_ as R}from"./index-DGup9OP-.js";import{a as I,b as W,c as U,d as p,_ as P}from"./SelectValue.vue_vue_type_script_setup_true_lang-CgT6SMRj.js";import{_ as X,a as Y}from"./SelectLabel.vue_vue_type_script_setup_true_lang-FDz9ReA-.js";import{_ as Z,a as S,b as D,c as ee,d as V,e as te}from"./TableHeader.vue_vue_type_script_setup_true_lang-BFnlswoD.js";import{T as B}from"./trash-B-S70ll4.js";const ae={class:"space-y-4"},se={class:"flex items-end gap-4 rounded-lg border bg-gray-50 p-4"},le={class:"flex flex-col gap-1"},oe={class:"flex flex-col gap-1"},ne={class:"flex flex-col gap-1"},re={class:"flex flex-col items-center justify-center gap-1"},de=["onClick"],ue={class:"mt-1 flex justify-center"},ie=["onClick"],ve=Q({__name:"TableHeadcount",props:{users:{},cafeId:{},periods:{},guards:{}},emits:["fetchCafeData"],setup(L,{emit:M}){const i=L,$=M,f=q({cafe_id:0,start_date:"",end_date:"",status:"0",users:[]}),b=N(""),v=N(""),h={1:{label:"Trabajando",color:"bg-green-400 hover:bg-green-500"},2:{label:"Libre",color:"bg-blue-400 hover:bg-blue-500"},3:{label:"Falta",color:"bg-red-400 hover:bg-red-500"},4:{label:"Nuevo",color:"bg-zinc-400 hover:bg-zinc-500"},default:{label:"Pendiente",color:"bg-zinc-200 hover:bg-zinc-300"}},z=r=>h[r]||h.default,C=(r,e)=>{var n;const l=e.users.find(w=>w.id===(r==null?void 0:r.id));return(n=l==null?void 0:l.pivot)!=null&&n.status?String(l.pivot.status):void 0},T=r=>{if(!r)return"";const[e,l,n]=r.split("-");return`${n}/${l}/${e}`},A=()=>{if(!b.value||!v.value){alert("Por favor selecciona ambas fechas");return}f.cafe_id=i.cafeId,f.start_date=b.value,f.end_date=v.value,f.users=i.users,k.post("/periods",f).then(()=>{$("fetchCafeData",i.cafeId),b.value="",v.value="",f.status="0"}).catch(r=>console.error(r))},E=r=>{confirm("¿Está seguro de eliminar este periodo?")&&k.delete("/periods/"+r).then(()=>$("fetchCafeData",i.cafeId)).catch(e=>console.error(e))},G=(r,e,l)=>{k.put(`/periods/user/${l}`,{user_id:e,period_id:l,status:r}).then(()=>{$("fetchCafeData",i.cafeId)}).catch(n=>{console.error("Error actualizando estado:",n),alert("No se pudo actualizar el estado")})};return(r,e)=>(u(),c("div",ae,[o("div",se,[o("div",le,[e[3]||(e[3]=o("label",{class:"text-sm font-medium text-gray-700"},"Fecha Inicio",-1)),j(o("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),class:"rounded border px-3 py-2 text-sm"},null,512),[[F,b.value]])]),o("div",oe,[e[4]||(e[4]=o("label",{class:"text-sm font-medium text-gray-700"},"Fecha Fin",-1)),j(o("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),class:"rounded border px-3 py-2 text-sm"},null,512),[[F,v.value]])]),o("div",ne,[e[9]||(e[9]=o("label",{class:"text-sm font-medium text-gray-700"},"Estado Inicial",-1)),s(t(P),{modelValue:t(f).status,"onUpdate:modelValue":e[2]||(e[2]=l=>t(f).status=l)},{default:a(()=>[s(t(I),null,{default:a(()=>[s(t(W),{placeholder:"Estado"})]),_:1}),s(t(U),null,{default:a(()=>[s(t(p),{value:"1"},{default:a(()=>e[5]||(e[5]=[d("Trabajando")])),_:1}),s(t(p),{value:"2"},{default:a(()=>e[6]||(e[6]=[d("Libre")])),_:1}),s(t(p),{value:"3"},{default:a(()=>e[7]||(e[7]=[d("Falta")])),_:1}),s(t(p),{value:"4"},{default:a(()=>e[8]||(e[8]=[d("Nuevo")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("button",{onClick:A,class:"h-10 rounded bg-black px-4 py-2 text-sm text-white transition hover:bg-gray-800"}," Agregar Periodo ")]),s(t(te),null,{default:a(()=>[s(t(Z),null,{default:a(()=>[s(t(S),null,{default:a(()=>[s(t(D),{class:"w-[150px] font-bold"},{default:a(()=>e[10]||(e[10]=[d(" Guardia ")])),_:1}),s(t(D),{class:"w-[150px] font-bold"},{default:a(()=>e[11]||(e[11]=[d(" Personal ")])),_:1}),(u(!0),c(g,null,x(i.periods,l=>(u(),y(t(D),{key:l.id,class:"min-w-[120px] text-center"},{default:a(()=>[o("div",re,[o("span",null,_(T(l.start_date)),1),e[12]||(e[12]=o("span",{class:"text-xs text-gray-400"},"al",-1)),o("span",null,_(T(l.end_date)),1),o("button",{class:"absolute top-2 right-2 opacity-0 transition-opacity group-hover:opacity-100",onClick:J(n=>E(l.id),["stop"])},[s(t(B),{class:"text-red-400 hover:text-red-600",size:14})],8,de)]),o("div",ue,[o("button",{onClick:n=>E(l.id),title:"Eliminar periodo"},[s(t(B),{class:"cursor-pointer text-red-300 hover:text-red-500",size:16})],8,ie)])]),_:2},1024))),128))]),_:1})]),_:1}),s(t(ee),null,{default:a(()=>[(u(!0),c(g,null,x(i.guards,l=>(u(),c(g,{key:l.id},[(u(!0),c(g,null,x(l.assigned_roles,(n,w)=>(u(),y(t(S),{key:n.id},{default:a(()=>[w===0?(u(),y(t(V),{key:0,class:"font-medium",rowspan:l.assigned_roles.length},{default:a(()=>[d(_(l.name),1)]),_:2},1032,["rowspan"])):K("",!0),s(t(V),{class:"font-medium"},{default:a(()=>{var m;return[d(_(n.role.name)+" - "+_((m=n.staff)==null?void 0:m.name),1)]}),_:2},1024),(u(!0),c(g,null,x(i.periods,m=>(u(),y(t(V),{key:m.id,class:"p-2 text-center"},{default:a(()=>[s(t(P),{"model-value":C(n.user,m),"onUpdate:modelValue":H=>G(H,n.user.id,m.id)},{default:a(()=>[s(t(I),{class:"flex h-auto w-full justify-center border-0 bg-transparent p-0 shadow-none focus:ring-0"},{default:a(()=>[s(R,{class:O(["cursor-pointer border-0 px-3 py-1 text-white shadow-sm transition-all hover:scale-105",z(C(n.user,m)).color])},{default:a(()=>[d(_(z(C(n.user,m)).label),1)]),_:2},1032,["class"]),e[13]||(e[13]=o("span",{class:"sr-only"},"Toggle menu",-1))]),_:2},1024),s(t(U),null,{default:a(()=>[s(t(X),null,{default:a(()=>[s(t(Y),null,{default:a(()=>e[14]||(e[14]=[d("Cambiar Estado")])),_:1}),s(t(p),{value:"1"},{default:a(()=>e[15]||(e[15]=[d("Trabajando")])),_:1}),s(t(p),{value:"2"},{default:a(()=>e[16]||(e[16]=[d("Libre")])),_:1}),s(t(p),{value:"3"},{default:a(()=>e[17]||(e[17]=[d("Falta")])),_:1}),s(t(p),{value:"4"},{default:a(()=>e[18]||(e[18]=[d("Nuevo")])),_:1})]),_:1})]),_:1})]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1024))),128))]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]))}});export{ve as _};
